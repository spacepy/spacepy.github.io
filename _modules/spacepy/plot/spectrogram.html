
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spacepy.plot.spectrogram &#8212; SpacePy v0.4.1 Manual</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/default.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    
    <link rel="shortcut icon" href="../../../_static/spacepy_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/spacepy_logo.jpg" border="0" alt="spacepy_logo"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="https://spacepy.github.io/"">homepage</a>|&nbsp;</li>
        <li><a href="https://github.com/spacepy/spacepy">development</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>
       <li><a href="../../../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../spacepy.html" >spacepy</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../plot.html" accesskey="U">spacepy.plot</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spacepy.plot.spectrogram</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spacepy.plot.spectrogram</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Create and plot generic &#39;spectrograms&#39; for space science.</span>
<span class="sd">This is not a signal processing routine and does not apply</span>
<span class="sd">Fourier transforms (or similar) to the data. The functionality</span>
<span class="sd">provided here is the binning (and averaging) of multi-dimensional</span>
<span class="sd">to provide a 2D output map of some quantity as a function of two</span>
<span class="sd">parameters. An example would be particle data from a satellite mission:</span>
<span class="sd">electron flux, at a given energy, can be binned as a function of</span>
<span class="sd">both time and McIlwain L, then plotted as a 2D color-map,</span>
<span class="sd">colloquially known as a spectrogram.</span>

<span class="sd">In many other settings &#39;spectrogram&#39; refers to a transform of data</span>
<span class="sd">from the time domain to the frequency domain, and the subsequent plotting</span>
<span class="sd">of some quantity (e.g., power spectral density) as a function of time and</span>
<span class="sd">frequency. To approximate this functionality for, e.g., time-series magnetic field</span>
<span class="sd">data you would first calculate a the power spectral density and then use</span>
<span class="sd">:class:`Spectrogram` to rebin the data for visualization.</span>

<span class="sd">Authors: Brian Larsen and Steve Morley</span>
<span class="sd">Institution: Los Alamos National Laboratory</span>
<span class="sd">Contact: balarsen@lanl.gov, smorley@lanl.gov</span>
<span class="sd">Los Alamos National Laboratory</span>

<span class="sd">Copyright 2011 Los Alamos National Security, LLC.</span>

<span class="sd">.. rubric:: Class</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :template: clean_class.rst</span>
<span class="sd">    :toctree: autosummary</span>

<span class="sd">    Spectrogram</span>

<span class="sd">.. rubric:: Function</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :template: clean_function.rst</span>
<span class="sd">    :toctree: autosummary</span>

<span class="sd">    simpleSpectrogram</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.axes</span>
<span class="kn">import</span> <span class="nn">matplotlib.collections</span> <span class="k">as</span> <span class="nn">mcoll</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">date2num</span><span class="p">,</span> <span class="n">num2date</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">mtransforms</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">spacepy.datamodel</span> <span class="k">as</span> <span class="nn">dm</span>
<span class="kn">import</span> <span class="nn">spacepy.toolbox</span> <span class="k">as</span> <span class="nn">tb</span>
<span class="kn">from</span>  <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">spu</span>

<span class="n">__contact__</span> <span class="o">=</span> <span class="s1">&#39;Brian Larsen, balarsen@lanl.gov&#39;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Spectrogram&#39;</span><span class="p">,</span> <span class="s1">&#39;simpleSpectrogram&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Spectrogram"><a class="viewcode-back" href="../../../autosummary/spacepy.plot.Spectrogram.html#spacepy.plot.spectrogram.Spectrogram">[docs]</a><span class="k">class</span> <span class="nc">Spectrogram</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">SpaceData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class rebins data to produce a 2D data map that can be plotted as a spectrogram</span>

<span class="sd">    It is meant to be used on arbitrary data series.  The first series &quot;x&quot; is</span>
<span class="sd">    plotted on the abscissa and second series &quot;y&quot; is plotted on the ordinate and</span>
<span class="sd">    the third series &quot;z&quot; is plotted in color.</span>

<span class="sd">    The series are not passed in independently but instead inside a</span>
<span class="sd">    :class:`~spacepy.datamodel.SpaceData` container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    data : :class:`~spacepy.datamodel.SpaceData`</span>
<span class="sd">        The data for the spectrogram, the variables to be used default to</span>
<span class="sd">        &quot;Epoch&quot; for x, &quot;Energy&quot; for y, and &quot;Flux&quot; for z.  Other names are</span>
<span class="sd">        specified using the &#39;variables&#39; keyword.  All keywords override .attrs</span>
<span class="sd">        contents.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ================</span>
<span class="sd">    variables : list</span>
<span class="sd">        keyword containing the names of the variables to use for the spectrogram</span>
<span class="sd">        the list is a list of the SpaceData keys in x, y, z, order</span>
<span class="sd">    bins : list</span>
<span class="sd">        if the name &quot;bins&quot; is not specified in the .attrs of the dmarray variable</span>
<span class="sd">        this specifies the bins for each variable in a</span>
<span class="sd">        [[xbins], [ybins]] format</span>
<span class="sd">    xlim : list</span>
<span class="sd">        if the name &quot;lim&quot; is not specified in the .attrs of the dmarray variable</span>
<span class="sd">        this specifies the limit for the x variable [xlow, xhigh]</span>
<span class="sd">    ylim : list</span>
<span class="sd">        if the name &quot;lim&quot; is not specified in the .attrs of the dmarray variable</span>
<span class="sd">        this specifies the limit for the y variable [ylow, yhigh]</span>
<span class="sd">    zlim : list</span>
<span class="sd">        if the name &quot;lim&quot; is not specified in the .attrs of the dmarray variable</span>
<span class="sd">        this specifies the limit for the z variable [zlow, zhigh]</span>
<span class="sd">    extended_out : bool (optional)</span>
<span class="sd">        if this is True add more information to the output data model (default True)</span>

<span class="sd">    Notes</span>
<span class="sd">    =====</span>
<span class="sd">    Helper routines are planned to</span>
<span class="sd">    facilitate the creation of the SpaceData container if the data are not in the format.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import spacepy.datamodel as dm</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import spacepy.plot as splot</span>
<span class="sd">    &gt;&gt;&gt; sd = dm.SpaceData()</span>
<span class="sd">    &gt;&gt;&gt; sd[&#39;radius&#39;] = dm.dmarray(2*np.sin(np.linspace(0,30,500))+4, attrs={&#39;units&#39;:&#39;km&#39;})</span>
<span class="sd">    &gt;&gt;&gt; sd[&#39;day_of_year&#39;] = dm.dmarray(np.linspace(74,77,500))</span>
<span class="sd">    &gt;&gt;&gt; sd[&#39;1D_dataset&#39;] = dm.dmarray(np.random.normal(10,3,500)*sd[&#39;radius&#39;])</span>
<span class="sd">    &gt;&gt;&gt; spec = splot.Spectrogram(sd, variables=[&#39;day_of_year&#39;, &#39;radius&#39;, &#39;1D_dataset&#39;])</span>
<span class="sd">    &gt;&gt;&gt; ax = spec.plot()</span>

<span class="sd">    .. autosummary::</span>

<span class="sd">        ~Spectrogram.plot</span>

<span class="sd">    .. automethod:: plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

<span class="c1">#    TODO</span>
<span class="c1">#    ====</span>
<span class="c1">#    Allow for the input of a list of SpaceData objects for different sats</span>
<span class="c1">#    Make &quot;subclasses&quot; that allow for data to be passed in directly avoiding the data model</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Spectrogram</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1">## setup a default dictionary to step through to set values from kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">SpaceData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Epoch&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;Flux&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># this is the linspace over the range with sqrt() of the len bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;extended_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;axisDates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># if the key exists in kwargs replace setting with it, otherwise its an error</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Invalid keyword specified &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># check to see if the variables are in the spacedata</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>  <span class="c1"># TODO could check other capitalization</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot; not found in the input data&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="p">))</span>

        <span class="c1"># if the variables are empty error and quit</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No </span><span class="si">{0}</span><span class="s1"> data passed in&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No </span><span class="si">{0}</span><span class="s1"> data passed in&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No </span><span class="si">{0}</span><span class="s1"> data passed in&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])))</span>

        <span class="c1"># set limits, keywords override those in the data</span>
        <span class="c1">#if (self.specSettings[&#39;xlim&#39;] is None) and (self.specSettings[&#39;bins&#39;] is None):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;lim&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dum1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1">#TODO: tolist here is a workaround for a bug in</span>
                    <span class="n">dum2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1">#      datamodel&#39;s min method</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dum1</span><span class="p">,</span> <span class="n">dum2</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># was a numpy array not dmarray</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;lim&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]),</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># was a numpy array not dmarray</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;lim&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]),</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># was a numpy array not dmarray</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]))</span>

        <span class="c1"># are the axes dates?</span>
        <span class="n">forcedate</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">forcedate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">forcedate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;axisDates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forcedate</span>

        <span class="c1"># set default bins</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># since it is not set by keyword was it set in the datamodel?</span>
            <span class="n">attr_bins</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bins&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">attr_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]),</span>
                                             <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]),]</span>
                <span class="c1"># TODO this is not a hard extension to doing one with bins and one default</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># use the toolbox version of linspace so it works on dates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">tb</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                 <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))))),</span>
                    <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">tb</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                 <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])))))]</span>

        <span class="c1"># copy all the used keys</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># do the spectrogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computeSpec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_computeSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method operates on the input data to bin up the spectrogram and adds it</span>
<span class="sd">        to the Spectrogram class data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this is here for in the future when we take a list a SpaceData objects</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">overall_sum</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">))</span>
        <span class="n">overall_count</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">))</span>

        <span class="c1"># the valid range for the histograms</span>
        <span class="n">_range</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]]</span>

        <span class="c1"># if x/y is a time need to convert it to numbers (checking first element)</span>
        <span class="n">var_time</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">ivar</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">][</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">][</span><span class="n">ivar</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># it is already changed to date2num</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span> <span class="c1">#weird issue with arrays and date2num</span>
                    <span class="n">_range</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">_range</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span> <span class="c1"># ugg if this is not an array this breaks</span>
                        <span class="n">_range</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">_range</span><span class="p">[</span><span class="n">ivar</span><span class="p">]]</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">_range</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">_range</span><span class="p">[</span><span class="n">ivar</span><span class="p">]]</span>
                <span class="n">var_time</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ok not as a dmarray since it is local now</span>
        <span class="n">plt_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>

        <span class="k">for</span> <span class="n">ival</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_time</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">plt_data</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">plt_data</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">plt_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>  <span class="c1"># why was this an abject</span>
            <span class="n">plt_data</span> <span class="o">=</span> <span class="n">plt_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># go through and get rid of &quot;bad&quot; counts</span>
        <span class="n">zdat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">zind</span> <span class="o">=</span> <span class="o">~</span><span class="n">zdat</span><span class="o">.</span><span class="n">mask</span>
        <span class="c1"># ma has the annoying feature of if all the masks are the same just giving one value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zind</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">zdat</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># no len to a scalar</span>
            <span class="c1"># ok not as a dmarray since it is local now</span>
            <span class="n">zind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">zind</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">zdat</span><span class="p">))</span>

        <span class="c1"># get the number in each bin</span>
        <span class="n">H</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">plt_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">zind</span><span class="p">],</span>
                                <span class="n">plt_data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">zind</span><span class="p">],</span>
                                <span class="n">bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span>
                                <span class="nb">range</span> <span class="o">=</span> <span class="n">_range</span><span class="p">,</span>
                                <span class="p">)</span>
        <span class="c1"># this is here for in the future when we take a list a SpaceData objects</span>
        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">overall_count</span><span class="p">,</span>
               <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">overall_count</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
               <span class="n">overall_count</span><span class="p">)</span>

        <span class="c1"># get the sum in each bin</span>
        <span class="n">H</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">plt_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">zind</span><span class="p">],</span>
                                <span class="n">plt_data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">zind</span><span class="p">],</span>
                                <span class="n">bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span>
                                <span class="nb">range</span> <span class="o">=</span> <span class="n">_range</span><span class="p">,</span>
                                <span class="n">weights</span> <span class="o">=</span> <span class="n">zdat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">zind</span><span class="p">]</span>
                                <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">overall_sum</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">overall_sum</span><span class="p">)</span>

        <span class="n">overall_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">overall_count</span><span class="p">,</span> <span class="n">overall_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Explicitly ensure this array owns its mask</span>
        <span class="n">overall_count</span><span class="o">.</span><span class="n">unshare_mask</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">overall_sum</span><span class="p">,</span> <span class="n">overall_count</span><span class="p">)</span>

        <span class="c1">## for plotting</span>
        <span class="c1">#ind0 = data.data &lt;= 0</span>
        <span class="c1">#data[ind0] = np.ma.masked # add to the mask</span>
        <span class="c1">#data = np.ma.log10(data)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">SpaceData</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                   <span class="s1">&#39;xedges&#39;</span><span class="p">:</span><span class="s1">&#39;xedges&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;yedges&#39;</span><span class="p">:</span><span class="s1">&#39;yedges&#39;</span><span class="p">,})</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span>
            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                   <span class="s1">&#39;lim&#39;</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]],})</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">yedges</span><span class="p">,</span>
            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                   <span class="s1">&#39;lim&#39;</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]],})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;extended_out&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overall_count</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overall_sum</span>

    <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add another SpaceData with same keys, etc. to Spectrogram instance</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import spacepy.datamodel as dm</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import spacepy.plot as splot</span>
<span class="sd">        &gt;&gt;&gt; sd = dm.SpaceData()</span>
<span class="sd">        &gt;&gt;&gt; sd[&#39;radius&#39;] = dm.dmarray(2*np.sin(np.linspace(0,30,500))+4, attrs={&#39;units&#39;:&#39;km&#39;})</span>
<span class="sd">        &gt;&gt;&gt; sd[&#39;day_of_year&#39;] = dm.dmarray(np.linspace(74,77,500))</span>
<span class="sd">        &gt;&gt;&gt; sd[&#39;1D_dataset&#39;] = dm.dmarray(np.random.normal(10,3,500)*sd[&#39;radius&#39;])</span>
<span class="sd">        &gt;&gt;&gt; sd2 = dm.dmcopy(sd)</span>
<span class="sd">        &gt;&gt;&gt; sd2[&#39;radius&#39;] = dm.dmarray(2*np.cos(np.linspace(0,30,500))+4, attrs={&#39;units&#39;:&#39;km&#39;})</span>
<span class="sd">        &gt;&gt;&gt; sd2[&#39;1D_dataset&#39;] = dm.dmarray(np.random.normal(10,3,500)*sd2[&#39;radius&#39;])</span>
<span class="sd">        &gt;&gt;&gt; spec = splot.Spectrogram(sd, variables=[&#39;day_of_year&#39;, &#39;radius&#39;, &#39;1D_dataset&#39;])</span>
<span class="sd">        &gt;&gt;&gt; spec.add_data(sd2)</span>
<span class="sd">        &gt;&gt;&gt; ax = spec.plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;extended_out&#39;</span><span class="p">]:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Cannot add data to a Spectrogram unless &quot;extended_out&quot; was True on initial creation&#39;</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">Spectrogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">)</span>
        <span class="c1"># if they are both masked keep them that way</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span>
        <span class="c1"># turn off the mask by setting sum and count to zero where it masked for self an be sure b mask doesn&#39;t it self</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">b</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># put the mask back they are both bad</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="n">b</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">b</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">b</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;sum&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="Spectrogram.plot"><a class="viewcode-back" href="../../../autosummary/autosummary/spacepy.plot.spectrogram.Spectrogram.html#spacepy.plot.spectrogram.Spectrogram.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the spectrogram</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        title : str</span>
<span class="sd">            plot title (default &#39;&#39;)</span>
<span class="sd">        xlabel : str</span>
<span class="sd">            x axis label (default &#39;&#39;)</span>
<span class="sd">        ylabel : str</span>
<span class="sd">            y axis label (default &#39;&#39;)</span>
<span class="sd">        colorbar_label : str</span>
<span class="sd">            colorbar label (default &#39;&#39;)</span>
<span class="sd">        DateFormatter : matplotlib.dates.DateFormatter</span>
<span class="sd">            The formatting to use on the dates on the x-axis (default matplotlib.dates.DateFormatter(&quot;%d %b %Y&quot;))</span>
<span class="sd">        zlog : bool</span>
<span class="sd">            plot the z variable on a log scale (default True)</span>
<span class="sd">        cmap : matplotlib Colormap</span>
<span class="sd">            colormap instance to use</span>
<span class="sd">        colorbar : bool</span>
<span class="sd">            plot the colorbar (default True)</span>
<span class="sd">        axis : matplotlib axis object</span>
<span class="sd">            axis to plot the spectrogram to</span>
<span class="sd">        zlim : np.array</span>
<span class="sd">            array like 2 element that overrides (interior) the spectrogram zlim (default Spectrogram.specSettings[&#39;zlim&#39;])</span>
<span class="sd">        figsize : tuple (optional)</span>
<span class="sd">            tuple of size to pass to figure(), None does the default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># go through the passed in kwargs to plot and look at defaults</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">plotSettings_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;DateFormatter&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;zlim&#39;</span><span class="p">,</span> <span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;colorbar_label&#39;</span><span class="p">,</span> <span class="s1">&#39;zlog&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="s1">&#39;ylim&#39;</span><span class="p">,</span> <span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotSettings_keys</span><span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Invalid keyword argument to plot(), &quot;&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">SpaceData</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;ylabel&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;zlog&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlog&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="s1">&#39;DateFormatter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;DateFormatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DateFormatter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;DateFormatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> %b %Y&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;colorbar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;colorbar_label&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;ylim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;ylim&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">spu</span><span class="o">.</span><span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlog&#39;</span><span class="p">]:</span>
            <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bb</span><span class="p">),</span>
                                <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bb</span><span class="p">),</span>
                                <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;axisDates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">time_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticks_to_time</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">specSettings</span><span class="p">[</span><span class="s1">&#39;axisDates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticks_to_time</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]:</span>
            <span class="n">cb</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">vslice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        slice a spectrogram at a given position along the x axis, maintains</span>
<span class="sd">        variable names from spectrogram</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        value : float or datetime.datetime</span>
<span class="sd">            the value to slice the spectrogram at</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : datamodel.SpaceData</span>
<span class="sd">            spacedata containing the slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># using bisect find the index of the spectrogram to use</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">SpaceData</span><span class="p">()</span>
        <span class="n">ans</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">bin_edges_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">])</span>
        <span class="n">ans</span><span class="p">[</span><span class="s1">&#39;yedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ans</span><span class="p">[</span><span class="s1">&#39;xedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ans</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][:,</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">hslice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        slice a spectrogram at a given position along the y axis, maintains</span>
<span class="sd">        variable names from spectrogram</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        value : float or datetime.datetime</span>
<span class="sd">            the value to slice the spectrogram at</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : datamodel.SpaceData</span>
<span class="sd">            spacedata containing the slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># using bisect find the index of the spectrogram to use</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">SpaceData</span><span class="p">()</span>
        <span class="n">ans</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">bin_edges_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">])</span>
        <span class="n">ans</span><span class="p">[</span><span class="s1">&#39;yedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;yedges&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">:</span><span class="n">ind</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ans</span><span class="p">[</span><span class="s1">&#39;xedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;xedges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ans</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_set_ticks_to_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        given the axis change the ticks to times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeFmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotSettings</span><span class="p">[</span><span class="s1">&#39;DateFormatter&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xy</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">ticks</span><span class="p">))</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">timeFmt</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">xy</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">ticks</span><span class="p">))</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">timeFmt</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">autofmt_ydate</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Spectrogram object&gt;&quot;</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span></div>




<div class="viewcode-block" id="simpleSpectrogram"><a class="viewcode-back" href="../../../autosummary/autosummary/spacepy.plot.spectrogram.simpleSpectrogram.html#spacepy.plot.spectrogram.simpleSpectrogram">[docs]</a><span class="k">def</span> <span class="nf">simpleSpectrogram</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a spectrogram given Z or X,Y,Z. This is a wrapper around pcolormesh()</span>
<span class="sd">    that can handle Y being a 2d array of time dependent bins. Like in the</span>
<span class="sd">    Van Allen Probes HOPE and MagEIS data files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    *args : 1 or 3 arraylike</span>
<span class="sd">        Call Signatures::</span>

<span class="sd">        simpleSpectrogram(Z, **kwargs)</span>
<span class="sd">        simpleSpectrogram(X, Y, Z, **kwargs)</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ================</span>
<span class="sd">    zlog : bool</span>
<span class="sd">        Plot the color with a log colorbar (default: True)</span>
<span class="sd">    ylog : bool</span>
<span class="sd">        Plot the Y axis with a log scale (default: True)</span>
<span class="sd">    alpha : scalar (0-1)</span>
<span class="sd">        The alpha blending value (default: None)</span>
<span class="sd">    cmap : string</span>
<span class="sd">        The name of the colormap to use (default: system default)</span>
<span class="sd">    vmin : float</span>
<span class="sd">        Minimum color value (default: Z.min(), if log non-zero min)</span>
<span class="sd">    vmax : float</span>
<span class="sd">        Maximum color value (default: Z.max())</span>
<span class="sd">    ax : matplotlib.axes</span>
<span class="sd">        Axes to plot the spectrogram on (default: None - new axes)</span>
<span class="sd">    cb : bool</span>
<span class="sd">        Plot a colorbar (default: True)</span>
<span class="sd">    cbtitle : string</span>
<span class="sd">        Label to go on the colorbar (default: None)</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    ax : matplotlib.axes._subplots.AxesSubplot</span>
<span class="sd">        Matplotlib axes object that the plot is on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
        <span class="k">raise</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;simpleSpectrogram, takes Z or X, Y, Z&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># just Z in, makeup an X and Y</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># make sure not a dmarray or VarCopy</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># we really want X and Y to be one larger than Z</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># make sure not a dmarray or VarCopy</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># make sure not a dmarray or VarCopy</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># same length, expand X</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">bin_center_to_edges</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># hopefully evenly spaced</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># 1d, just use as axis</span>
            <span class="k">if</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="c1"># same length, expand Y</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">bin_center_to_edges</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="c1"># hopefully evenly spaced</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Y_orig</span> <span class="o">=</span> <span class="n">Y</span>
            <span class="c1"># 2d this is time dependent and thus need to overplot several</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">unique_columns</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="c1"># hopefully evenly spaced</span>
                <span class="n">Y_uniq</span> <span class="o">=</span> <span class="n">Y</span>
                <span class="n">Y_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Y</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">Y_tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">bin_center_to_edges</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">Y_tmp</span>

    <span class="c1"># deal with all the default keywords</span>
    <span class="n">zlog</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zlog&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ylog</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylog&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">alpha</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cmap</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">vmin</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmin&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">zlog</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Z</span><span class="p">)]))</span>
    <span class="n">vmax</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
    <span class="n">ax</span>      <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cb</span>      <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cbtitle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cbtitle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># the first case is that X, Y are 1d and Z is 2d, just make the plot</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">Y_uniq</span><span class="p">:</span>
            <span class="c1"># which indices in X have these values</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">yy</span> <span class="o">==</span> <span class="n">Y_orig</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Y_orig</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Y_orig</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">Y_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Y_orig</span><span class="p">)</span>
            <span class="n">Y_tmp</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y_orig</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Z_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
            <span class="n">Z_tmp</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y_tmp</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Z_tmp</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                               <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                               <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cb</span><span class="p">:</span> <span class="c1"># add a colorbar</span>
        <span class="n">cb_</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cbtitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cb_</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">cbtitle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="https://spacepy.github.io/"">homepage</a>|&nbsp;</li>
        <li><a href="https://github.com/spacepy/spacepy">development</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>
       <li><a href="../../../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../spacepy.html" >spacepy</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../plot.html" >spacepy.plot</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spacepy.plot.spectrogram</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2022, The SpacePy Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>