
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spacepy.time &#8212; SpacePy v0.2.2 Manual</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/copybutton.js"></script>
    
    <link rel="shortcut icon" href="../../_static/spacepy_favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/spacepy_logo.jpg" border="0" alt="spacepy_logo"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="https://spacepy.github.io/"">homepage</a>|&nbsp;</li>
        <li><a href="https://github.com/spacepy/spacepy">development</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>
       <li><a href="../../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../spacepy.html" accesskey="U">spacepy</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spacepy.time</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spacepy.time</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Time conversion, manipulation and implementation of Ticktock class</span>

<span class="sd">Notes</span>
<span class="sd">=====</span>
<span class="sd">The handling of time, in particular the conversions between representations,</span>
<span class="sd">can be more complicated than it seems on the surface. This can result in</span>
<span class="sd">some surprising behavior, particularly when requiring second-level accuracy and</span>
<span class="sd">converting between time systems outside of the period 1972 to present.</span>
<span class="sd">It is strongly recommended to use TAI if transferring times between SpacePy</span>
<span class="sd">and other libraries. TAI has a consistent, unambiguous definition and no</span>
<span class="sd">discontinuities.</span>

<span class="sd">Some time systems (e.g. the UTC representation via datetime) cannot represent</span>
<span class="sd">times during a leapsecond. SpacePy represents all these times as the latest</span>
<span class="sd">representable time in the day, e.g.::</span>

<span class="sd">    &gt;&gt;&gt; spacepy.time.Ticktock(&#39;2008-12-31T23:59:60&#39;).UTC[0]</span>
<span class="sd">    datetime.datetime(2008, 12, 31, 23, 59, 59, 999999)</span>

<span class="sd">Conversions between continuous time representations (e.g. TAI), leap second</span>
<span class="sd">aware representations (e.g. ISO timestrings), and those that ignore leap</span>
<span class="sd">seconds (e.g. UTC datetime, Unix time) are well-defined between the</span>
<span class="sd">introduction of the leap second system to UTC in 1972 and the present.</span>
<span class="sd">For systems that cannot represent leap seconds, the leap second moment is</span>
<span class="sd">considered not to exist. For example, from 23:59:59 on 2008-12-31 to 00:00:00</span>
<span class="sd">on 2009-01-01 is two seconds, but only represents a one-second increment in</span>
<span class="sd">Unix time. Details are also discussed in the individual time representations.</span>

<span class="sd">UTC times more than six months in the future are not well-defined, since</span>
<span class="sd">the sechedule of leap second insertion is not known in advance. SpacePy</span>
<span class="sd">performs conversions assuming there are no leapseconds after those which have</span>
<span class="sd">been announced by IERS.</span>

<span class="sd">Between 1960 and 1972, UTC was defined by means of fractional leap seconds</span>
<span class="sd">and a varying-length second. SpacePy treats UTC time in this period similar</span>
<span class="sd">to after 1972, with a consistent second the same length of the SI second.</span>
<span class="sd">It applies leap seconds wherever there is an entry in the USNO record of</span>
<span class="sd">TAI-UTC, rounding fractional total leap second countss to the integer (0.5</span>
<span class="sd">rounds up). This results in the application of six leap seconds at the</span>
<span class="sd">beginning of 1972. The discrepancy with other means of calculating TAI-UTC</span>
<span class="sd">may be as much as five seconds at the end of this period.</span>

<span class="sd">Before 1960, UTC is not defined. SpacePy assumes days of constant length</span>
<span class="sd">86400 seconds, equal to the SI second. This is almost guaranteed to be wrong;</span>
<span class="sd">for times well out of the space era, it is strongly recommended to work</span>
<span class="sd">consistently in either a continuous time system (e.g. TAI) or a day-based</span>
<span class="sd">system (e.g. JD).</span>

<span class="sd">SpacePy assumes dates including and after 1582-10-15 to be in the Gregorian</span>
<span class="sd">calendar and dates including and before 1582-10-04 to be Julian. 10-05 through</span>
<span class="sd">10-14 do not exist. This change is ignored for continuously-running non leap</span>
<span class="sd">second aware timebases: CDF and RDT.</span>

<span class="sd">See the ``Ticktock`` documentation and its various ``get`` functions for</span>
<span class="sd">more details on the exact definitions of time systems used by SpacePy.</span>

<span class="sd">Examples:</span>
<span class="sd">=========</span>

<span class="sd">&gt;&gt;&gt; import spacepy.time as spt</span>
<span class="sd">&gt;&gt;&gt; import datetime as dt</span>

<span class="sd">Day of year calculations</span>

<span class="sd">&gt;&gt;&gt; dts = spt.doy2date([2002]*4, range(186,190), dtobj=True)</span>
<span class="sd">&gt;&gt;&gt; dts</span>
<span class="sd">[datetime.datetime(2002, 7, 5, 0, 0),</span>
<span class="sd">datetime.datetime(2002, 7, 6, 0, 0),</span>
<span class="sd">datetime.datetime(2002, 7, 7, 0, 0),</span>
<span class="sd">datetime.datetime(2002, 7, 8, 0, 0)]</span>

<span class="sd">&gt;&gt;&gt; dts = spt.Ticktock(dts,&#39;UTC&#39;)</span>
<span class="sd">&gt;&gt;&gt; dts.DOY</span>
<span class="sd">array([ 186.,  187.,  188.,  189.])</span>

<span class="sd">Ticktock object creation</span>

<span class="sd">&gt;&gt;&gt; isodates = [&#39;2009-12-01T12:00:00&#39;, &#39;2009-12-04T00:00:00&#39;, &#39;2009-12-06T12:00:00&#39;]</span>
<span class="sd">&gt;&gt;&gt; dts = spt.Ticktock(isodates, &#39;ISO&#39;)</span>

<span class="sd">OR</span>

<span class="sd">&gt;&gt;&gt; dtdates = [dt.datetime(2009,12,1,12), dt.datetime(2009,12,4), dt.datetime(2009,12,6,12)]</span>
<span class="sd">&gt;&gt;&gt; dts = spt.Ticktock(dtdates, &#39;UTC&#39;)</span>

<span class="sd">ISO time formatting</span>

<span class="sd">&gt;&gt;&gt; dts = spt.tickrange(&#39;2009-12-01T12:00:00&#39;,&#39;2009-12-06T12:00:00&#39;,2.5)</span>

<span class="sd">OR</span>

<span class="sd">&gt;&gt;&gt; dts = spt.tickrange(dt.datetime(2009,12,1,12),dt.datetime(2009,12,6,12), \</span>
<span class="sd">    dt.timedelta(days=2, hours=12))</span>

<span class="sd">&gt;&gt;&gt; dts</span>
<span class="sd">Ticktock( [&#39;2009-12-01T12:00:00&#39;, &#39;2009-12-04T00:00:00&#39;, &#39;2009-12-06T12:00:00&#39;] ), dtype=ISO</span>

<span class="sd">&gt;&gt;&gt; dts.isoformat()</span>
<span class="sd">Current ISO output format is %Y-%m-%dT%H:%M:%S</span>
<span class="sd">Options are: [(&#39;seconds&#39;, &#39;%Y-%m-%dT%H:%M:%S&#39;), (&#39;microseconds&#39;, &#39;%Y-%m-%dT%H:%M:%S.%f&#39;)]</span>

<span class="sd">&gt;&gt;&gt; dts.isoformat(&#39;microseconds&#39;)</span>
<span class="sd">&gt;&gt;&gt; dts.ISO</span>
<span class="sd">[&#39;2009-12-01T12:00:00.000000&#39;,</span>
<span class="sd"> &#39;2009-12-04T00:00:00.000000&#39;,</span>
<span class="sd"> &#39;2009-12-06T12:00:00.000000&#39;]</span>

<span class="sd">Time manipulation</span>

<span class="sd">&gt;&gt;&gt; new_dts = dts + tdelt</span>
<span class="sd">&gt;&gt;&gt; new_dts.UTC</span>
<span class="sd">[datetime.datetime(2009, 12, 2, 18, 0),</span>
<span class="sd"> datetime.datetime(2009, 12, 5, 6, 0),</span>
<span class="sd"> datetime.datetime(2009, 12, 7, 18, 0)]</span>

<span class="sd">Other time formats</span>

<span class="sd">&gt;&gt;&gt; dts.RDT  # Gregorian ordinal time</span>
<span class="sd">array([ 733742.5,  733745. ,  733747.5])</span>

<span class="sd">&gt;&gt;&gt; dts.GPS # GPS time</span>
<span class="sd">array([  9.43704015e+08,   9.43920015e+08,   9.44136015e+08])</span>

<span class="sd">&gt;&gt;&gt; dts.JD # Julian day</span>
<span class="sd">array([ 2455167. ,  2455169.5,  2455172. ])</span>

<span class="sd">And so on.</span>

<span class="sd">.. currentmodule:: spacepy.time</span>

<span class="sd">.. NOTE... there is an error with this reference</span>

<span class="sd">Authors: Steve Morley, Josef Koller, Brian Larsen, Jon Niehof</span>
<span class="sd">Institution: Los Alamos National Laboratory</span>
<span class="sd">Contact: smorley@lanl.gov,</span>


<span class="sd">Copyright 2010 Los Alamos National Security, LLC.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">bisect</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">MutableSequence</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">MutableSequence</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span> <span class="k">as</span> <span class="nb">zip</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>  <span class="c1"># just use system zip. In python3 itertools.izip is just python zip</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">astropy.time</span>
    <span class="n">HAVE_ASTROPY</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAVE_ASTROPY</span> <span class="o">=</span> <span class="kc">False</span>
<span class="kn">import</span> <span class="nn">dateutil.parser</span> <span class="k">as</span> <span class="nn">dup</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">spacepy</span>
<span class="kn">from</span> <span class="nn">spacepy</span> <span class="kn">import</span> <span class="n">help</span>
<span class="kn">import</span> <span class="nn">spacepy.datamodel</span>

<span class="n">__contact__</span> <span class="o">=</span> <span class="s1">&#39;Steve Morley, smorley@lanl.gov&#39;</span>


<span class="c1"># -----------------------------------------------</span>
<span class="c1"># Ticktock class</span>
<span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock">[docs]</a><span class="k">class</span> <span class="nc">Ticktock</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ticktock( data, dtype )</span>

<span class="sd">    Ticktock class holding various time coordinate systems</span>
<span class="sd">    (TAI, UTC, ISO, JD, MJD, UNX, RDT, CDF, DOY, eDOY, APT)</span>

<span class="sd">    Possible input data types:</span>

<span class="sd">    ISO</span>
<span class="sd">        ISO standard format like &#39;2002-02-25T12:20:30&#39;</span>
<span class="sd">    UTC</span>
<span class="sd">        datetime object with UTC time</span>
<span class="sd">    TAI</span>
<span class="sd">        Elapsed seconds since 1958-1-1 (includes leap seconds)</span>
<span class="sd">    UNX</span>
<span class="sd">        Elapsed seconds since 1970-1-1 ignoring leapseconds (all days have</span>
<span class="sd">        86400 secs).</span>
<span class="sd">    JD</span>
<span class="sd">        Julian days elapsed</span>
<span class="sd">    MJD</span>
<span class="sd">        Modified Julian days</span>
<span class="sd">    RDT</span>
<span class="sd">        Rata Die days elapsed since 0001-1-1</span>
<span class="sd">    CDF</span>
<span class="sd">        CDF Epoch type: float milliseconds since 0000-1-1 ignoring leapseconds</span>
<span class="sd">    APT</span>
<span class="sd">        AstroPy :class:`~astropy.time.Time`. Requires AstroPy 1.0.</span>
<span class="sd">        (New in version 0.2.2.)</span>

<span class="sd">    Possible output data types: All those listed above, plus:</span>

<span class="sd">    DOY</span>
<span class="sd">        Integer day of year, starts with day 1</span>
<span class="sd">    eDOY</span>
<span class="sd">        Fractional day of year, starts at day 0</span>

<span class="sd">    It is strongly recommended to access various time systems via the</span>
<span class="sd">    attributes listed above, as in the examples. They will be calculated</span>
<span class="sd">    automatically if necessary. Using the ``get`` methods will force a</span>
<span class="sd">    recalculation.</span>

<span class="sd">    The original input data will always be available as the ``data``</span>
<span class="sd">    attribute.</span>

<span class="sd">    .. versionchanged:: 0.2.2</span>
<span class="sd">       In earlier versions of SpacePy, most values were derived from the</span>
<span class="sd">       ``datetime``-based ``UTC`` representation. This did not properly</span>
<span class="sd">       handle leap seconds in many cases. Now most are derived from ``TAI``</span>
<span class="sd">       (exceptions being ``DOY`` and ``eDOY``). In addition to differences</span>
<span class="sd">       around actual leap seconds, this may result in small differences</span>
<span class="sd">       between versions of SpacePy, with relative magnitude on the order of the</span>
<span class="sd">       resolution of a 64-bit float (2e-16). For times in the modern era, this</span>
<span class="sd">       is about 50 microseconds (us) for ``JD``, 15 us for ``CDF``, 1.5 us</span>
<span class="sd">       for ``RDT``, 1 us for ``MJD``, and 360 *nanoseconds* for ``TAI``.</span>

<span class="sd">    The relationships between parameters and how they are calculated are</span>
<span class="sd">    listed in the ``get`` methods and illustrated below.</span>

<span class="sd">    .. only:: latex</span>

<span class="sd">        .. image:: ../images/ticktock_relationships.pdf</span>

<span class="sd">    .. only:: html</span>

<span class="sd">        .. image:: ../images/ticktock_relationships.svg</span>
<span class="sd">            :target: ../_images/ticktock_relationships.svg</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    data : array_like (int, datetime, float, string)</span>
<span class="sd">        time stamp</span>
<span class="sd">    dtype : string {`CDF`, `ISO`, `UTC`, `TAI`, `UNX`, `JD`, `MJD`, `RDT`, `APT`} or function</span>
<span class="sd">        data type for data, if a function it must convert input time format to Python datetime</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : Ticktock</span>
<span class="sd">        instance with self.data, self.dtype, self.UTC etc</span>

<span class="sd">    Notes</span>
<span class="sd">    =====</span>
<span class="sd">    UTC data type is implemented as Python datetime, which cannot represent</span>
<span class="sd">    leap seconds. The time within a leap second is regarded as not happening.</span>

<span class="sd">    The CDF data type is the older CDF_EPOCH time type, not the newer</span>
<span class="sd">    CDF_TIME_TT2000. It similarly cannot represent leap seconds. Year</span>
<span class="sd">    0 is considered a leap year.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ================</span>
<span class="sd">    isoformat : str, optional</span>

<span class="sd">        .. versionadded:: 0.2.2</span>

<span class="sd">        Format string used for parsing and outputting ISO format. Input is</span>
<span class="sd">        not forced to be in this format; it is tried first, and other</span>
<span class="sd">        common formats tried if parsing fails. Because of this, if ISO input</span>
<span class="sd">        is in a consistent format, specifying this can speed up the input</span>
<span class="sd">        parsing. Can be changed on existing ``Ticktock`` with :meth:`isoformat`</span>
<span class="sd">        method. Default ``&#39;%Y-%m-%dT%H:%M:%S&#39;``.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>
<span class="sd">    datetime.datetime.strptime, isoformat</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>
<span class="sd">    &gt;&gt;&gt; x = Ticktock([2452331.0142361112, 2452332.0142361112], &#39;JD&#39;)</span>
<span class="sd">    &gt;&gt;&gt; x.ISO</span>
<span class="sd">    dmarray([&#39;2002-02-25T12:20:30&#39;, &#39;2002-02-26T12:20:30&#39;], dtype=&#39;|S19&#39;)</span>
<span class="sd">    &gt;&gt;&gt; x.DOY # Day of year</span>
<span class="sd">    dmarray([ 56.,  57.])</span>
<span class="sd">    &gt;&gt;&gt; y = Ticktock([&#39;01-01-2013&#39;, &#39;20-03-2013&#39;], lambda x: datetime.datetime.strptime(x, &#39;%d-%m-%Y&#39;))</span>
<span class="sd">    &gt;&gt;&gt; y.UTC</span>
<span class="sd">    dmarray([2013-01-01 00:00:00, 2013-03-20 00:00:00], dtype=object)</span>
<span class="sd">    &gt;&gt;&gt; y.DOY # Day of year</span>
<span class="sd">    dmarray([  1.,  79.])</span>

<span class="sd">    .. autosummary::</span>
<span class="sd">        ~Ticktock.append</span>
<span class="sd">        ~Ticktock.argsort</span>
<span class="sd">        ~Ticktock.convert</span>
<span class="sd">        ~Ticktock.getAPT</span>
<span class="sd">        ~Ticktock.getCDF</span>
<span class="sd">        ~Ticktock.getDOY</span>
<span class="sd">        ~Ticktock.getGPS</span>
<span class="sd">        ~Ticktock.getISO</span>
<span class="sd">        ~Ticktock.getJD</span>
<span class="sd">        ~Ticktock.getMJD</span>
<span class="sd">        ~Ticktock.getRDT</span>
<span class="sd">        ~Ticktock.getTAI</span>
<span class="sd">        ~Ticktock.getUNX</span>
<span class="sd">        ~Ticktock.getUTC</span>
<span class="sd">        ~Ticktock.geteDOY</span>
<span class="sd">        ~Ticktock.getleapsecs</span>
<span class="sd">        ~Ticktock.isoformat</span>
<span class="sd">        ~Ticktock.now</span>
<span class="sd">        ~Ticktock.sort</span>
<span class="sd">        ~Ticktock.today</span>
<span class="sd">        ~Ticktock.update_items</span>
<span class="sd">    .. automethod:: append</span>
<span class="sd">    .. automethod:: argsort</span>
<span class="sd">    .. automethod:: convert</span>
<span class="sd">    .. automethod:: getAPT</span>
<span class="sd">    .. automethod:: getCDF</span>
<span class="sd">    .. automethod:: getDOY</span>
<span class="sd">    .. automethod:: getGPS</span>
<span class="sd">    .. automethod:: getISO</span>
<span class="sd">    .. automethod:: getJD</span>
<span class="sd">    .. automethod:: getMJD</span>
<span class="sd">    .. automethod:: getRDT</span>
<span class="sd">    .. automethod:: getTAI</span>
<span class="sd">    .. automethod:: getUNX</span>
<span class="sd">    .. automethod:: getUTC</span>
<span class="sd">    .. automethod:: geteDOY</span>
<span class="sd">    .. automethod:: getleapsecs</span>
<span class="sd">    .. automethod:: isoformat</span>
<span class="sd">    .. automethod:: now</span>
<span class="sd">    .. automethod:: sort</span>
<span class="sd">    .. automethod:: today</span>
<span class="sd">    .. automethod:: update_items</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_keylist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span> <span class="s1">&#39;TAI&#39;</span><span class="p">,</span> <span class="s1">&#39;ISO&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;MJD&#39;</span><span class="p">,</span> <span class="s1">&#39;UNX&#39;</span><span class="p">,</span> <span class="s1">&#39;RDT&#39;</span><span class="p">,</span> <span class="s1">&#39;CDF&#39;</span><span class="p">,</span> <span class="s1">&#39;GPS&#39;</span><span class="p">,</span> <span class="s1">&#39;DOY&#39;</span><span class="p">,</span> <span class="s1">&#39;eDOY&#39;</span><span class="p">,</span> <span class="s1">&#39;leaps&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">HAVE_ASTROPY</span><span class="p">:</span>
        <span class="n">_keylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;APT&#39;</span><span class="p">)</span>
    <span class="n">_keylist_upper</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_keylist</span><span class="p">]</span>
    <span class="n">_isoformatstr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;seconds&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">,</span> <span class="s1">&#39;microseconds&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isoformat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span> <span class="o">=</span> <span class="n">isoformat</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isoformatstr</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Ticktock</span><span class="p">):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">Callable</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;ISO&#39;</span>
                <span class="k">elif</span> <span class="nb">str</span> <span class="ow">is</span> <span class="nb">bytes</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unicode</span><span class="p">):</span> <span class="c1">#Py2k</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;ISO&#39;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>
                <span class="k">elif</span> <span class="n">HAVE_ASTROPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">):</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;APT&#39;</span>
                    <span class="c1"># Recover original input (not dmarray), add axis if scalar</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">([</span><span class="n">data</span><span class="p">])</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span>\
                                <span class="k">else</span> <span class="n">data</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e13</span><span class="p">:</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;CDF&#39;</span>
                <span class="k">elif</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unable to guess dtype from data; &#39;</span>
                                     <span class="s1">&#39;please specify dtype.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ticktock</span><span class="o">.</span><span class="n">_keylist_upper</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data type &quot;</span> <span class="o">+</span> <span class="n">dtype</span> <span class="o">+</span> <span class="s2">&quot; not provided, only &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Ticktock</span><span class="o">.</span><span class="n">_keylist</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># process input data using callable dtype to convert to datetime/UTC</span>
                <span class="n">dtype_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dtype_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="n">no_tzinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># AstroPy time objects don&#39;t have attrs, but will accept one.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dtype_func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ISO is populated by update_items</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_items</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TAI&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;JD&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">JD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MJD&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;UNX&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;RDT&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CDF&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;UTC&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="n">no_tzinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;APT&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">APT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

            <span class="c1">## Brian and Steve were looking at this to see about making plot work directly on the object</span>
            <span class="c1">## is also making iterate as an array of datetimes</span>
            <span class="c1">#    def __iter__(self):</span>
            <span class="c1">#        i = 0</span>
            <span class="c1">#        try:</span>
            <span class="c1">#            while True:</span>
            <span class="c1">#                v = self[i].UTC[0]</span>
            <span class="c1">#                yield v</span>
            <span class="c1">#                i += 1</span>
            <span class="c1">#        except IndexError:</span>
            <span class="c1">#            return</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__str__() or a</span>

<span class="sd">        Will be called when printing Ticktock instance a</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : string</span>
<span class="sd">            string representaion of the class</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:03&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Ticktock( [&#39;2002-02-02T12:00:00&#39;], dtype=ISO)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;Ticktock( &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, dtype=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is called when pickling</span>
<span class="sd">        See Also http://docs.python.org/library/pickle.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy the dict since we change it</span>
        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is called when unpickling</span>
<span class="sd">        See Also http://docs.python.org/library/pickle.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__getitem__(idx) or a[idx]</span>

<span class="sd">        Will be called when requesting items in this instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        idx : int</span>
<span class="sd">            the item index to get</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : Ticktock</span>
<span class="sd">            Ticktock instance with requested values</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:03&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a[0]</span>
<span class="sd">        &#39;2002-02-02T12:00:00&#39;</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        a.__setitem__</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Ticktock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__setitem__(idx, vals) or a[idx] = vals</span>

<span class="sd">        Will be called setting items in this instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        idx : int</span>
<span class="sd">            integer numbers as index</span>
<span class="sd">        vals: {float, string, datetime}</span>
<span class="sd">            new values</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:03&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a[0] = &#39;2003-03-03T00:00:00&#39;</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        a.__getitem__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">])[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_items</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__delitem(index)</span>

<span class="sd">        will be called when deleting items in the sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_items</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__len__() or len(a)</span>

<span class="sd">        Will be called when requesting the length, i.e. number of items</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : int</span>
<span class="sd">            length</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:03&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.len</span>
<span class="sd">        1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">UNX</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">UNX</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">UNX</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">UNX</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">UNX</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">UNX</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__sub__(other)</span>

<span class="sd">        Will be called if a timedelta object is subtracted from this instance and</span>
<span class="sd">        returns a new Ticktock instance. If a Ticktock is subtracted from another</span>
<span class="sd">        Ticktock then a list of timedeltas is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        other : Ticktock or datetime.timedelta</span>
<span class="sd">            instance for comparison</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; dt = datetime.timedelta(3)</span>
<span class="sd">        &gt;&gt;&gt; a - dt</span>
<span class="sd">        Ticktock( [&#39;2002-02-05T12:00:00&#39;] ), dtype=ISO</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        __add__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
            <span class="n">newobj</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">-</span> <span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Ticktock</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Ticktock lengths are mismatched, subtraction is not possible&#39;</span><span class="p">)</span>
            <span class="n">same</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">same</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">same</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">t</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">TAI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">t</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">TAI</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data supplied for addition is of the wrong type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data supplied for addition is of the wrong shape&quot;</span><span class="p">)</span>
            <span class="n">same</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">same</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">same</span><span class="p">:</span>
                <span class="n">newUTC</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span> <span class="o">-</span> <span class="n">o</span> <span class="k">for</span> <span class="n">utc</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span> <span class="n">other</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newUTC</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span> <span class="o">-</span> <span class="n">other</span> <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">]</span>
            <span class="n">newobj</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">newUTC</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unsupported operand type(s) for -: </span><span class="si">{0}</span><span class="s2"> and </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">newobj</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__add__(other)</span>

<span class="sd">        Will be called if an iterable of datetime.timedeltas is added to this instance and</span>
<span class="sd">        returns a new Ticktock instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        other : datetime.timedelta</span>
<span class="sd">            instance for comparison</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; import datetime as dt</span>
<span class="sd">        &gt;&gt;&gt; delt = dt.timedelta(minutes=1)</span>
<span class="sd">        &gt;&gt;&gt; a + delt</span>
<span class="sd">        Ticktock( [&#39;2002-02-02T12:01:00&#39;] , dtype=ISO)</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        __sub__</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
            <span class="n">newobj</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">+</span> <span class="n">other</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data supplied for addition is of the wrong type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data supplied for addition is of the wrong shape&quot;</span><span class="p">)</span>
            <span class="n">same</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">same</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">same</span><span class="p">:</span>
                <span class="n">newUTC</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span> <span class="o">+</span> <span class="n">o</span> <span class="k">for</span> <span class="n">utc</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span> <span class="n">other</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newUTC</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span> <span class="o">+</span> <span class="n">other</span> <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">]</span>
            <span class="n">newobj</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">newUTC</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unsupported operand type(s) for +: </span><span class="si">{0}</span><span class="s2"> and </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">newobj</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__radd__(other)</span>

<span class="sd">        reverse add -- Will be called if this object is added to a datetime.timedelta and</span>
<span class="sd">        returns a new Ticktock instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        other : datetime.timedelta</span>
<span class="sd">            instance for comparison</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; import datetime as dt</span>
<span class="sd">        &gt;&gt;&gt; delt = dt.timedelta(minutes=1)</span>
<span class="sd">        &gt;&gt;&gt; a + delt</span>
<span class="sd">        Ticktock( [&#39;2002-02-02T12:01:00&#39;] , dtype=ISO)</span>


<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        __sub__</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.__getattr__(name)</span>

<span class="sd">        Will be called if attribute &quot;name&quot; is not found in Ticktock class instance.</span>
<span class="sd">        It will add TAI, RDT, etc</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">            name : string</span>
<span class="sd">                a string from the list of time systems</span>
<span class="sd">                    &#39;UTC&#39;, &#39;TAI&#39;, &#39;ISO&#39;, &#39;JD&#39;, &#39;MJD&#39;, &#39;UNX&#39;, &#39;RDT&#39;, &#39;CDF&#39;, &#39;DOY&#39;, &#39;eDOY&#39;, &#39;leaps&#39;</span>
<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">            out: list, array</span>
<span class="sd">                requested values as either list/numpy array</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ticktock</span><span class="o">.</span><span class="n">_keylist</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;data type </span><span class="si">{}</span><span class="s2"> not provided, only </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">Ticktock</span><span class="o">.</span><span class="n">_keylist</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TAI&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTAI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;UTC&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUTC</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getISO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;JD&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">JD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJD</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MJD&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMJD</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;UNX&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUNX</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;RDT&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRDT</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CDF&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCDF</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DOY&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">DOY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDOY</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;EDOY&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eDOY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geteDOY</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGPS</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;APT&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">APT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAPT</span><span class="p">()</span>
        <span class="c1"># if name == &#39;isoformat&#39;: self.__isofmt = self.isoformat()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leaps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getleapsecs</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        insert values into the TickTock object</span>

<span class="sd">        .. note:: If more than one value to insert a slice must be specified</span>
<span class="sd">        as the index.  See numpy.insert</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">            idx : int, slice or sequence of ints</span>
<span class="sd">                Object that defines the index or indices before which `val` is inserted.</span>
<span class="sd">            val : array_like</span>
<span class="sd">                values to insert</span>
<span class="sd">            dtype : str (optional)</span>
<span class="sd">                must be specified if not CDF, ISO, or UTC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="n">dum</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dum</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">ival</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dum</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ival</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_items</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.remove(idx)</span>

<span class="sd">        This will remove the Ticktock value at index idx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.sort"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;quicksort&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.sort()</span>

<span class="sd">        This will sort the Ticktock values in place based on the values</span>
<span class="sd">        in `data`. If you need a stable sort use kind=&#39;mergesort&#39;</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        kind : str</span>
<span class="sd">            Sort algorithm to use, default &#39;quicksort&#39;.</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        argsort, numpy.argsort</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_items</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.argsort"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.argsort">[docs]</a>    <span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;quicksort&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        idx = a.argsort()</span>

<span class="sd">        This will return the indices that would sort the Ticktock values</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : list</span>
<span class="sd">            indices that would sort the Ticktock values</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        kind : str, optional</span>
<span class="sd">            Sort algorithm to use, default &#39;quicksort&#39;.</span>

<span class="sd">            .. versionchanged:: 0.2.2</span>
<span class="sd">                Default is now &#39;quicksort&#39; to match numpy default;</span>
<span class="sd">                previously was &#39;mergesort&#39;.</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        argsort, numpy.argsort</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.isoformat"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.isoformat">[docs]</a>    <span class="k">def</span> <span class="nf">isoformat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.update_items(b, attrib)</span>

<span class="sd">        This changes the self._isofmt attribute by and subsequently this</span>
<span class="sd">        function will update the ISO attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        fmt : string, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current ISO output format is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Options are: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">Ticktock</span><span class="o">.</span><span class="n">_isoformatstr</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ticktock</span><span class="o">.</span><span class="n">_isoformatstr</span><span class="o">.</span><span class="n">keys</span><span class="p">())]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="o">.</span><span class="n">_isoformatstr</span><span class="p">[</span><span class="n">fmt</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_items</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not a valid option: Use </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Ticktock</span><span class="o">.</span><span class="n">_isoformatstr</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.update_items"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.update_items">[docs]</a>    <span class="k">def</span> <span class="nf">update_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.update_items(attrib)</span>

<span class="sd">        After changing the self.data attribute by either __setitem__ or __add__ etc</span>
<span class="sd">        this function will update all other attributes. This function is</span>
<span class="sd">        called automatically in __add__, __init__, and __setitem__.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        attrib : str</span>
<span class="sd">            attribute that was updated; update others from this</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        cls : type</span>
<span class="sd">            .. deprecated:: 0.2.2</span>
<span class="sd">                Class is now taken from the ``self`` of the bound instance.</span>

<span class="sd">            Class to use for finding possible attributes; now ignored.</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        spacepy.Ticktock.__setitem__</span>
<span class="sd">        spacepy.Ticktock.__add__</span>
<span class="sd">        spacepy.Ticktock.__sub__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keylist</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Formerly took arguments (cls, attrib) but there&#39;s nothing from</span>
        <span class="c1"># the class we can&#39;t get from the instance, so removed cls.</span>
        <span class="c1"># If we got two position arguments, though, that indicates the cls</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrib</span> <span class="o">=</span> <span class="bp">cls</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;cls argument of update_items was deprecated in 0.2.2&#39;</span>
                <span class="s1">&#39; and will be ignored.&#39;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">keylist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrib</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="n">keylist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
            <span class="n">attrib</span> <span class="o">=</span> <span class="n">attrib</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">attrib</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]:</span>
                <span class="c1"># Repopulating based on a different dtype, so make a temp</span>
                <span class="c1"># Ticktock to do the conversion.</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">attrib</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s1">&#39;TAI&#39;</span><span class="p">,</span> <span class="s1">&#39;GPS&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;MJD&#39;</span><span class="p">,</span> <span class="s1">&#39;RDT&#39;</span><span class="p">,</span> <span class="s1">&#39;CDF&#39;</span><span class="p">,</span> <span class="s1">&#39;UNX&#39;</span><span class="p">,</span> <span class="s1">&#39;ISO&#39;</span><span class="p">,</span> <span class="s1">&#39;APT&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;UTC&#39;</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="c1"># Force recalc of UTC in TAI calc</span>
                <span class="k">if</span> <span class="s1">&#39;ISO&#39;</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="c1"># Also will recalc the ISO</span>
                    <span class="k">del</span> <span class="n">keylist</span><span class="p">[</span><span class="n">keylist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;ISO&#39;</span><span class="p">)]</span> <span class="c1"># So no need to calc again</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTAI</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;UTC&#39;</span> <span class="ow">in</span> <span class="n">keylist</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUTC</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUTC</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;TAI&#39;</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTAI</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getISO</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;JD&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">JD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJD</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MJD&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMJD</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;UNX&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUNX</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;RDT&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRDT</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CDF&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCDF</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DOY&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">DOY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDOY</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;EDOY&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eDOY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geteDOY</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGPS</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;APT&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">APT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAPT</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;leaps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getleapsecs</span><span class="p">()</span>

        <span class="k">return</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.convert"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.convert(dtype)</span>

<span class="sd">        convert a Ticktock instance into a new time coordinate system provided in dtype</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        dtype : string</span>
<span class="sd">            data type for new system, possible values are {`CDF`, `ISO`, `UTC`, `TAI`, `UNX`, `JD`, `MJD`, `RDT`}</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : Ticktock</span>
<span class="sd">            Ticktock instance with new time coordinates</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock([&#39;2002-02-02T12:00:00&#39;, &#39;2002-02-02T12:00:00&#39;], &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; s = a.convert(&#39;TAI&#39;)</span>
<span class="sd">        &gt;&gt;&gt; type(s)</span>
<span class="sd">        &lt;class &#39;time.Ticktock&#39;&gt;</span>
<span class="sd">        &gt;&gt;&gt; s</span>
<span class="sd">        Ticktock( [1391342432 1391342432] ), dtype=TAI</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        CDF</span>
<span class="sd">        ISO</span>
<span class="sd">        UTC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newdat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">newdat</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.append"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.append(other)</span>

<span class="sd">        Will be called when another Ticktock instance has to be appended to the current one</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        other : Ticktock</span>
<span class="sd">            other (Ticktock instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">otherdata</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">otherdata</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">])</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getCDF"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getCDF">[docs]</a>    <span class="k">def</span> <span class="nf">getCDF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.getCDF() or a.CDF</span>

<span class="sd">        Return CDF Epoch time which is milliseconds since 0000-1-1 at</span>
<span class="sd">        00:00:00.000. &quot;Year zero&quot; is a convention chosen by NSSDC to measure</span>
<span class="sd">        epoch values. This date is more commonly referred to as 1 BC and is</span>
<span class="sd">        considered a leap year.</span>

<span class="sd">        The CDF date/time calculations do not take into account the change</span>
<span class="sd">        to the Gregorian calendar or leap seconds, and cannot be directly</span>
<span class="sd">        converted into Julian date/times.</span>

<span class="sd">        Returns ``data`` if it was provided in CDF; otherwise always</span>
<span class="sd">        recalculates from the current value of ``TAI``, which will be</span>
<span class="sd">        created if necessary.</span>

<span class="sd">        Updates the ``CDF`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            milliseconds since 0000-01-01T00:00:00 assuming no discontinuities.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.CDF</span>
<span class="sd">        array([  6.31798704e+13])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC</span>
<span class="sd">        getUNX</span>
<span class="sd">        getRDT</span>
<span class="sd">        getJD</span>
<span class="sd">        getMJD</span>
<span class="sd">        getISO</span>
<span class="sd">        getTAI</span>
<span class="sd">        getDOY</span>
<span class="sd">        geteDOY</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CDF&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span>
        <span class="n">CDFofTAI0</span> <span class="o">=</span> <span class="mf">61788528000000.</span>
        <span class="n">naive_tai</span> <span class="o">=</span> <span class="n">_tai_real_to_naive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">naive_tai</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">+</span> <span class="n">CDFofTAI0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;CDF&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CDF</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getDOY"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getDOY">[docs]</a>    <span class="k">def</span> <span class="nf">getDOY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.DOY or a.getDOY()</span>

<span class="sd">        extract DOY (days since January 1st of given year)</span>

<span class="sd">        Always recalculates from the current value of ``UTC``, which will</span>
<span class="sd">        be created if necessary.</span>

<span class="sd">        Updates the ``DOY`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            day of the year</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.DOY</span>
<span class="sd">        array([ 33])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC</span>
<span class="sd">        getUNX</span>
<span class="sd">        getRDT</span>
<span class="sd">        getJD</span>
<span class="sd">        getMJD</span>
<span class="sd">        getISO</span>
<span class="sd">        getTAI</span>
<span class="sd">        getDOY</span>
<span class="sd">        geteDOY</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DOY</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">utc</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOY</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">DOY</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;DOY&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DOY</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.geteDOY"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.geteDOY">[docs]</a>    <span class="k">def</span> <span class="nf">geteDOY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.eDOY or a.geteDOY()</span>

<span class="sd">        extract eDOY (elapsed days since midnight January 1st of given year)</span>

<span class="sd">        Always recalculates from the current value of ``UTC``, which will</span>
<span class="sd">        be created if necessary.</span>

<span class="sd">        Updates the ``eDOY`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            days elapsed since midnight bbedJan. 1st</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.eDOY</span>
<span class="sd">        array([ 32.5])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC</span>
<span class="sd">        getUNX</span>
<span class="sd">        getRDT</span>
<span class="sd">        getJD</span>
<span class="sd">        getMJD</span>
<span class="sd">        getISO</span>
<span class="sd">        getTAI</span>
<span class="sd">        getDOY</span>
<span class="sd">        geteDOY</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eDOY</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">utc</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">]</span>
        <span class="n">eDOY</span> <span class="o">=</span> <span class="p">[</span><span class="n">edoy</span> <span class="o">+</span> <span class="n">utc</span><span class="o">.</span><span class="n">hour</span> <span class="o">/</span> <span class="mf">24.</span> <span class="o">+</span> <span class="n">utc</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mf">1440.</span> <span class="o">+</span> <span class="n">utc</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mf">86400.</span> <span class="o">+</span> <span class="n">utc</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mf">86400000000.</span>
                <span class="k">for</span> <span class="n">edoy</span><span class="p">,</span> <span class="n">utc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">eDOY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eDOY</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">eDOY</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;eDOY&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eDOY</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getJD"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getJD">[docs]</a>    <span class="k">def</span> <span class="nf">getJD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.JD or a.getJD()</span>

<span class="sd">        convert dtype data into Julian Date (JD)</span>

<span class="sd">        Returns ``data`` if it was provided in JD; otherwise always</span>
<span class="sd">        recalculates from the current value of ``TAI``, which will be</span>
<span class="sd">        created if necessary.</span>

<span class="sd">        Updates the ``JD`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            elapsed days since 4713 BCE 01-01T12:00</span>

<span class="sd">        Notes</span>
<span class="sd">        =====</span>
<span class="sd">        This is based on the UTC day, defined as JD(UTC) - 2 400 000.5,</span>
<span class="sd">        per the recommendation</span>
<span class="sd">        of `IAU General Assembly XXIII resolution B1</span>
<span class="sd">        &lt;https://www.iers.org/IERS/EN/Science/Recommendations/</span>
<span class="sd">        resolutionB1.html&gt;`_.</span>
<span class="sd">        Julian days with leapseconds are 86401 seconds long and each second</span>
<span class="sd">        is a smaller fraction of the day. Note this &quot;stretching&quot; is across</span>
<span class="sd">        the *Julian* Day, noon to noon.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.JD</span>
<span class="sd">        array([ 2452308.])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC</span>
<span class="sd">        getUNX</span>
<span class="sd">        getRDT</span>
<span class="sd">        getJD</span>
<span class="sd">        getMJD</span>
<span class="sd">        getISO</span>
<span class="sd">        getTAI</span>
<span class="sd">        getDOY</span>
<span class="sd">        geteDOY</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;JD&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">JD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">JD</span>
        <span class="c1"># 1958-01-01T12:00 is JD 2436205.0</span>
        <span class="n">JDofTAI0</span> <span class="o">=</span> <span class="mf">2436205.0</span> <span class="c1"># Days-since-1958 is relative to noon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">JD</span> <span class="o">=</span> <span class="n">_days1958</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;rubber&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">JDofTAI0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">JD</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getMJD"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getMJD">[docs]</a>    <span class="k">def</span> <span class="nf">getMJD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.MJD or a.getMJD()</span>

<span class="sd">        convert dtype data into MJD (modified Julian date)</span>

<span class="sd">        Returns ``data`` if it was provided in MJD; otherwise always</span>
<span class="sd">        recalculates from the current value of ``TAI`` which will be</span>
<span class="sd">        created if necessary.</span>

<span class="sd">        Updates the ``MJD`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            elapsed days since 1858-11-17T00:00</span>
<span class="sd">            (Julian date of 1858-11-17T12:00 was 2 400 000)</span>

<span class="sd">        Notes</span>
<span class="sd">        =====</span>
<span class="sd">        This is based on the UTC day, defined as JD(UTC) - 2 400 000.5,</span>
<span class="sd">        per the recommendation</span>
<span class="sd">        of `IAU General Assembly XXIII resolution B1</span>
<span class="sd">        &lt;https://www.iers.org/IERS/EN/Science/Recommendations/</span>
<span class="sd">        resolutionB1.html&gt;`_.</span>
<span class="sd">        Julian days with leapseconds are 86401 seconds long and each second</span>
<span class="sd">        is a smaller fraction of the day. Note this &quot;stretching&quot; is across</span>
<span class="sd">        the *Julian* Day not the MJD, so it will affect the last half of</span>
<span class="sd">        the MJD before the leap second and the first half of the following</span>
<span class="sd">        MJD, so that MJD is always JD - 2 400 000.5 This also means that</span>
<span class="sd">        the MJD following a leap second does not begin exactly at midnight.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.MJD</span>
<span class="sd">        array([ 52307.5])</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2009-01-01T00:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.MJD</span>
<span class="sd">        array([ 54832.00000579])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC, getUNX, getRDT, getJD, getISO, getCDF, getTAI, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MJD&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span>

        <span class="c1"># 1958-01-01T12:00 is MJD 36204.5 (days since 1858-11-17T00:00)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span> <span class="o">=</span> <span class="n">_days1958</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;rubber&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">36204.5</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getUNX"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getUNX">[docs]</a>    <span class="k">def</span> <span class="nf">getUNX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.UNX or a.getUNX()</span>

<span class="sd">        convert dtype data into Unix Time (Posix Time)</span>
<span class="sd">        seconds since 1970-1-1 (not counting leap seconds)</span>

<span class="sd">        Returns ``data`` if it was provided in UNX; otherwise always</span>
<span class="sd">        recalculates from the current value of ``TAI``, which will be</span>
<span class="sd">        created if necessary.</span>

<span class="sd">        Updates the ``UNX`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            elapsed secs since 1970-1-1 (not counting leap secs)</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.UNX</span>
<span class="sd">        array([  1.01265120e+09])</span>

<span class="sd">        See Also</span>
<span class="sd">        =========</span>
<span class="sd">        getUTC, getISO, getRDT, getJD, getMJD, getCDF, getTAI, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;UNX&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span>
        <span class="n">naive_tai</span> <span class="o">=</span> <span class="n">_tai_real_to_naive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">)</span>
        <span class="n">UNXofTAI0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">378691200.</span>
        <span class="n">unx</span> <span class="o">=</span> <span class="n">naive_tai</span> <span class="o">+</span> <span class="n">UNXofTAI0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">unx</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;UNX&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNX</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getRDT"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getRDT">[docs]</a>    <span class="k">def</span> <span class="nf">getRDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.RDT or a.RDT()</span>

<span class="sd">        convert dtype data into Rata Die (lat.) Time, or elapsed days</span>
<span class="sd">        counting 0001-01-01 as day 1. This is a naive conversion: it</span>
<span class="sd">        ignores the existence of leapseconds for fractional days and</span>
<span class="sd">        ignores the conversion from Julian to Gregorian calendar, i.e.</span>
<span class="sd">        it assumes Gregorian calendar infinitely into the past.</span>

<span class="sd">        Returns ``data`` if it was provided in RDT; otherwise always</span>
<span class="sd">        recalculates from the current value of ``TAI``, which will be</span>
<span class="sd">        created if necessary.</span>

<span class="sd">        Updates the ``RDT`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            elapsed days counting 1/1/1 as day 1.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.RDT</span>
<span class="sd">        array([ 730883.5])</span>

<span class="sd">        See Also</span>
<span class="sd">        =========</span>
<span class="sd">        getUTC, getUNX, getISO, getJD, getMJD, getCDF, getTAI, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RDT&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span>

        <span class="c1"># RDT date at 1958-1-1T00</span>
        <span class="n">RDTTAI0</span> <span class="o">=</span> <span class="mf">714780.0</span>
        <span class="n">RDT</span> <span class="o">=</span> <span class="n">_days1958</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="n">midnight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">RDTTAI0</span>
        <span class="c1"># RDT can represent 1582-10-5 through 1582-10-14, which do not exist.</span>
        <span class="c1"># So everything before 1582-10-15 (RDT day 577736) is ten days earlier.</span>
        <span class="n">RDT</span><span class="p">[</span><span class="n">RDT</span> <span class="o">&lt;</span> <span class="mf">577736.0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">RDT</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;RDT&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RDT</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getUTC"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getUTC">[docs]</a>    <span class="k">def</span> <span class="nf">getUTC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.UTC or a.getUTC()</span>

<span class="sd">        convert dtype data into UTC object a la datetime()</span>

<span class="sd">        Return value comes from (in priority order):</span>

<span class="sd">            1. If ``data`` was provided in UTC, returns ``data``.</span>
<span class="sd">            2. Else recalculates directly from ``data`` if it was</span>
<span class="sd">               provided in ISO.</span>
<span class="sd">            3. Else calculates from current value of ``TAI``, which</span>
<span class="sd">               will be created if necessary. (``data`` is TAI, GPS,</span>
<span class="sd">               JD, MJD, RDT, CDF, UNX)).</span>

<span class="sd">        Updates the ``UTC`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">        out : list of datetime objects</span>
<span class="sd">            datetime object in UTC time</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.UTC</span>
<span class="sd">        [datetime.datetime(2002, 2, 2, 12, 0)]</span>

<span class="sd">        See Also</span>
<span class="sd">        =========</span>
<span class="sd">        getISO, getUNX, getRDT, getJD, getMJD, getCDF, getTAI, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nTAI</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># if already UTC, we are done, no conversion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;UTC&#39;</span><span class="p">:</span>
            <span class="n">UTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">UTC</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dtstr2iso</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s1">&#39;TAI&#39;</span><span class="p">,</span> <span class="s1">&#39;GPS&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;MJD&#39;</span><span class="p">,</span> <span class="s1">&#39;RDT&#39;</span><span class="p">,</span> <span class="s1">&#39;CDF&#39;</span><span class="p">,</span> <span class="s1">&#39;UNX&#39;</span><span class="p">,</span> <span class="s1">&#39;APT&#39;</span><span class="p">):</span>
            <span class="n">TAI0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1958</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">UTC</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
                <span class="c1"># Before 1582-10-15, UTC 10 days earlier than naive conversion</span>
                <span class="c1"># since those dates are Julian not Gregorian.</span>
                <span class="n">seconds</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tait</span> <span class="o">-</span> <span class="p">(</span><span class="mi">864000</span> <span class="k">if</span> <span class="n">tait</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">11840601600.0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)))</span>
                   <span class="o">+</span> <span class="n">TAI0</span> <span class="k">for</span> <span class="n">tait</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTAI</span><span class="p">):</span>
                <span class="c1"># This is the index of number of seconds to subtract from</span>
                <span class="c1"># &quot;naive&quot; UTC, not just TAI - UTC.</span>
                <span class="c1"># TAI of leap second does not have a new TAI - UTC, this</span>
                <span class="c1"># is because UTC seconds = 60, but need to subtract off</span>
                <span class="c1"># one more to make the UTC seconds = 59 in that case, thus</span>
                <span class="c1"># &quot;flip&quot; to next leap second count 1s earlier.</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">TAIleaps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">secs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                                                          <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">TAIleaps</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                    <span class="c1"># TAI is in leap second</span>
                    <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">999999</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnstr1</span> <span class="o">=</span> <span class="s1">&#39;Input data type </span><span class="si">{0}</span><span class="s1"> does not support calculation of UTC times&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">])</span>
            <span class="n">warnstr2</span> <span class="o">=</span> <span class="s1">&#39;Valid input dtypes are: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">kk</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Ticktock</span><span class="o">.</span><span class="n">_keylist</span> <span class="k">if</span> <span class="n">kk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DOY&#39;</span><span class="p">,</span> <span class="s1">&#39;eDOY&#39;</span><span class="p">,</span> <span class="s1">&#39;leaps&#39;</span><span class="p">]]))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">warnstr1</span><span class="p">,</span> <span class="n">warnstr2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">UTC</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;UTC&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getGPS"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getGPS">[docs]</a>    <span class="k">def</span> <span class="nf">getGPS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.GPS or a.getGPS()</span>

<span class="sd">        Return seconds since the GPS epoch (1980-1-6T00:00 UT)</span>

<span class="sd">        Always recalculates from the current value of ``TAI``, which</span>
<span class="sd">        will be created if necessary.</span>

<span class="sd">        Updates the ``GPS`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">            out : numpy array</span>
<span class="sd">                elapsed secs since 1980-1-6. Leap seconds are counted;</span>
<span class="sd">                i.e. there are no discontinuities.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.GPS</span>
<span class="sd">        dmarray([6.96686413e+08])</span>

<span class="sd">        See Also</span>
<span class="sd">        =========</span>
<span class="sd">        getUTC, getUNX, getRDT, getJD, getMJD, getCDF, getISO, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span>
        <span class="n">GPS0</span> <span class="o">=</span> <span class="mi">694656019</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">-</span> <span class="n">GPS0</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;GPS&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getAPT"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getAPT">[docs]</a>    <span class="k">def</span> <span class="nf">getAPT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.APT or a.getAPT()</span>

<span class="sd">        Return AstroPy time object.</span>

<span class="sd">        Always recalculates from the current value of ``TAI``, which</span>
<span class="sd">        will be created if necessary.</span>

<span class="sd">        Updates the ``APT`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        ========</span>
<span class="sd">            out : astropy.time.Time</span>
<span class="sd">                AstroPy Time object</span>

<span class="sd">        Notes</span>
<span class="sd">        =====</span>
<span class="sd">        .. versionadded:: 0.2.2</span>

<span class="sd">        Requires AstroPy 1.0. The returned value will be on the ``tai``</span>
<span class="sd">        scale in ``gps`` format (unless the :class:`Ticktock` was created</span>
<span class="sd">        from a :class:`~astropy.time.Time` object, in which case it will</span>
<span class="sd">        be the original input.) See the :mod:`astropy.time` docs for</span>
<span class="sd">        conversion to other scales and formats.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.APT</span>
<span class="sd">        &lt;Time object: scale=&#39;tai&#39; format=&#39;gps&#39; value=696686413.0&gt;</span>

<span class="sd">        See Also</span>
<span class="sd">        =========</span>
<span class="sd">        getUTC, getUNX, getRDT, getJD, getMJD, getCDF, getISO, getDOY, geteDOY,</span>
<span class="sd">        getGPS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;APT&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">APT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">APT</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAVE_ASTROPY</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Import of astropy.time failed.&#39;</span><span class="p">)</span>
        <span class="n">GPS0</span> <span class="o">=</span> <span class="mi">694656019</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">APT</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">-</span> <span class="n">GPS0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;tai&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;gps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">APT</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;APT&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">APT</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getTAI"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getTAI">[docs]</a>    <span class="k">def</span> <span class="nf">getTAI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.TAI or a.getTAI()</span>

<span class="sd">        return TAI (International Atomic Time), elapsed secs since 1958-1-1</span>
<span class="sd">        (leap seconds are counted.) Ticktock&#39;s handling of TAI and UTC</span>
<span class="sd">        conversions treats the UTC second as always equal in length to the SI</span>
<span class="sd">        second (and thus TAI), ignoring frequency changes and fractional</span>
<span class="sd">        leap seconds from 1958 through 1972, i.e. the UTC to TAI offset</span>
<span class="sd">        is always treated as an integer, truncated (not rounded) from the</span>
<span class="sd">        value at the most recent leap second (or fraction thereof).</span>

<span class="sd">        Return value comes from (in priority order):</span>

<span class="sd">            1. If ``data`` was provided in TAI, returns ``data``.</span>
<span class="sd">            2. Else recalculates directly from ``data`` if it was</span>
<span class="sd">               provided in APT, CDF, GPS, ISO, JD, MJD, RDT, or UNX.</span>
<span class="sd">            3. Else calculates from current value of ``UTC``, which</span>
<span class="sd">               will be created if necessary.</span>

<span class="sd">        Updates the ``TAI`` attribute; will also create the ``UTC``</span>
<span class="sd">        and ``ISO`` attributes from ``data`` if input is in ``ISO``</span>
<span class="sd">        (but will not overwrite an existing ``ISO`` or ``UTC``). This is</span>
<span class="sd">        for efficiency, as computation from ISO requires calculating UTC</span>
<span class="sd">        and makes creating a formatted ISO string easy.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            TAI as seconds since 1958-1-1.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.TAI</span>
<span class="sd">        array([1391342432])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC, getUNX, getRDT, getJD, getMJD, getCDF, getISO, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TAI&#39;</span><span class="p">:</span>
            <span class="c1"># This should be the case from the constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">:</span>
            <span class="n">GPS0</span> <span class="o">=</span> <span class="mi">694656019</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">GPS0</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MJD&#39;</span><span class="p">:</span>
            <span class="n">MJDofTAI0</span> <span class="o">=</span> <span class="mf">36204.5</span> <span class="c1"># Days-since-1958 is relative to noon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                <span class="n">_days1958totai</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">MJDofTAI0</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;rubber&#39;</span><span class="p">,</span> <span class="n">midnight</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;JD&#39;</span><span class="p">:</span>
            <span class="n">JDofTAI0</span> <span class="o">=</span> <span class="mf">2436205.0</span> <span class="c1"># Days-since-1958 is relative to noon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                <span class="n">_days1958totai</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">JDofTAI0</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;rubber&#39;</span><span class="p">,</span> <span class="n">midnight</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RDT&#39;</span><span class="p">:</span>
            <span class="n">RDTofTAI0</span> <span class="o">=</span> <span class="mf">714780.</span> <span class="c1">#RDT date of 1958-1-1T00</span>
            <span class="n">tai</span> <span class="o">=</span> <span class="n">_days1958totai</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">RDTofTAI0</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="n">midnight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Anything before 1582-10-5 has TAI ten days later than the</span>
            <span class="c1"># naive conversion, because RDT has ten days that are not in TAI.</span>
            <span class="n">tai</span><span class="p">[</span><span class="n">tai</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">11840601600.0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">864000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">tai</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CDF&#39;</span><span class="p">:</span>
            <span class="n">CDFofTAI0</span> <span class="o">=</span> <span class="mf">61788528000000.0</span>
            <span class="c1"># Naive TAI conversion</span>
            <span class="n">tai</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">CDFofTAI0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.e3</span>
            <span class="n">tai</span> <span class="o">=</span> <span class="n">_tai_naive_to_real</span><span class="p">(</span><span class="n">tai</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">tai</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;UNX&#39;</span><span class="p">:</span>
            <span class="n">UNXofTAI0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">378691200.</span>
            <span class="c1"># Naive TAI</span>
            <span class="n">tai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">UNXofTAI0</span>
            <span class="n">tai</span> <span class="o">=</span> <span class="n">_tai_naive_to_real</span><span class="p">(</span><span class="n">tai</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">tai</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;APT&#39;</span><span class="p">:</span>
            <span class="c1"># AstroPy time doesn&#39;t support TAI directly, have to go relative</span>
            <span class="c1"># to GPS. But since it&#39;s a simple offset, just do the math here</span>
            <span class="c1"># instead of via the GPS attribute.</span>
            <span class="n">GPS0</span> <span class="o">=</span> <span class="mi">694656019</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">gps</span> <span class="o">+</span> <span class="n">GPS0</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span>
            <span class="n">isoout</span><span class="p">,</span> <span class="n">UTC</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">dtstr2iso</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;UTC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                    <span class="n">UTC</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;UTC&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="s1">&#39;ISO&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                    <span class="n">isoout</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">UTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">TAI0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1958</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">leapsec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getleapsecs</span><span class="p">()</span>
        <span class="n">TAItup</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span> <span class="o">-</span> <span class="n">TAI0</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">))</span> <span class="k">for</span> <span class="n">utc</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">UTC</span><span class="p">,</span> <span class="n">leapsec</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">TAI</span> <span class="o">=</span> <span class="p">[</span><span class="n">tai</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">tai</span><span class="o">.</span><span class="n">seconds</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">tai</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span> <span class="mf">1.e6</span>
                   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tai</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TAItup</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">TAI</span> <span class="o">=</span> <span class="p">[</span><span class="n">tai</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">tai</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">tai</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">1.e6</span>
                   <span class="k">for</span> <span class="n">tai</span> <span class="ow">in</span> <span class="n">TAItup</span><span class="p">]</span>

        <span class="n">TAI</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">TAI</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;TAI&#39;</span><span class="p">})</span>
        <span class="c1"># 1582-10-5 through 1582-10-14 do not exist, so anything</span>
        <span class="c1"># before 1582-10-15 is 10 TAI days later than the naive conversion.</span>
        <span class="n">TAI</span><span class="p">[</span><span class="n">TAI</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">11840601600.0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">86400</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="n">TAI</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getISO"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getISO">[docs]</a>    <span class="k">def</span> <span class="nf">getISO</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.ISO or a.getISO()</span>

<span class="sd">        convert dtype data into ISO string</span>

<span class="sd">        Always recalculates from the current value of ``UTC``, which</span>
<span class="sd">        will be created if necessary. Applies leapsecond correction</span>
<span class="sd">        based on ``TAI``, also created as necessary.</span>

<span class="sd">        Updates the ``ISO`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : list of strings</span>
<span class="sd">            date in ISO format</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.ISO</span>
<span class="sd">        dmarray([&#39;2002-02-02T12:00:00&#39;])</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        getUTC, getUNX, getRDT, getJD, getMJD, getCDF, getTAI, getDOY, geteDOY,</span>
<span class="sd">        getAPT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span> <span class="c1"># Convert the string directly.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span>
                <span class="n">dtstr2iso</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span>
        <span class="n">nTAI</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTAI</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">iso</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="p">)</span> <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c1"># Python before 3.3 fails on strftime before 1900.</span>
            <span class="n">iso</span> <span class="o">=</span> <span class="p">[</span><span class="n">utc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">1900</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">utc</span><span class="o">.</span><span class="n">year</span><span class="p">)))</span> <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">iso</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO&#39;</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTAI</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">in</span> <span class="n">TAIleaps</span><span class="p">:</span>
                <span class="c1"># UTC is 23:59:59.9999, get correct number of microseconds</span>
                <span class="n">tmpdt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">microsecond</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">TAI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">))</span>
                <span class="c1"># And fudge the second</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">tmpdt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isofmt</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">cnew</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;59&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">cnew</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISO</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.getleapsecs"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.getleapsecs">[docs]</a>    <span class="k">def</span> <span class="nf">getleapsecs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a.leaps or a.getleapsecs()</span>

<span class="sd">        retrieve leapseconds from lookup table, used in getTAI</span>

<span class="sd">        Always recalculates from current value of ``TAI`` if ``data``</span>
<span class="sd">        is dtype ``TAI``, otherwise from the current value of ``UTC``,</span>
<span class="sd">        which will be created if necessary.</span>

<span class="sd">        Updates the ``leaps`` attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : numpy array</span>
<span class="sd">            leap seconds</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>
<span class="sd">        &gt;&gt;&gt; a = Ticktock(&#39;2002-02-02T12:00:00&#39;, &#39;ISO&#39;)</span>
<span class="sd">        &gt;&gt;&gt; a.leaps</span>
<span class="sd">        array([32])</span>

<span class="sd">        See Also</span>
<span class="sd">        =========</span>
<span class="sd">        getTAI</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TAI&#39;</span><span class="p">:</span>
            <span class="c1"># TAIleaps contains the TAI which IS the leap second.</span>
            <span class="c1"># The leap second count increments in the NEXT second.</span>
            <span class="c1"># (TAI - UTC changes at end of leap second.)</span>
            <span class="c1"># So find the latest index where the TAI-after-leap-second</span>
            <span class="c1"># is less than current TAI (i.e. we are not after leap second yet).</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">TAIleaps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">secs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTC</span>

        <span class="c1"># check if array:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tup</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>  <span class="c1"># not an array of objects</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">tup</span><span class="p">]</span>
            <span class="n">nTAI</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">aflag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nTAI</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
            <span class="n">aflag</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># convert them into a time tuple and find the correct leap seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAIleaps</span> <span class="o">=</span> <span class="n">TAIleaps</span>
        <span class="n">leaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">secs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">nTAI</span>
        <span class="n">leap_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="k">for</span>
                      <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">secs</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">itup</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">leap_dates</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">leaps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">secs</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">ind</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1">## ldatetime = datetime.datetime # avoid an expensive lookup below</span>
        <span class="c1">## for i, itup in enumerate(tup):</span>
        <span class="c1">##     for y,m,d,s in zip(year, mon, day, secs):</span>
        <span class="c1">##         if tup[i] &gt;= ldatetime(int(y),int(m),int(d)):</span>
        <span class="c1">##             leaps[i] = s</span>
        <span class="c1">##         else:</span>
        <span class="c1">##             break</span>

        <span class="c1"># if datetime.datetime(1971,12,31) &gt; tup[0]:</span>
        <span class="c1">#   print &quot;WARNING: date before 1972/1/1; leap seconds are by fractions off&quot;</span>

        <span class="k">if</span> <span class="n">aflag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leaps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># if you want to allow fractional leap seconds, remove &#39;int&#39; here</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">leaps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaps</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.now"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.now">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create Ticktock with the current UTC time.</span>

<span class="sd">        Equivalent to datetime.utcnow()</span>

<span class="sd">        .. versionchanged:: 0.2.2</span>
<span class="sd">            This now returns a UTC time; previously it returned a Ticktock</span>
<span class="sd">            UTC object, but in the local timezone, which made all conversions</span>
<span class="sd">            incorrect.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : ticktock</span>
<span class="sd">            Ticktock object with the current time, equivalent to datetime.utcnow()</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        datetime.datetime.now, datetime.datetime.utcnow</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;now() returns UTC time as of 0.2.2.&#39;</span><span class="p">,</span>
                      <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="Ticktock.today"><a class="viewcode-back" href="../../autosummary/spacepy.time.Ticktock.html#spacepy.time.Ticktock.today">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create Ticktock with the current UTC date and time set to 00:00:00</span>

<span class="sd">        Similar to date.today() with time included but in UTC and with the</span>
<span class="sd">        time included (zero hours, minutes, seconds)</span>

<span class="sd">        .. versionchanged:: 0.2.2</span>
<span class="sd">            This now returns the UTC day; previously it returned a Ticktock</span>
<span class="sd">            UTC object, but in the local timezone, which made all conversions</span>
<span class="sd">            incorrect.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">            out : ticktock</span>
<span class="sd">                Ticktock object with the current UTC day</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>
<span class="sd">        datetime.date.today</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;today() returns UTC day as of 0.2.2.&#39;</span><span class="p">,</span>
                      <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span></div></div>


<span class="c1"># -----------------------------------------------</span>
<span class="c1"># End of Ticktock class</span>
<span class="c1"># -----------------------------------------------</span>

<div class="viewcode-block" id="doy2date"><a class="viewcode-back" href="../../autosummary/spacepy.time.doy2date.html#spacepy.time.doy2date">[docs]</a><span class="k">def</span> <span class="nf">doy2date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">doy</span><span class="p">,</span> <span class="n">dtobj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flAns</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert integer day-of-year doy into a month and day</span>
<span class="sd">    after http://pleac.sourceforge.net/pleac_python/datesandtimes.html</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    year : int or array of int</span>
<span class="sd">        year</span>
<span class="sd">    doy : int or array of int</span>
<span class="sd">        day of year</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    month : int or array of int</span>
<span class="sd">        month as integer number</span>
<span class="sd">    day : int or array of int</span>
<span class="sd">        as integer number</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>
<span class="sd">    &gt;&gt;&gt; month, day = doy2date(2002, 186)</span>
<span class="sd">    &gt;&gt;&gt; dts = doy2date([2002]*4, range(186,190), dtobj=True)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>
<span class="sd">    Ticktock.getDOY</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">n_year</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Special case: this is a scalar</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n_doy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">n_doy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">n_doy</span> <span class="o">!=</span> <span class="n">n_year</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Day of year and year must have same length&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_year</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">doy</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Day-of-Year less than 1 detected: DOY starts from 1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flAns</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtobj</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">day</span>

    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Day-of-Year less than 1 detected: DOY starts from 1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">flAns</span><span class="p">:</span>
        <span class="n">dateobj</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                                             <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">doy</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_year</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dateobj</span> <span class="o">=</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                                             <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">doy</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_year</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">dtobj</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dateobj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dateobj</span><span class="p">]),</span>
                <span class="n">spacepy</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">dmarray</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dateobj</span><span class="p">]))</span></div>


<span class="c1"># -----------------------------------------------</span>
<div class="viewcode-block" id="tickrange"><a class="viewcode-back" href="../../autosummary/spacepy.time.tickrange.html#spacepy.time.tickrange">[docs]</a><span class="k">def</span> <span class="nf">tickrange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">deltadays</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a Ticktock range given the start, end, and delta</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    start : string or number</span>
<span class="sd">        start time (ISO standard string and UTC/datetime do not require a dtype)</span>
<span class="sd">    end : string or number</span>
<span class="sd">        last possible time in series (excluded unless end=start+n*step for integer n)</span>
<span class="sd">    deltadays : float or timedelta</span>
<span class="sd">        step in units of days (float); or datetime timedelta object</span>
<span class="sd">    dtype : string (optional)</span>
<span class="sd">        data type for start, end; e.g. ISO, UTC, RTD, etc. see Ticktock for all options</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : Ticktock instance</span>
<span class="sd">        ticks</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>
<span class="sd">    &gt;&gt;&gt; ticks = st.tickrange(&#39;2002-02-01T00:00:00&#39;, &#39;2002-02-10T00:00:00&#39;, deltadays = 1)</span>
<span class="sd">    &gt;&gt;&gt; ticks</span>
<span class="sd">    Ticktock( [&#39;2002-02-01T00:00:00&#39;, &#39;2002-02-02T00:00:00&#39;, &#39;2002-02-03T00:00:00&#39;,</span>
<span class="sd">    &#39;2002-02-04T00:00:00&#39;] , dtype=ISO)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>
<span class="sd">    Ticktock</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Tstart</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">Tend</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">Tend</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Tstart</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dmusec</span><span class="p">,</span> <span class="n">dsec</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">86400000000.</span><span class="p">,</span> <span class="n">diff</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">86400.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deltadays</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
        <span class="n">musec</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">deltadays</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">86400000000.</span><span class="p">,</span> <span class="n">deltadays</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">86400.</span>
        <span class="n">deltat</span> <span class="o">=</span> <span class="n">musec</span> <span class="o">+</span> <span class="n">sec</span> <span class="o">+</span> <span class="n">deltadays</span><span class="o">.</span><span class="n">days</span>
        <span class="n">nticks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">dmusec</span> <span class="o">+</span> <span class="n">dsec</span> <span class="o">+</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="o">/</span> <span class="n">deltat</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">trange</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tstart</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">deltadays</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nticks</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nticks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">dmusec</span> <span class="o">+</span> <span class="n">dsec</span> <span class="o">+</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">deltadays</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">trange</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tstart</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">deltadays</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nticks</span><span class="p">)]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">trange</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ticks</span></div>


<div class="viewcode-block" id="dtstr2iso"><a class="viewcode-back" href="../../autosummary/spacepy.time.dtstr2iso.html#spacepy.time.dtstr2iso">[docs]</a><span class="k">def</span> <span class="nf">dtstr2iso</span><span class="p">(</span><span class="n">dtstr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a datetime string to a standard format</span>

<span class="sd">    Attempts to maintain leap second representation while converting</span>
<span class="sd">    time strings to the specified format (by default, ISO8601-like.)</span>
<span class="sd">    Only handles a single positive leap second; negative leap seconds</span>
<span class="sd">    require no special handling and policy is for UTC-UT1 not to</span>
<span class="sd">    exceed 0.9.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    dtstr : sequence of str</span>
<span class="sd">        Date + time representation, format is fairly open.</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    isostr : array of str</span>
<span class="sd">        Representation of `dtstr` formatted according to `fmt`.</span>
<span class="sd">        Always a new sequence even if contents are identical to `dtstr`.</span>
<span class="sd">    UTC : array of datetime.datetime</span>
<span class="sd">        The closest-possible rendering of UTC time before or equal to `dtstr`.</span>
<span class="sd">    offset : array of int</span>
<span class="sd">        Amount (in microseconds) to add to `UTC` to get the real time.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ================</span>
<span class="sd">    fmt : str, optional</span>
<span class="sd">        Format appropriate for :meth:`~datetime.datetime.strftime` for</span>
<span class="sd">        rendering the output time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indtstr</span> <span class="o">=</span> <span class="n">dtstr</span>
    <span class="c1"># Will be editing this, so force it to own its data (but keep copy!)</span>
    <span class="n">dtstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">indtstr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;S&#39;</span> <span class="k">if</span> <span class="nb">str</span> <span class="ow">is</span> <span class="nb">bytes</span> <span class="k">else</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span>
                       <span class="n">requirements</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
    <span class="n">dtstr</span> <span class="o">=</span> <span class="n">dtstr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">dtstr</span> <span class="ow">is</span> <span class="n">indtstr</span> <span class="k">else</span> <span class="n">dtstr</span>
    <span class="c1"># Replace leapsecond with a valid &quot;59&quot;</span>
    <span class="c1"># Indices of every place that might be leap second</span>
    <span class="c1"># Leap second is sec==60, must come at LEAST after YYMMDDHHMM, if</span>
    <span class="c1"># being very terse, but this still will avoid YYYY-060</span>
    <span class="n">lsidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">dtstr</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">lsidx</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
        <span class="n">lsidx</span> <span class="o">=</span> <span class="n">lsidx</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span> <span class="c1">#atleast1d is only in new numpy</span>
    <span class="n">leapidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lsidx</span><span class="p">))</span>
    <span class="c1"># Add offset to datetime value to get actual UTC,</span>
    <span class="c1"># in integer microseconds.</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">dtstr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
    <span class="c1"># Actual leap second indices (not just suspected)</span>
    <span class="n">realleap</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leapidx</span><span class="p">):</span> <span class="c1"># Should be short list, so loop it</span>
        <span class="c1"># Get the index to scalar if necessary</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtstr</span><span class="o">.</span><span class="n">shape</span> <span class="k">else</span> <span class="p">()</span>
        <span class="c1"># The leap second must be preceded by at least 10 char (above),</span>
        <span class="c1"># followed by either nothing or fractional seconds,</span>
        <span class="c1"># preceded by 59 minutes (and optional separator)</span>
        <span class="c1"># It must also not be preceded by a . (to avoid replacing</span>
        <span class="c1"># 60 milliseconds with 59 milliseconds).</span>
        <span class="n">dtstr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">count</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;^([^\.]{8,}59[^\d]?)60((?:\.\d+)?)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\g&lt;1&gt;59\g&lt;2&gt;&#39;</span><span class="p">,</span> <span class="n">dtstr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># Doing this subtracted one second.</span>
        <span class="k">if</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">realleap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="c1"># Cut index of leap seconds down to real ones.</span>
    <span class="n">leapidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">realleap</span><span class="p">)</span>
    <span class="c1"># try a few special cases that are faster than dateutil.parser</span>
    <span class="n">strfmts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">,</span>
               <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">,</span>
               <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">strfmts</span><span class="p">:</span>
        <span class="n">strfmts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">strfmt</span> <span class="ow">in</span> <span class="n">strfmts</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">UTC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">strfmt</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)(</span><span class="n">dtstr</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">UTC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">dup</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)(</span><span class="n">dtstr</span><span class="p">)</span>
    <span class="n">otypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="k">if</span> <span class="nb">str</span> <span class="ow">is</span> <span class="nb">bytes</span> <span class="k">else</span> <span class="s1">&#39;U&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">isostr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="n">otypes</span><span class="o">=</span><span class="n">otypes</span><span class="p">)(</span><span class="n">UTC</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c1"># Python before 3.3 fails on strftime before 1900.</span>
        <span class="n">isostr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">1900</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;%Y&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">))),</span> <span class="n">otypes</span><span class="o">=</span><span class="n">otypes</span><span class="p">)(</span><span class="n">UTC</span><span class="p">)</span>
    <span class="c1"># Check that leap seconds are actually valid</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leapidx</span><span class="p">):</span>
        <span class="c1"># Day that ends in leap second *entry* (may not be leap second)</span>
        <span class="c1"># Unbelievably these are read as floats, and other places rely on that.</span>
        <span class="n">leapsecday</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span> <span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">)])</span>
        <span class="c1"># Find only those leap seconds that are really changes</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">secs</span><span class="p">))))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">leapsecday</span> <span class="o">=</span> <span class="n">leapsecday</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dtstr</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">if</span> <span class="n">UTC</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leapsecday</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid leapsecond.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">indtstr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">utcday</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)(</span><span class="n">UTC</span><span class="p">[</span><span class="n">leapidx</span><span class="p">])</span>
            <span class="c1"># Last day w/leapsecond that comes before supposed leapsec day</span>
            <span class="n">closestday</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">leapsecday</span><span class="p">,</span> <span class="n">utcday</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">leapsecday</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">bad</span> <span class="o">=</span> <span class="n">utcday</span> <span class="o">!=</span> <span class="n">leapsecday</span><span class="p">[</span><span class="n">closestday</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bad</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid leapsecond.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">indtstr</span><span class="p">[</span><span class="n">leapidx</span><span class="p">[</span><span class="n">bad</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
    <span class="c1">#Peg all leap seconds to the end of the previous second</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">leapidx</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtstr</span><span class="o">.</span><span class="n">shape</span> <span class="k">else</span> <span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="c1"># The time string is off by one second.</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="p">():</span> <span class="c1"># Scalar input.</span>
            <span class="n">isostr</span> <span class="o">=</span> <span class="n">UTC</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">))</span>
            <span class="n">us</span> <span class="o">=</span> <span class="n">UTC</span><span class="o">.</span><span class="n">microsecond</span>
            <span class="n">UTC</span> <span class="o">=</span> <span class="n">UTC</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">-</span> <span class="n">us</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">us</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isostr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%S&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">))</span>
            <span class="n">us</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">microsecond</span>
            <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">-</span> <span class="n">us</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">us</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">isostr</span><span class="p">,</span> <span class="n">UTC</span><span class="p">,</span> <span class="n">offset</span></div>


<div class="viewcode-block" id="sec2hms"><a class="viewcode-back" href="../../autosummary/spacepy.time.sec2hms.html#spacepy.time.sec2hms">[docs]</a><span class="k">def</span> <span class="nf">sec2hms</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtobj</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert seconds of day to hours, minutes, seconds</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    sec : float</span>
<span class="sd">        Seconds of day</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ================</span>
<span class="sd">    rounding : boolean</span>
<span class="sd">        set for integer seconds</span>
<span class="sd">    days : boolean</span>
<span class="sd">        set to wrap around day (i.e. modulo 86400)</span>
<span class="sd">    dtobj : boolean</span>
<span class="sd">        set to return a timedelta object</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : [hours, minutes, seconds] or datetime.timedelta</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rounding</span><span class="p">:</span>
        <span class="n">sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sec</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">days</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sec</span> <span class="o">&gt;</span> <span class="mi">86400</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Number of seconds &gt; seconds in day. &quot;</span>
                          <span class="s2">&quot;Try days keyword.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sec</span> <span class="o">%=</span> <span class="mi">86400</span>
    <span class="k">if</span> <span class="n">dtobj</span><span class="p">:</span>  <span class="c1"># no need to do the computation</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">sec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">sec</span> <span class="o">//</span> <span class="mi">3600</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="p">((</span><span class="n">sec</span> <span class="o">-</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="n">sec</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">]</span></div>


<span class="k">def</span> <span class="nf">no_tzinfo</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    take in an arraylike of datetime objects and return them without any tzinfo</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    dt : iterable</span>
<span class="sd">        iterable of datetime.datetime objects</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : list</span>
<span class="sd">        list of datetime.datetime without tzinfo</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">returnclass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># was not an iterable, assume datetime</span>
        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1">#special case: numpy ndarray - dmarray and masked array work, but not ndarray</span>
    <span class="k">if</span> <span class="n">returnclass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">returnclass</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="s1">&#39;attrs&#39;</span><span class="p">):</span>
            <span class="n">retval</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>


<div class="viewcode-block" id="leapyear"><a class="viewcode-back" href="../../autosummary/spacepy.time.leapyear.html#spacepy.time.leapyear">[docs]</a><span class="k">def</span> <span class="nf">leapyear</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">numdays</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return an array of boolean leap year,</span>
<span class="sd">    a lot faster than the mod method that is normally seen</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    year : array_like</span>
<span class="sd">        array of years</span>
<span class="sd">    numdays : boolean (optional)</span>
<span class="sd">        optionally return the number of days in the year</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : numpy array</span>
<span class="sd">        an array of boolean leap year, or array of number of days</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; import spacepy.time</span>
<span class="sd">    &gt;&gt;&gt; spacepy.time.leapyear(numpy.arange(15)+1998)</span>
<span class="sd">    [False, False,  True, False, False, False,  True, False, False,</span>
<span class="sd">          False,  True, False, False, False,  True]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">mask400</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span> <span class="o">%</span> <span class="mi">400</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">mask100</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">mask4</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">isleap</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask400</span> <span class="o">|</span> <span class="n">mask4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">mask100</span> <span class="o">|</span> <span class="n">mask400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numdays</span><span class="p">:</span>
        <span class="n">isleap</span> <span class="o">=</span> <span class="n">isleap</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">365</span>
    <span class="k">return</span> <span class="n">isleap</span></div>


<div class="viewcode-block" id="randomDate"><a class="viewcode-back" href="../../autosummary/spacepy.time.randomDate.html#spacepy.time.randomDate">[docs]</a><span class="k">def</span> <span class="nf">randomDate</span><span class="p">(</span><span class="n">dt1</span><span class="p">,</span> <span class="n">dt2</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a (or many) random datetimes between two given dates</span>

<span class="sd">    Convention used is dt1 &lt;= rand &lt; dt2. Leap second times will</span>
<span class="sd">    not be returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    dt1 : datetime.datetime</span>
<span class="sd">        start date for the the random date</span>
<span class="sd">    dt2 : datetime.datetime</span>
<span class="sd">        stop date for the the random date</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ================</span>
<span class="sd">    N : int (optional)</span>
<span class="sd">        the number of random dates to generate (defualt=1)</span>
<span class="sd">    tzinfo : bool (optional)</span>
<span class="sd">        maintain the tzinfo of the input datetimes (default=False)</span>
<span class="sd">    sorted : bool (optional)</span>
<span class="sd">        return the times sorted (default=False)</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : datetime.datetime or numpy.ndarray of datetime.datetime</span>
<span class="sd">        the new time for the next call to EventTimer</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dt1</span><span class="o">.</span><span class="n">tzinfo</span> <span class="o">!=</span> <span class="n">dt2</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;tzinfo for the input and output datetimes must match&#39;</span><span class="p">)</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">([</span><span class="n">dt1</span><span class="p">,</span> <span class="n">dt2</span><span class="p">])</span><span class="o">.</span><span class="n">RDT</span>
    <span class="n">rnd_tn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
    <span class="n">rnd_t</span> <span class="o">=</span> <span class="n">Ticktock</span><span class="p">(</span><span class="n">rnd_tn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;RDT&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sorted</span><span class="p">:</span>
        <span class="n">rnd_t</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">rnd_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">dt1</span><span class="o">.</span><span class="n">tzinfo</span> <span class="k">if</span> <span class="n">tzinfo</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rnd_t</span><span class="o">.</span><span class="n">UTC</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">rnd_t</span></div>


<span class="k">def</span> <span class="nf">extract_YYYYMMDD</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    go through a string and extract the first valid YYYYMMDD as a datetime</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    filename : str</span>
<span class="sd">        string to parse for a YYYYMMDD format</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    out : (None, datetime.datetime)</span>
<span class="sd">        the datetime found in the string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># return a datetime if there is one from YYYYMMDD</span>
    <span class="c1"># be picky so don&#39;t match random numbers (1950-2049)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(19[5-9]|20[0-4])\d(0\d|1[0-2])([0-2]\d|3[01])&quot;</span><span class="p">,</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(),</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">valid_YYYYMMDD</span><span class="p">(</span><span class="n">inval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if inval is valid YYYYMMDD return True, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(19[5-9]|20[0-4])\d(0\d|1[0-2])([0-2]\d|3[01])&quot;</span><span class="p">,</span>
                 <span class="n">inval</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_read_leaps</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Read leapseconds in from spacepy tai-utc file</span>

<span class="sd">    Populates module-global variables with leapsecond information:</span>
<span class="sd">    secs, year, mon, day, TAIleaps.</span>
<span class="sd">    Called on first initialization of Ticktock.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">secs</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">TAIleaps</span>
    <span class="c1"># load current file</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spacepy</span><span class="o">.</span><span class="n">DOT_FLN</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;tai-utc.dat&#39;</span><span class="p">)</span>
    <span class="n">mtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fname</span><span class="p">))[:</span><span class="mi">6</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c1"># Some files have a &quot;last checked&quot; line at the top</span>
    <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Checked&#39;</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">secs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">mon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="n">months</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;JAN&#39;</span><span class="p">,</span> <span class="s1">&#39;FEB&#39;</span><span class="p">,</span> <span class="s1">&#39;MAR&#39;</span><span class="p">,</span> <span class="s1">&#39;APR&#39;</span><span class="p">,</span> <span class="s1">&#39;MAY&#39;</span><span class="p">,</span> <span class="s1">&#39;JUN&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;JUL&#39;</span><span class="p">,</span> <span class="s1">&#39;AUG&#39;</span><span class="p">,</span> <span class="s1">&#39;SEP&#39;</span><span class="p">,</span> <span class="s1">&#39;OCT&#39;</span><span class="p">,</span> <span class="s1">&#39;NOV&#39;</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">secs</span><span class="p">))):</span>
        <span class="c1"># Round float seconds (0.5 always rounds up.)</span>
        <span class="n">secs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mon</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">months</span> <span class="o">==</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">day</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Check for out of date. The leap second bulletin comes every</span>
    <span class="c1"># six months, and that contains information through the following</span>
    <span class="c1"># leap second (end of June/Dec)</span>
    <span class="k">if</span> <span class="n">spacepy</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;enable_old_data_warning&#39;</span><span class="p">]:</span>
        <span class="n">lastknown</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">mtime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">goodthrough</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
            <span class="n">lastknown</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">lastknown</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">),</span>
            <span class="mi">1</span> <span class="k">if</span> <span class="n">lastknown</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="k">else</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">goodthrough</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Leapseconds may be out of date.&#39;</span>
                          <span class="s1">&#39; Use spacepy.toolbox.update(leapsecs=True)&#39;</span><span class="p">)</span>

    <span class="n">TAIleaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">secs</span><span class="p">))</span>
    <span class="n">TAItup</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span>
    <span class="n">TAI0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1958</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">secs</span><span class="p">)):</span>
        <span class="n">TAItup</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mon</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">-</span> <span class="n">TAI0</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
            <span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">secs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">TAIleaps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAItup</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">TAItup</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">TAItup</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">1.e6</span>


<span class="k">def</span> <span class="nf">_days1958</span><span class="p">(</span><span class="n">tai</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;rubber&#39;</span><span class="p">,</span> <span class="n">midnight</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate days and fractional days since 1958-01-01T12:00</span>

<span class="sd">    This is basically a Julian Date but baselined from the start of TAI.</span>
<span class="sd">    Since it is calculated from TAI, using this as day 0 maximizes the</span>
<span class="sd">    resolution of the resulting values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    tai : sequence of float</span>
<span class="sd">        TAI seconds (i.e. continuous SI seconds relative to 1958-01-01T00:00)</span>

<span class="sd">    leaps : str, optional</span>
<span class="sd">        How to treat days with leapseconds. Since the Julian Date runs</span>
<span class="sd">        noon (inclusive) to noon (exclusive), this affects the back</span>
<span class="sd">        half of the date with the leapsecond, and the first half of the</span>
<span class="sd">        next. Accepted values are:</span>

<span class="sd">        rubber</span>
<span class="sd">            Consider these days to be 86401 seconds long and thus treat</span>
<span class="sd">            each second as a slightly smaller fraction of the day,</span>
<span class="sd">            so that all times are represented and evently spaced within</span>
<span class="sd">            the day. I.e. the day is &quot;stretched&quot; across more seconds, by</span>
<span class="sd">            analogy with the &quot;rubber second&quot; of 1960-1972. (default)</span>

<span class="sd">        drop</span>
<span class="sd">            Treate time as a flow of SI seconds that is suspended during</span>
<span class="sd">            leapseconds, i.e. leapsecond time does not exist. Time during</span>
<span class="sd">            leap seconds is pinned to the last microsecond of the</span>
<span class="sd">            previous second.</span>

<span class="sd">        continuous</span>
<span class="sd">            Treat time as a continuous flow of SI seconds with days always</span>
<span class="sd">            86400 seconds long. This is the proper handling for true</span>
<span class="sd">            Julian Dates, i.e. JD(TAI), as recommended by IAU General Assembly</span>
<span class="sd">            XXIII, resolution B1.</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    sequence of float</span>
<span class="sd">        Days, including fraction, relative to 1958-01-01T12:00</span>

<span class="sd">    Other parameters</span>
<span class="sd">    ================</span>
<span class="sd">    midnight : bool, optional</span>
<span class="sd">        Start the day at midnight instead of noon. This affects the allocation</span>
<span class="sd">        of leap seconds, and of course days are relative to 1958-01-01T00:00</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">off</span> <span class="o">=</span> <span class="mf">0.</span> <span class="k">if</span> <span class="n">midnight</span> <span class="k">else</span> <span class="mf">43200.</span> <span class="c1"># Offset from midnight</span>
    <span class="c1"># Shift to time-since-noon, if desired (also makes copy), call delta-TAI</span>
    <span class="n">dtai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">tai</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">-</span> <span class="n">off</span>
    <span class="n">leap_dtai</span><span class="p">,</span> <span class="n">taiutc</span> <span class="o">=</span> <span class="n">_changed_leaps</span><span class="p">()</span>
    <span class="n">leap_dtai</span> <span class="o">-=</span> <span class="n">off</span> <span class="c1"># delta-TAI of start of leap second</span>
    <span class="k">if</span> <span class="n">leaps</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;rubber&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">):</span>
        <span class="c1"># Index of leapsecond equal to or before each time record</span>
        <span class="n">lidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">leap_dtai</span><span class="p">,</span> <span class="n">dtai</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">leaps</span> <span class="o">!=</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;leaps handling </span><span class="si">{}</span><span class="s1"> not recognized.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">leaps</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">leaps</span> <span class="o">==</span> <span class="s1">&#39;rubber&#39;</span><span class="p">:</span>
        <span class="c1"># d-TAI of start-of-day (noon or midnight) before/after each leapsecond</span>
        <span class="c1"># because leapseconds always start at 23:59:60 (43200s after noon).</span>
        <span class="k">if</span> <span class="n">midnight</span><span class="p">:</span>
            <span class="n">daystart_before_leap</span> <span class="o">=</span> <span class="n">leap_dtai</span> <span class="o">-</span> <span class="mi">86400</span>
            <span class="n">daystart_after_leap</span> <span class="o">=</span> <span class="n">leap_dtai</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">daystart_before_leap</span> <span class="o">=</span> <span class="n">leap_dtai</span> <span class="o">-</span> <span class="mi">43200</span>
            <span class="n">daystart_after_leap</span> <span class="o">=</span> <span class="n">leap_dtai</span> <span class="o">+</span> <span class="mi">43201</span>
        <span class="c1"># Closest leapsecond-day-start before record.</span>
        <span class="c1"># May be greater than lidx, if near but before leapsecond</span>
        <span class="n">ldidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">daystart_before_leap</span><span class="p">,</span> <span class="n">dtai</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># All records that happen on leap second days.</span>
        <span class="n">leap_sec_day</span> <span class="o">=</span> <span class="p">(</span><span class="n">daystart_before_leap</span><span class="p">[</span><span class="n">ldidx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dtai</span><span class="p">)</span> \
                       <span class="o">&amp;</span> <span class="p">(</span><span class="n">dtai</span> <span class="o">&lt;</span> <span class="n">daystart_after_leap</span><span class="p">[</span><span class="n">ldidx</span><span class="p">])</span>
        <span class="c1"># Save SSD on leap second days, about to be destroyed</span>
        <span class="k">if</span> <span class="n">leap_sec_day</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span> <span class="c1"># Scalar</span>
            <span class="n">ssd_leap_sec_day</span> <span class="o">=</span> <span class="n">dtai</span> <span class="o">-</span> <span class="n">daystart_before_leap</span><span class="p">[</span><span class="n">ldidx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ssd_leap_sec_day</span> <span class="o">=</span> <span class="n">dtai</span><span class="p">[</span><span class="n">leap_sec_day</span><span class="p">]</span> \
                               <span class="o">-</span> <span class="n">daystart_before_leap</span><span class="p">[</span><span class="n">ldidx</span><span class="p">[</span><span class="n">leap_sec_day</span><span class="p">]]</span>
        <span class="c1"># Destroy leap seconds, so days always break at 86400s</span>
        <span class="n">dtai</span> <span class="o">-=</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">lidx</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">leaps</span> <span class="o">==</span> <span class="s1">&#39;drop&#39;</span><span class="p">:</span>
        <span class="c1"># Where in a leapsecond, pin to previous second</span>
        <span class="n">inleap</span> <span class="o">=</span> <span class="n">dtai</span> <span class="o">-</span> <span class="n">leap_dtai</span><span class="p">[</span><span class="n">lidx</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">inleap</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span> <span class="c1"># Scalar</span>
            <span class="k">if</span> <span class="n">inleap</span><span class="p">:</span>
                <span class="n">dtai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dtai</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">000001</span>
                <span class="n">lidx</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># Associated with previous TAI - UTC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtai</span><span class="p">[</span><span class="n">inleap</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dtai</span><span class="p">[</span><span class="n">inleap</span><span class="p">])</span> <span class="o">-</span> <span class="o">.</span><span class="mi">000001</span>
            <span class="c1"># Already subtracted ~1sec, now associated with previous TAI - UTC</span>
            <span class="n">lidx</span><span class="p">[</span><span class="n">inleap</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c1"># Remove all of the TAI seconds that &quot;disappeared&quot;.</span>
        <span class="n">dtai</span> <span class="o">-=</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">lidx</span><span class="p">]</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dtai</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
    <span class="n">ssd</span> <span class="o">=</span> <span class="n">dtai</span> <span class="o">-</span> <span class="n">day</span> <span class="o">*</span> <span class="mi">86400</span> <span class="c1"># Mod does wrong thing if negative.</span>
    <span class="k">if</span> <span class="n">leaps</span> <span class="o">==</span> <span class="s1">&#39;rubber&#39;</span><span class="p">:</span>
        <span class="c1"># Patch back in the SSD on leap-second days.</span>
        <span class="k">if</span> <span class="n">leap_sec_day</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span> <span class="c1"># Scalar</span>
            <span class="k">if</span> <span class="n">leap_sec_day</span><span class="p">:</span>
                <span class="n">ssd</span> <span class="o">=</span> <span class="n">ssd_leap_sec_day</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ssd</span><span class="p">[</span><span class="n">leap_sec_day</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssd_leap_sec_day</span>
        <span class="n">daylen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">leap_sec_day</span><span class="p">,</span> <span class="p">(</span><span class="mf">86400.</span><span class="p">,</span> <span class="mf">86401.</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">daylen</span> <span class="o">=</span> <span class="mi">86400</span>
    <span class="k">return</span> <span class="n">day</span> <span class="o">+</span> <span class="n">ssd</span> <span class="o">/</span> <span class="n">daylen</span>


<span class="k">def</span> <span class="nf">_days1958totai</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">leaps</span><span class="o">=</span><span class="s1">&#39;rubber&#39;</span><span class="p">,</span> <span class="n">midnight</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate TAI from days and fractional days since 1958-01-01T12:00</span>

<span class="sd">    Input is basically a Julian Date but baselined from the start of TAI.</span>
<span class="sd">    Since it is calculated from TAI, using this as day 0 maximizes the</span>
<span class="sd">    resolution of the resulting values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    days : sequence of float</span>
<span class="sd">        Days, including fraction, relative to 1958-01-01T12:00</span>

<span class="sd">    leaps : str, optional</span>
<span class="sd">        How to treat days with leapseconds. Since the Julian Date runs</span>
<span class="sd">        noon (inclusive) to noon (exclusive), this affects the back</span>
<span class="sd">        half of the date with the leapsecond, and the first half of the</span>
<span class="sd">        next. Accepted values are:</span>

<span class="sd">        rubber</span>
<span class="sd">            Consider these days to be 86401 seconds long and thus treat</span>
<span class="sd">            each second as a slightly smaller fraction of the day,</span>
<span class="sd">            so that all times are represented and evently spaced within</span>
<span class="sd">            the day. I.e. the day is &quot;stretched&quot; across more seconds, by</span>
<span class="sd">            analogy with the &quot;rubber second&quot; of 1960-1972. (default)</span>

<span class="sd">        drop</span>
<span class="sd">            Treate time as a flow of SI seconds that is suspended during</span>
<span class="sd">            leapseconds, i.e. leapsecond time does not exist. Time during</span>
<span class="sd">            leap seconds is not recovered (no output time during leaps.)</span>

<span class="sd">        continuous</span>
<span class="sd">            Treat time as a continuous flow of SI seconds with days always</span>
<span class="sd">            86400 seconds long. This is the proper handling for true</span>
<span class="sd">            Julian Dates, i.e. JD(TAI), as recommended by IAU General Assembly</span>
<span class="sd">            XXIII, resolution B1.</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    sequence of float</span>
<span class="sd">        TAI seconds (i.e. continuous SI seconds relative to 1958-01-01T00:00)</span>

<span class="sd">    Other parameters</span>
<span class="sd">    ================</span>
<span class="sd">    midnight : bool, optional</span>
<span class="sd">        Start the day at midnight instead of noon. This affects the allocation</span>
<span class="sd">        of leap seconds, and of course `days` are relative to 1958-01-01T00:00</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">off</span> <span class="o">=</span> <span class="mf">0.</span> <span class="k">if</span> <span class="n">midnight</span> <span class="k">else</span> <span class="mf">43200.</span> <span class="c1"># Offset from midnight</span>
    <span class="k">if</span> <span class="n">leaps</span> <span class="o">==</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span> <span class="c1"># Very simple case.</span>
        <span class="k">return</span> <span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">off</span>
    <span class="k">elif</span> <span class="n">leaps</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;rubber&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;leaps handling </span><span class="si">{}</span><span class="s1"> not recognized.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">leaps</span><span class="p">))</span>
    <span class="n">leap_tai</span><span class="p">,</span> <span class="n">taiutc</span> <span class="o">=</span> <span class="n">_changed_leaps</span><span class="p">()</span>
    <span class="n">leap_dtai</span> <span class="o">=</span> <span class="n">leap_tai</span> <span class="o">-</span> <span class="n">off</span> <span class="c1"># delta-TAI of start of leap second</span>
    <span class="c1"># Days with leap second. Leap second is always late in day: end</span>
    <span class="c1"># of day if doing midnight-to-midnight, halfway if noon-to-noon.</span>
    <span class="n">leap_day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">leap_dtai</span> <span class="o">-</span> <span class="n">taiutc</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
    <span class="c1"># Closest leapsecond-day before record.</span>
    <span class="n">ldidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">leap_day</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># All records that happen on leap second days.</span>
    <span class="n">leap_sec_day</span> <span class="o">=</span> <span class="p">(</span><span class="n">ldidx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> \
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">leap_day</span><span class="p">[</span><span class="n">ldidx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">days</span><span class="p">)</span> \
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">days</span> <span class="o">&lt;</span> <span class="n">leap_day</span><span class="p">[</span><span class="n">ldidx</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">leaps</span> <span class="o">==</span> <span class="s1">&#39;rubber&#39;</span><span class="p">:</span>
        <span class="n">daylen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">leap_sec_day</span><span class="p">,</span> <span class="p">(</span><span class="mf">86400.</span><span class="p">,</span> <span class="mf">86401.</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">daylen</span> <span class="o">=</span> <span class="mf">86400.</span>
    <span class="c1"># Naive TAI at start of day (no leapsecond corrections).</span>
    <span class="n">dayint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
    <span class="n">daystart</span> <span class="o">=</span> <span class="n">dayint</span> <span class="o">*</span> <span class="mi">86400</span>
    <span class="c1"># Seconds from the start of naive day.</span>
    <span class="n">ssd</span> <span class="o">=</span> <span class="p">(</span><span class="n">days</span> <span class="o">-</span> <span class="n">dayint</span><span class="p">)</span> <span class="o">*</span> <span class="n">daylen</span> <span class="c1"># Mod does wrong thing if negative</span>
    <span class="c1"># Index TAIUTC for every input. Start of day w/LS is still previous value.</span>
    <span class="n">taiutcidx</span> <span class="o">=</span> <span class="n">ldidx</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">leap_sec_day</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">intc</span><span class="p">)</span>
    <span class="c1"># Keep small number adds together: ssd and leapseconds.</span>
    <span class="n">taiout</span> <span class="o">=</span> <span class="n">daystart</span> <span class="o">+</span> <span class="p">(</span><span class="n">ssd</span> <span class="o">+</span> <span class="n">off</span> <span class="o">+</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">taiutcidx</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">leaps</span> <span class="o">==</span> <span class="s1">&#39;drop&#39;</span><span class="p">:</span>
        <span class="c1"># Any times after leap-second skip need an extra second.</span>
        <span class="n">taiutcidx</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">leap_sec_day</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">taiout</span> <span class="o">&gt;=</span> <span class="n">leap_tai</span><span class="p">[</span><span class="n">ldidx</span><span class="p">]),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
        <span class="c1"># Recalculate to keep small-number addition together</span>
        <span class="n">taiout</span> <span class="o">=</span> <span class="n">daystart</span> <span class="o">+</span> <span class="p">(</span><span class="n">ssd</span> <span class="o">+</span> <span class="n">off</span> <span class="o">+</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">taiutcidx</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">taiout</span>


<span class="k">def</span> <span class="nf">_changed_leaps</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Find only those times where leap seconds actually changed</span>

<span class="sd">    There are leap second records where there is no actual change</span>
<span class="sd">    in leap seconds, and there isn&#39;t a record for TAI-UTC == 0; this</span>
<span class="sd">    adds a record (where the TAI of the leap second time is -inf) and</span>
<span class="sd">    eliminated those with no actual change.</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    leap_tai : sequence of float</span>
<span class="sd">        TAI of the start of every leap second.</span>
<span class="sd">    taiutc : sequence of float</span>
<span class="sd">        TAI - UTC at the end of the leap second.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find only those leap seconds that are really changes</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">secs</span><span class="p">))))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">leap_tai</span> <span class="o">=</span> <span class="n">TAIleaps</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="c1"># TAI of start of leap second</span>
    <span class="n">taiutc</span> <span class="o">=</span> <span class="n">secs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="c1"># TAI - UTC after leap second (same index as leap_tai)</span>
    <span class="c1"># Add fake TAI - UTC = 0 at the Big Bang</span>
    <span class="n">leap_tai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">leap_tai</span><span class="p">))</span>
    <span class="n">taiutc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">taiutc</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">leap_tai</span><span class="p">,</span> <span class="n">taiutc</span>


<span class="k">def</span> <span class="nf">_tai_naive_to_real</span><span class="p">(</span><span class="n">tai</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert naive TAI to real TAI</span>

<span class="sd">    Convert a TAI on a continuous timescale that skips over leapseconds</span>
<span class="sd">    and is unaware of calendar conversion to actual TAI, which includes</span>
<span class="sd">    leapseconds and is continuous across the Gregorian conversion (naive</span>
<span class="sd">    has a gap, i.e. dates it can represent that don&#39;t exist.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    tai : sequence of float</span>
<span class="sd">        Naive TAI</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    tai : sequence of float</span>
<span class="sd">        TAI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This is the ACTUAL TAI and TAI-UTC at the end of that TAI</span>
    <span class="n">leap_tai</span><span class="p">,</span> <span class="n">taiutc</span> <span class="o">=</span> <span class="n">_changed_leaps</span><span class="p">()</span>
    <span class="c1"># Naive TAI and index that corresponds to TAI - UTC</span>
    <span class="n">naive_leap_tai</span> <span class="o">=</span> <span class="n">leap_tai</span> <span class="o">-</span> <span class="n">taiutc</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">taiutcidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">naive_leap_tai</span><span class="p">,</span> <span class="n">tai</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">realtai</span> <span class="o">=</span> <span class="n">tai</span> <span class="o">+</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">taiutcidx</span><span class="p">]</span>
    <span class="c1"># Anything before 1582-10-5 has TAI ten days later than the</span>
    <span class="c1"># naive conversion, because naive has ten days that are not in TAI.</span>
    <span class="n">realtai</span><span class="p">[</span><span class="n">realtai</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">11840601600.0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">864000</span>
    <span class="k">return</span> <span class="n">realtai</span>


<span class="k">def</span> <span class="nf">_tai_real_to_naive</span><span class="p">(</span><span class="n">tai</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert naive TAI to actual TAI</span>

<span class="sd">    Convert actual TAI, which includes leapseconds and is continuous</span>
<span class="sd">    across the Gregorian calendar conversion, to naive TAI, which skips</span>
<span class="sd">    over leapseconds and has times in the calendar conversion that</span>
<span class="sd">    do not actually exist.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    tai : sequence of float</span>
<span class="sd">        TAI</span>

<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    tai : sequence of float</span>
<span class="sd">        Naive TAI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ACTUAL TAI and TAI-UTC at the end of that TAI</span>
    <span class="n">leap_tai</span><span class="p">,</span> <span class="n">taiutc</span> <span class="o">=</span> <span class="n">_changed_leaps</span><span class="p">()</span>
    <span class="c1"># Points to largest leap-TAI less-than input TAI, thus also TAI-UTC</span>
    <span class="n">lidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">leap_tai</span><span class="p">,</span> <span class="n">tai</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># Records in a leap second</span>
    <span class="n">inleap</span> <span class="o">=</span> <span class="n">tai</span> <span class="o">&lt;</span> <span class="n">leap_tai</span><span class="p">[</span><span class="n">lidx</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">taiutc</span><span class="p">)[</span><span class="n">lidx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">naive_tai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">inleap</span><span class="p">,</span> <span class="p">(</span>
        <span class="n">tai</span> <span class="o">-</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">lidx</span><span class="p">],</span> <span class="c1"># Just subtract off LS</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tai</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">.</span><span class="mi">999</span> <span class="o">-</span> <span class="n">taiutc</span><span class="p">[</span><span class="n">lidx</span><span class="p">])</span> <span class="c1"># Peg to end of sec</span>
        <span class="p">))</span>
    <span class="c1"># Anything before 1582-10-15 needs to skip 10 CDF days backward,</span>
    <span class="c1"># since naive has ten days that are not in TAI</span>
    <span class="n">naive_tai</span><span class="p">[</span><span class="n">tai</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">11839737600.0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">864000</span>
    <span class="k">return</span> <span class="n">naive_tai</span>


<span class="n">_read_leaps</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="https://spacepy.github.io/"">homepage</a>|&nbsp;</li>
        <li><a href="https://github.com/spacepy/spacepy">development</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>
       <li><a href="../../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../spacepy.html" >spacepy</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spacepy.time</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2020, The SpacePy Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.0.
    </div>
  </body>
</html>