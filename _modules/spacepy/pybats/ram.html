<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spacepy.pybats.ram &#8212; SpacePy v0.7.0 Manual</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css?v=92e3d466" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/documentation_options.js?v=fe7df9b0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/spacepy_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/spacepy_logo.jpg" border="0" alt="spacepy_logo"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="https://spacepy.github.io/"">homepage</a>|&nbsp;</li>
        <li><a href="https://github.com/spacepy/spacepy">development</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>
       <li><a href="../../../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../spacepy.html" >spacepy</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../pybats.html" accesskey="U">spacepy.pybats</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spacepy.pybats.ram</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spacepy.pybats.ram</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">A module for reading, handling, and plotting RAM-SCB output.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># Global imports</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>

<span class="kn">import</span> <span class="nn">spacepy.datamodel</span> <span class="k">as</span> <span class="nn">dm</span>
<span class="kn">import</span> <span class="nn">spacepy.time</span> <span class="k">as</span> <span class="nn">spt</span>
<span class="kn">import</span> <span class="nn">spacepy.toolbox</span> <span class="k">as</span> <span class="nn">tb</span>
<span class="kn">from</span> <span class="nn">spacepy.plot</span> <span class="kn">import</span> <span class="n">set_target</span><span class="p">,</span> <span class="n">applySmartTimeTicks</span>
<span class="kn">from</span> <span class="nn">spacepy.pybats</span> <span class="kn">import</span> <span class="n">PbData</span>


<span class="c1">#  Start module with a few useful functions:</span>
<div class="viewcode-block" id="gen_rgrid">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.gen_rgrid">[docs]</a>
<span class="k">def</span> <span class="nf">gen_rgrid</span><span class="p">(</span><span class="n">nR</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="mf">1.75</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mf">6.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the number of radial points, *nR*, the min and max of the radial</span>
<span class="sd">    extent, *rmin* and *rmax*, repsectively, create and return the radial grid</span>
<span class="sd">    of RAM-SCB as a vector of points in Earth radii.</span>

<span class="sd">    Note that the first and last cells are ghost cells.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nR</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dR</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmax</span><span class="o">-</span><span class="n">rmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nR</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nR</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmin</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dR</span>
    <span class="k">return</span> <span class="n">r</span></div>



<div class="viewcode-block" id="gen_tgrid">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.gen_tgrid">[docs]</a>
<span class="k">def</span> <span class="nf">gen_tgrid</span><span class="p">(</span><span class="n">nT</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the number of local time grid points, *nT*, return, as vectors,</span>
<span class="sd">    the grid points in local time in units of radians and then local time hours</span>
<span class="sd">    that would be used in RAM-SCB.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">dT</span> <span class="o">=</span> <span class="mf">24.0</span><span class="o">/</span><span class="p">(</span><span class="n">nT</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">nT</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nT</span><span class="p">):</span>
        <span class="n">lt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dT</span><span class="o">*</span><span class="n">i</span>
        <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp</span><span class="o">*</span><span class="n">i</span>
    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">lt</span></div>



<div class="viewcode-block" id="gen_egrid">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.gen_egrid">[docs]</a>
<span class="k">def</span> <span class="nf">gen_egrid</span><span class="p">(</span><span class="n">nE</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ew</span><span class="o">=</span><span class="mf">3E-2</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">1.27</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given number of points and a lower boundary (*nE* and *lb*), build the</span>
<span class="sd">    RAM-SCB energy grid.  Three arrays are returned: ebound(nE+1), the boundary</span>
<span class="sd">    of each bin, ecenter(nE), the center of each bin, and ewidth(nE),</span>
<span class="sd">    the width of each bin.  All output units are in keV.</span>

<span class="sd">    Grid parameters can be set with kwargs but default to common RAM values:</span>
<span class="sd">    ======= =========================================</span>
<span class="sd">    Kwarg   Description</span>
<span class="sd">    ======= =========================================</span>
<span class="sd">    nE      Number of grid points.</span>
<span class="sd">    lb      Lower boundary of energy grid in keV</span>
<span class="sd">    ew      Width of first energy bin.</span>
<span class="sd">    power   Power series exponent to determine grid spacing.</span>
<span class="sd">    ======= =========================================</span>


<span class="sd">    Usage:</span>

<span class="sd">    &gt;&gt;&gt; (ecentr, ebound, ewidth)=gen_egrid(nE=36, lb=0.1, ew=3E-2, power=1.27)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">ebound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nE</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ecentr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nE</span><span class="p">)</span>
    <span class="n">ewidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nE</span><span class="p">)</span>

    <span class="n">ebound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lb</span>
    <span class="n">ewidth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ew</span>
    <span class="n">ecentr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">ewidth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nE</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ewidth</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ewidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">power</span>
        <span class="n">ebound</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebound</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ewidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ecentr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecentr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ewidth</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ewidth</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ebound</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebound</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ewidth</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ecentr</span><span class="p">,</span> <span class="n">ebound</span><span class="p">,</span> <span class="n">ewidth</span><span class="p">)</span></div>



<div class="viewcode-block" id="young_comp">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.young_comp">[docs]</a>
<span class="k">def</span> <span class="nf">young_comp</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="n">f107</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determine plasma sheet composition using the Young et al. empirical</span>
<span class="sd">    relationship based on Kp and F10.7 (first and second arguments,</span>
<span class="sd">    respectively) as given by *Young et al.* [JGR, 1982, Vol. 87 No. A11]</span>

<span class="sd">    Returns fraction of total number density that is Hydrogen,</span>
<span class="sd">    Helium, and Oxygen.</span>

<span class="sd">    Example usage:</span>

<span class="sd">    &gt;&gt;&gt; FracH, FracHe, FracO = young_comp(5, 150.0)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ratOH</span> <span class="o">=</span> <span class="mf">4.5E-2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.17</span><span class="o">*</span><span class="n">kp</span> <span class="o">+</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">f107</span><span class="p">)</span>  <span class="c1"># +/-0.21; Eq. 5, pg. 9088</span>
    <span class="n">ratHeH</span> <span class="o">=</span> <span class="mf">0.618182</span><span class="o">*</span><span class="n">ratOH</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.24</span><span class="o">*</span><span class="n">kp</span> <span class="o">-</span> <span class="mf">0.011</span><span class="o">*</span><span class="n">f107</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.011</span><span class="o">*</span><span class="n">ratOH</span>
    <span class="n">fracH</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">ratHeH</span> <span class="o">+</span> <span class="n">ratOH</span><span class="p">)</span>
    <span class="n">fracHe</span> <span class="o">=</span> <span class="n">ratHeH</span> <span class="o">*</span> <span class="n">fracH</span>
    <span class="n">fracO</span> <span class="o">=</span> <span class="n">ratOH</span> <span class="o">*</span> <span class="n">fracH</span>

    <span class="k">return</span> <span class="n">fracH</span><span class="p">,</span> <span class="n">fracHe</span><span class="p">,</span> <span class="n">fracO</span></div>



<div class="viewcode-block" id="viz_young_comp">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.viz_young_comp">[docs]</a>
<span class="k">def</span> <span class="nf">viz_young_comp</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a quick-look plot of % O+ as calculated by Young et al. for</span>
<span class="sd">    various values of Kp and F10.7.  No input arguments are taken.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>

    <span class="n">kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">f7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">fracH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">kp</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">f7</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="n">fracO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">kp</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">f7</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="n">fracHe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">kp</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">f7</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f7</span><span class="p">):</span>
        <span class="n">fracH</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">fracHe</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">fracO</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">young_comp</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">cnt2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">f7</span><span class="p">,</span> <span class="n">kp</span><span class="p">,</span> <span class="n">fracO</span><span class="p">,</span> <span class="n">levs</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Young et al. Fraction O$^{+}$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;F10.7 Flux&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Kp Index&#39;</span><span class="p">)</span>
    <span class="n">cb2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cnt2</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
    <span class="n">cb2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Fraction O$^{+}$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<div class="viewcode-block" id="viz_egrid">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.viz_egrid">[docs]</a>
<span class="k">def</span> <span class="nf">viz_egrid</span><span class="p">(</span><span class="n">nE</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ew</span><span class="o">=</span><span class="mf">3E-2</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">1.27</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Vizualize the RAM-SCB energy grid.  All kwargs correspond to those used by</span>
<span class="sd">    :func:`gen_egrid`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="n">ecent</span><span class="p">,</span> <span class="n">ebound</span><span class="p">,</span> <span class="n">ewidth</span> <span class="o">=</span> <span class="n">gen_egrid</span><span class="p">(</span><span class="n">nE</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ew</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ecent</span><span class="p">))</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ecent</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">ewidth</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bin Widths&#39;</span><span class="p">,</span>
                <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecent</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bin Centers&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;RAM-SCB Energy Grid - Power=</span><span class="si">%4.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">power</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy ($KeV$)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">ebound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">ebound</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">20.0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="gen_pgrid">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.gen_pgrid">[docs]</a>
<span class="k">def</span> <span class="nf">gen_pgrid</span><span class="p">(</span><span class="n">nPa</span><span class="o">=</span><span class="mi">72</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given number of points, $*nPa*$, build the RAM-SCB pitch angle grid.</span>
<span class="sd">    The return value is a $*nPa*x3$ matrix containing the bin starts, centers,</span>
<span class="sd">    and ends in cosine of pitch angle.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nPa</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span></div>



<div class="viewcode-block" id="read_t89file">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.read_t89file">[docs]</a>
<span class="k">def</span> <span class="nf">read_t89file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read a T89 input file intended for RAM-SCB.</span>

<span class="sd">    Usage:</span>

<span class="sd">    &gt;&gt;&gt; time, b_dip, b_ext = read_t89file(&#39;somefile.t89&#39;)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># skip header.</span>

    <span class="n">nRec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bdip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nRec</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">bext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nRec</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                                <span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">bdip</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
        <span class="n">bext</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">9</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">10</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">bdip</span><span class="p">,</span> <span class="n">bext</span></div>



<div class="viewcode-block" id="grid_zeros">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.grid_zeros">[docs]</a>
<span class="k">def</span> <span class="nf">grid_zeros</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Attempt to plot x=0 and y=0 gridlines w/o messing up</span>
<span class="sd">    plot range.  This should be called last when creating</span>
<span class="sd">    a plot; after you have the range sorted out.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_orb_ticks">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.set_orb_ticks">[docs]</a>
<span class="k">def</span> <span class="nf">set_orb_ticks</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set major ticks to multiples of 1, minor ticks to 1/4.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>

    <span class="c1"># Tick Locators:</span>
    <span class="n">xMticks</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">2.00</span><span class="p">)</span>
    <span class="n">xmticks</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">yMticks</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">2.00</span><span class="p">)</span>
    <span class="n">ymticks</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">xMticks</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xmticks</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">yMticks</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ymticks</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="add_body">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.add_body">[docs]</a>
<span class="k">def</span> <span class="nf">add_body</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">add_night</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a circle of radius kwarg rad (default 2.0 RE) at the center of</span>
<span class="sd">    axis ax.  Then, a planet of radius 1.0 RE is added to the center to</span>
<span class="sd">    represent the Earth.  Extra kwargs are passed to the patch generators.</span>

<span class="sd">    Three patches are created by this function: the inner boundary (a light</span>
<span class="sd">    grey Circle patch), the planet (a white Circle patch) and the night side</span>
<span class="sd">    of the planet (a black wedge.)  All three are returned to the caller.</span>

<span class="sd">    The kwarge &quot;rotate&quot;, which defaults to 0.0, can be set to any angle</span>
<span class="sd">    (in degrees) to rotate the location of local noon/midnight on the</span>
<span class="sd">    planet patches.  The default is local noon points towards +X.  A</span>
<span class="sd">    rotate value of 90 will cause local noon to point towards +Y.</span>

<span class="sd">    Example</span>

<span class="sd">    &gt;&gt;&gt;ax=pylab.subplot(111)</span>
<span class="sd">    &gt;&gt;&gt;inner, planet, night = rampy.add_body(ax)</span>

<span class="sd">    If you are using a polar axis, try using add_body_polar.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Wedge</span>

    <span class="n">inner</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rad</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">)</span>
    <span class="n">planet</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1001</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">)</span>
    <span class="n">night</span> <span class="o">=</span> <span class="n">Wedge</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">90</span><span class="o">+</span><span class="n">rotate</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="o">+</span><span class="n">rotate</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                  <span class="n">zorder</span><span class="o">=</span><span class="mi">1002</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">planet</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_night</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">night</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inner</span><span class="p">,</span> <span class="n">planet</span><span class="p">,</span> <span class="n">night</span></div>



<div class="viewcode-block" id="add_body_polar">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.add_body_polar">[docs]</a>
<span class="k">def</span> <span class="nf">add_body_polar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">noon</span><span class="o">=</span><span class="mf">90.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add the &quot;Earth&quot; to the center of a polar dial plot located on</span>
<span class="sd">    axis &quot;ax&quot;.  Kwarg noon specifies the angle counter clockwise from the</span>
<span class="sd">    x-axis, in degrees, that is local noon (e.g. sun facing.)  Default is</span>
<span class="sd">    90 degrees, or in the +Y direction.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>

    <span class="c1"># Number of points:</span>
    <span class="n">nPts</span> <span class="o">=</span> <span class="mi">101</span>

    <span class="c1"># Convert &quot;noon&quot; to radians.</span>
    <span class="n">noon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">noon</span><span class="o">/</span><span class="mf">180.0</span>

    <span class="c1"># First, a circle.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nPts</span><span class="p">)</span>  <span class="c1"># Polar angle.</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>              <span class="c1"># Polar radius.</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1001</span><span class="p">)</span>

    <span class="c1"># Now, nightside.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">noon</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">noon</span><span class="o">+</span><span class="mf">3.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">nPts</span><span class="p">)</span>
    <span class="n">arc</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1002</span><span class="p">)</span>

    <span class="c1"># Add to plot.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">arc</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_adjust_dialplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Noon&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Ram output is often visualized with equatorial dial plots.  This</span>
<span class="sd">    function quickly adjusts those plots to give a uniform, clean</span>
<span class="sd">    look and feel.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
    <span class="c1"># Constrain range of plot:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rad</span><span class="p">)])</span>
    <span class="c1"># Set MLT labels:</span>
    <span class="n">lt_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;06&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;00&#39;</span><span class="p">]</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">lt_labels</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
    <span class="c1"># Set L labels and grid.  Turn off label at L=0.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span>
    <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="c1"># Change background color so labels stand out.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">add_body_polar</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>


<div class="viewcode-block" id="get_iono_cb">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.html#spacepy.pybats.ram.get_iono_cb">[docs]</a>
<span class="k">def</span> <span class="nf">get_iono_cb</span><span class="p">(</span><span class="n">ct_name</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Several custom colorbars used by RIM and AMIE have become standard when</span>
<span class="sd">    visualizing data from these models.  These are &#39;blue_white_red&#39; and</span>
<span class="sd">    &#39;white_red&#39;, used for data that have positive and negative values and</span>
<span class="sd">    for data that have only positive values, respectively.  This function</span>
<span class="sd">    builds and returns these colorbars when called with the initials of the</span>
<span class="sd">    color table name as the only argument.</span>

<span class="sd">    For RAM-SCB usage, the &#39;bwr&#39; color map is useful for plotting ionospheric</span>
<span class="sd">    potential and will create plots that look similar to those produced by</span>
<span class="sd">    AMIE and RIM.  The &#39;wr&#39; color map is useful when plotting anisotropy.</span>

<span class="sd">    Example - get each colormap:</span>

<span class="sd">    &gt;&gt;&gt;bwr_map = get_iono_cb(&#39;bwr&#39;)</span>
<span class="sd">    &gt;&gt;&gt;wr_map  = get_iono_cb(&#39;wr&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span> <span class="k">as</span> <span class="n">lsc</span>

    <span class="k">if</span> <span class="n">ct_name</span> <span class="o">==</span> <span class="s1">&#39;bwr&#39;</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.34</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
                 <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.66</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                 <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.66</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
                 <span class="p">}</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">lsc</span><span class="p">(</span><span class="s1">&#39;blue_white_red&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ct_name</span> <span class="o">==</span> <span class="s1">&#39;wr&#39;</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
                 <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                 <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
                 <span class="p">}</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">lsc</span><span class="p">(</span><span class="s1">&#39;white_red&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmap</span></div>



<div class="viewcode-block" id="EfieldFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.EfieldFile.html#spacepy.pybats.ram.EfieldFile">[docs]</a>
<span class="k">class</span> <span class="nc">EfieldFile</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Base class for reading electric field input and output ASCII files.</span>
<span class="sd">    Subclasses such as WeqFile are customized to handle specific formats.</span>

<span class="sd">    The default object is configured to handle</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="EfieldFile.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.EfieldFile.html#spacepy.pybats.ram.EfieldFile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Init base object.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EfieldFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Stash file name and read:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_parse_head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The function to parse the header should obtain:</span>
<span class="sd">        1) The date and time</span>
<span class="sd">        2) Relevant indices</span>

<span class="sd">        For input, pass the file object.  Header lines will be</span>
<span class="sd">        read such that only the value names and data are left to</span>
<span class="sd">        be read.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">head1</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">head2</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">formatms</span> <span class="o">=</span> <span class="s1">&#39;Date=%Y-%m-</span><span class="si">%d</span><span class="s1">_%H:%M:%S.000&#39;</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="s1">&#39;Date=%Y-%m-</span><span class="si">%d</span><span class="s1">_%H:%M:%S&#39;</span>
        <span class="n">tstr</span> <span class="o">=</span> <span class="n">head1</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">tstr</span><span class="p">,</span>
                                                      <span class="n">formatms</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">tstr</span><span class="p">,</span>
                                                      <span class="n">formats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;kp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">head2</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;f107&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">head2</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Original code: works with weimer files:</span>
        <span class="c1"># parts= headlines.split()</span>
        <span class="c1"># self.doy = int(parts[0])</span>
        <span class="c1"># self.hour= float(parts[1])</span>
        <span class="c1"># self.time = dt.datetime(year, 1,1,0,0) + \</span>
        <span class="c1">#             dt.timedelta(days=doy-1) + \</span>
        <span class="c1">#             dt.timedelta(hours=hour)</span>

<div class="viewcode-block" id="EfieldFile.read">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.EfieldFile.html#spacepy.pybats.ram.EfieldFile.read">[docs]</a>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load and parse the information in the file.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Open file object.  Send object to header parser.</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_head</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>

        <span class="c1"># Save last header line:</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="c1"># Slurp rest of lines:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># Create containers.  Note that we don&#39;t know if the file</span>
        <span class="c1"># contains longitude or MLT at this point...</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;epot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;keV&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;Re&#39;</span><span class="p">})</span>
        <span class="n">mlt</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">mlt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;epot&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Use header to determine if we have MLT or Phi.</span>
        <span class="c1"># Calculate the one we don&#39;t have.</span>
        <span class="k">if</span> <span class="s1">&#39;mlt&#39;</span> <span class="ow">in</span> <span class="n">head</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlt</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">12.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlt</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="c1"># Make CPCP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cpcp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;epot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;epot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="EfieldFile.add_potplot">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.EfieldFile.html#spacepy.pybats.ram.EfieldFile.add_potplot">[docs]</a>
    <span class="k">def</span> <span class="nf">add_potplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labcolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Noon&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Quickly add a potential plot to MPL object *target*.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        target : object</span>
<span class="sd">           The object on which plotting will happen.</span>
<span class="sd">        figsize : tuple</span>
<span class="sd">           A two-item tuple/list giving the dimensions of the figure, in inches.</span>
<span class="sd">           Defaults to (5,4)</span>
<span class="sd">        loc : integer</span>
<span class="sd">           The subplot triple that specifies the location of the axes object.</span>
<span class="sd">           Defaults to 111.</span>
<span class="sd">        zlim : real</span>
<span class="sd">           The upper limit for the color bar range.  Defaults to 50.</span>
<span class="sd">        n : int</span>
<span class="sd">           The number of contours.  Defaults to 31.</span>
<span class="sd">        labcolor : color</span>
<span class="sd">           A matplotlib-compatable color indicator for the ticks and labels.</span>
<span class="sd">        title : string</span>
<span class="sd">           A string title to set at the top of the plot.  Defaults to &quot;Noon&quot;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_iono_cb</span><span class="p">(</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
        <span class="n">crange</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.</span><span class="o">*</span><span class="n">zlim</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">zlim</span><span class="p">)</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">zlim</span><span class="p">,</span> <span class="n">zlim</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">],</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;epot&#39;</span><span class="p">]),</span>
                              <span class="n">levs</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">crange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">_adjust_dialplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">labcolor</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">add_cbar</span><span class="p">:</span>
            <span class="n">cticks</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">cticks</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;kV&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">cbar</span></div>
</div>



<div class="viewcode-block" id="WeqFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.WeqFile.html#spacepy.pybats.ram.WeqFile">[docs]</a>
<span class="k">class</span> <span class="nc">WeqFile</span><span class="p">(</span><span class="n">EfieldFile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Slight variation on the weimer class to read weq_***.in files.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_parse_head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headlines</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">headlines</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>



<div class="viewcode-block" id="RamSat">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.RamSat.html#spacepy.pybats.ram.RamSat">[docs]</a>
<span class="k">class</span> <span class="nc">RamSat</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class to handle and plot RAM-SCB virtual satellite files.  Instantiate</span>
<span class="sd">    an object by simply calling:</span>

<span class="sd">    &gt;&gt;&gt;sat=rampy.RamSat(&#39;SatFile.nc&#39;)</span>

<span class="sd">    Simple satellite file info, such as the time vector, file name, and</span>
<span class="sd">    output frequency are found as direct object attributes:</span>

<span class="sd">    &gt;&gt;&gt;sat.time</span>
<span class="sd">         array([2005-08-31 09:29:00, ...,2005-09-02 00:58:00],dtype=object)</span>

<span class="sd">    Data arrays are stored as object keys.  For example, obtain satellite</span>
<span class="sd">    coordinates by typing:</span>

<span class="sd">    &gt;&gt;&gt;sat[&#39;SM_xyz&#39;]</span>

<span class="sd">    RamSats work, for the most part, like dictionaries.  Add a new data entry</span>
<span class="sd">    (an array, constant, etc.) by simply calling:</span>

<span class="sd">    &gt;&gt;&gt;sat[&#39;New Thing&#39;]=(0,1,2,3,4)</span>

<span class="sd">    Be sure to peruse the docstrings of the many object methods to discover</span>
<span class="sd">    the many plotting functions and other capabilities.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="RamSat.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.RamSat.html#spacepy.pybats.ram.RamSat.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="c1"># Filename:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RamSat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load the NCDF file.  Should only be called by __init__().</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">netcdf_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namevars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># split off the netCDF attributes from the Python attributes</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;fp&#39;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;use_mmap&#39;</span><span class="p">,</span> <span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="s1">&#39;version_byte&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="o">...</span><span class="p">])</span>

        <span class="c1"># Get start time, set default if not found.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stringtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">stringtime</span> <span class="o">=</span> <span class="s1">&#39;20000101000000&#39;</span>

        <span class="c1"># parse start time and use it to create time object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">stringtime</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>

        <span class="c1"># Convert time in seconds to datetime.</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">][</span><span class="o">...</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">secs</span><span class="p">])</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>

        <span class="c1"># Close netcdf file and remove reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>

        <span class="c1"># Some other variables to keep handy:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;DtWrite&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Old files do not have DtWrite.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<div class="viewcode-block" id="RamSat.create_omniflux">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.RamSat.html#spacepy.pybats.ram.RamSat.create_omniflux">[docs]</a>
    <span class="k">def</span> <span class="nf">create_omniflux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Integrate the flux(currently as a function of energy and</span>
<span class="sd">        pitch angle) to get omnidirectional flux as a function of</span>
<span class="sd">        energy.  New units = (cm-2*s*keV)^-1</span>

<span class="sd">        Usage: just call this method to integrate all species.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        check : Boolean</span>
<span class="sd">                If check is True (default) then the presence of existing</span>
<span class="sd">                omni variables will cause this calculation to abort cleanly.</span>
<span class="sd">                If check is False, anything pre-calculated will be overwritten.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">get_species_label</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">omni</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">uvar</span> <span class="o">=</span> <span class="s1">&#39;omni&#39;</span> <span class="k">if</span> <span class="n">omni</span> <span class="k">else</span> <span class="s1">&#39;Flux&#39;</span>
            <span class="k">if</span> <span class="n">keyname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">uvar</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">keyname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">uvar</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">keyname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">uvar</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">keyname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">uvar</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">omnipresent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">get_species_label</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">omni</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                       <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="n">omnipresent</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Create new flux attributes:</span>
        <span class="n">nTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nPa</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;pa_grid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nEner</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;energy_grid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">omnikeys</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;omni</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_species_label</span><span class="p">(</span><span class="n">kk</span><span class="p">)),</span> <span class="n">kk</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">get_species_label</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="c1"># Create delta mu, where mu = cos(pitch angle)</span>
        <span class="k">if</span> <span class="s1">&#39;pa_width&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># if &quot;pa_width&quot; absent, calculate...</span>
            <span class="c1"># assume bin width for zeroth bin is same as first,</span>
            <span class="c1"># and that zeroth PA is zero.</span>
            <span class="n">grdif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;pa_grid&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;pa_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">grdif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grdif</span><span class="p">])</span>
        <span class="n">dMu</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;pa_width&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">omkey</span><span class="p">,</span> <span class="n">fluxkey</span> <span class="ow">in</span> <span class="n">omnikeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">omkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTime</span><span class="p">,</span> <span class="n">nEner</span><span class="p">))</span>
            <span class="c1"># Integrate.</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">fluxkey</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">fluxkey</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">omkey</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dMu</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Mask out bad values.</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">omkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">omkey</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">omkey</span><span class="p">])</span></div>


    <span class="c1"># RamSat Viz Routines #</span>
    <span class="k">def</span> <span class="nf">_orbit_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A function that, when passed to the FuncFormatter class of</span>
<span class="sd">        Matplotlib tick formatters, produces specialized ticks that give</span>
<span class="sd">        UT, LT, and inclination.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">num2date</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="n">num2date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">nowtime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>  <span class="c1"># Need &quot;naive&quot; dt object.</span>
            <span class="n">nt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">nt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">nt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">nt</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">nt</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
            <span class="n">nt</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">deltime</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">-</span><span class="n">nowtime</span><span class="p">)</span>
        <span class="n">mintime</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">deltime</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltime</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mintime</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Build format string.</span>
            <span class="n">fmtstring</span> <span class="o">=</span> \
                <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1"> UT</span><span class="se">\n</span><span class="s1">* MLT</span><span class="se">\n</span><span class="s1">* MLat</span><span class="se">\n</span><span class="s1">R=*$R_</span><span class="si">{E}</span><span class="s1">$&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">nowtime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">nowtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">fmtstring</span><span class="p">)</span>

        <span class="c1"># Get local time from XY coords.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SM_xyz&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SM_xyz&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SM_xyz&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Mlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">R</span><span class="p">))</span>
        <span class="n">fltMLT</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">rad2mlt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="o">%</span> <span class="mi">24</span>
        <span class="n">locHr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fltMLT</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">locMn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">fltMLT</span> <span class="o">-</span> <span class="n">locHr</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Build format string.</span>
        <span class="n">fmtstring</span> <span class="o">=</span> \
            <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1"> UT</span><span class="se">\n</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1"> MLT</span><span class="se">\n</span><span class="si">%5.1f</span><span class="s1">$^{</span><span class="se">\\</span><span class="s1">circ}$ MLat</span><span class="se">\n</span><span class="s1">R=</span><span class="si">%4.2f</span><span class="s1"> $R_</span><span class="si">{E}</span><span class="s1">$&#39;</span>\
            <span class="o">%</span> <span class="p">(</span><span class="n">nowtime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">nowtime</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">locHr</span><span class="p">,</span> <span class="n">locMn</span><span class="p">,</span> <span class="n">Mlat</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fmtstring</span><span class="p">)</span>

<div class="viewcode-block" id="RamSat.add_orbit_plot">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.RamSat.html#spacepy.pybats.ram.RamSat.add_orbit_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">add_orbit_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s1">&#39;XY&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timelim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span>
                       <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invertX</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a simple, 2D plot of the satellite orbit in a given (SM) plane.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        plane : string</span>
<span class="sd">             Plane to plot. Options are &#39;XY&#39;, &#39;XZ&#39;, and &#39;YZ&#39;; defaults &#39;XY&#39;.</span>

<span class="sd">        target : Figure or Axes</span>
<span class="sd">             If None (default), a new figure is generated from scratch.</span>
<span class="sd">             If a matplotlib Figure object, a new axis is created</span>
<span class="sd">             to fill that figure.</span>
<span class="sd">             If a matplotlib Axes object, the plot is placed</span>
<span class="sd">             into that axis.</span>

<span class="sd">        loc : int</span>
<span class="sd">            Use to specify the subplot placement of the axis</span>
<span class="sd">            (e.g. loc=212, etc.) Used if target is a Figure or None.</span>
<span class="sd">            Default 111 (single plot).</span>

<span class="sd">        invertX : boolean</span>
<span class="sd">            Reverse the SM X axis so &quot;Sun is to the left.&quot; Default True.</span>
<span class="sd">            This reverses the SM axis, not the plot axis, so it has no effect</span>
<span class="sd">            if plane is YZ.</span>

<span class="sd">        timelim : tuple</span>
<span class="sd">             A tuple of two :class:`datetime.datetime` objects specifying the</span>
<span class="sd">             time range to be plotted.  Defaults to **None** such that the</span>
<span class="sd">             whole time range available is plotted.</span>

<span class="sd">        title : string</span>
<span class="sd">             Sets title for plot axes.</span>

<span class="sd">        ls : string</span>
<span class="sd">             A matplotlib-compatable line format specifier, e.g., &#39;b-&#39;.</span>
<span class="sd">             Defaults to &#39;g.&#39;, or green dots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plane</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;XY&#39;</span><span class="p">,</span> <span class="s1">&#39;XZ&#39;</span><span class="p">,</span> <span class="s1">&#39;YZ&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is not a valid plot plane.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plane</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="c1"># Variables to map plot plane to correct variables:</span>
        <span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">ijk</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">ijk</span><span class="p">[</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">ijk</span><span class="p">[</span><span class="n">plane</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">timelim</span><span class="p">:</span>
            <span class="c1"># Set default time limit if none given.</span>
            <span class="n">timelim</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">iMin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">iMax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use timelim to get indices that bound our plots.</span>
            <span class="n">timediff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">timelim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">iMax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">timediff</span> <span class="o">==</span> <span class="n">timediff</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">timediff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">timelim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">iMin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">timediff</span> <span class="o">==</span> <span class="n">timediff</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Add orbit:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SM_xyz&#39;</span><span class="p">][</span><span class="n">iMin</span><span class="p">:</span><span class="n">iMax</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SM_xyz&#39;</span><span class="p">][</span><span class="n">iMin</span><span class="p">:</span><span class="n">iMax</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                <span class="n">ls</span><span class="p">)</span>
        <span class="c1"># Add body:</span>
        <span class="n">add_body</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">add_night</span><span class="o">=</span><span class="p">(</span><span class="n">plane</span> <span class="o">!=</span> <span class="s1">&#39;YZ&#39;</span><span class="p">))</span>

        <span class="c1"># Axis details:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plane</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;XY&#39;</span><span class="p">,</span> <span class="s1">&#39;XZ&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">invertX</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SM </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SM </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">grid_zeros</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">set_orb_ticks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="RamSat.add_omniflux_plot">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.RamSat.html#spacepy.pybats.ram.RamSat.add_omniflux_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">add_omniflux_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameflux</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="p">[</span><span class="mf">1E4</span><span class="p">,</span> <span class="mf">1E9</span><span class="p">],</span>
                          <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_orbticks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">timelim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">no_xlabels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and place a pcolor-type plot of omnidirectional flux.</span>

<span class="sd">        Omnidirectional fluxes are calculated by the object method</span>
<span class="sd">        &quot;create_omniflux&quot; and are saved into the object with keys such as</span>
<span class="sd">        &#39;omniO&#39; and &#39;omniHe&#39;, etc.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        target : Figure or Axes</span>
<span class="sd">             If None (default), a new figure is generated from scratch.</span>
<span class="sd">             If a matplotlib Figure object, a new axis is created</span>
<span class="sd">             to fill that figure.</span>
<span class="sd">             If a matplotlib Axes object, the plot is placed</span>
<span class="sd">             into that axis.</span>

<span class="sd">        loc : int</span>
<span class="sd">            Use to specify the subplot placement of the axis</span>
<span class="sd">            (e.g. loc=212, etc.) Used if target is a Figure or None.</span>
<span class="sd">            Default 111 (single plot).</span>

<span class="sd">        do_orbticks : boolean</span>
<span class="sd">            Activate orbit ticks (default False): add complex but</span>
<span class="sd">            informational tick marks that list the satellite&#39;s coordinates</span>
<span class="sd">            along with the time on the x-axis.  However, using these will</span>
<span class="sd">            require some &quot;massaging&quot; of the plot to make them properly</span>
<span class="sd">            visible.  Be sure to add lots of padding to the bottom of the plot.</span>

<span class="sd">        no_xlabels : boolean</span>
<span class="sd">            (Default False) Completely omit xlabel and xticklabels.</span>
<span class="sd">            Convenient for stacking flux plots on each other.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FuncFormatter</span><span class="p">,</span> <span class="n">LogLocator</span><span class="p">,</span>
                                       <span class="n">LogFormatterMathtext</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">date2num</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Check for omni fluxes, calculate as necessary.</span>
        <span class="k">if</span> <span class="n">nameflux</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_omniflux</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">nameflux</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a valid omnidirectional flux.&#39;</span>
                               <span class="o">%</span> <span class="n">nameflux</span><span class="p">)</span>
        <span class="c1"># Create a time vector that binds each pixel correctly.</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">+</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="c1"># egrid = self[&#39;energy_grid&#39;]</span>
        <span class="n">ecenter</span><span class="p">,</span> <span class="n">eboundary</span><span class="p">,</span> <span class="n">ewidth</span> <span class="o">=</span> <span class="n">gen_egrid</span><span class="p">(</span><span class="n">nE</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;energy_grid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># print(&quot;Need better energy grid setup for pcolormesh.&quot;)</span>
        <span class="n">flx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">eboundary</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">nameflux</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                            <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">eboundary</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">eboundary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">timelim</span><span class="p">:</span>
            <span class="n">timelim</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">applySmartTimeTicks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">timelim</span><span class="p">,</span> <span class="n">dolabel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">no_xlabels</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">do_orbticks</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;E ($keV$)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>  <span class="c1"># If title not set, use a default:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omniH&#39;</span><span class="p">:</span> <span class="s1">&#39;H$^{+}$&#39;</span><span class="p">,</span> <span class="s1">&#39;omniHe&#39;</span><span class="p">:</span> <span class="s1">&#39;He$^{+}$&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;omniO&#39;</span><span class="p">:</span> <span class="s1">&#39;O$^{+}$&#39;</span><span class="p">,</span> <span class="s1">&#39;omnie&#39;</span><span class="p">:</span> <span class="s1">&#39;e$^{-}$&#39;</span><span class="p">}</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Omnidirectional </span><span class="si">%s</span><span class="s1"> Flux&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">nameflux</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">do_orbticks</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orbit_formatter</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">add_cbar</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">flx</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">.85</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">LogLocator</span><span class="p">(),</span>
                                <span class="nb">format</span><span class="o">=</span><span class="n">LogFormatterMathtext</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$cm^{-2}s^{-1}keV^{-1}$&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">flx</span><span class="p">,</span> <span class="n">cbar</span></div>


<div class="viewcode-block" id="RamSat.plot_omni_quicklook">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.RamSat.html#spacepy.pybats.ram.RamSat.plot_omni_quicklook">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_omni_quicklook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flux_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eflux_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">hflux_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">oflux_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a quick-look plot of omnidirectional fluxes.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        flux_opts : dict</span>
<span class="sd">            dictionary of keyword arguments to pass to</span>
<span class="sd">            :meth:`add_omniflux_plot` for all flux plots</span>

<span class="sd">        eflux_opts : dict</span>
<span class="sd">            as flux_opts, but for the electron flux plot only</span>

<span class="sd">        hflux_opts : dict</span>
<span class="sd">            as flux_opts, but for the H+ flux plot only</span>

<span class="sd">        oflux_opts : dict</span>
<span class="sd">            as flux_opts, but for the O+ flux plot only</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        out : Figure</span>
<span class="sd">            Has 9 axes instances (axes attribute)</span>
<span class="sd">            0: XY orbit plot</span>
<span class="sd">            1: XZ orbit plot</span>
<span class="sd">            2: YZ orbit plot</span>
<span class="sd">            3: e- flux</span>
<span class="sd">            4: H+ flux</span>
<span class="sd">            5: O+ flux</span>
<span class="sd">            6: e- flux color bar</span>
<span class="sd">            7: H+ flux color bar</span>
<span class="sd">            8: O+ flux color bar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.19</span><span class="p">,</span>
                            <span class="n">top</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Do orbits first.</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_orbit_plot</span><span class="p">(</span><span class="s1">&#39;XY&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">a1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_orbit_plot</span><span class="p">(</span><span class="s1">&#39;XZ&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">a2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_orbit_plot</span><span class="p">(</span><span class="s1">&#39;YZ&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">a3</span><span class="p">)</span>

        <span class="c1"># Add fluxes.</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">eflux_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eflux_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">hflux_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hflux_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">oflux_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">oflux_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">flux_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flux_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">flux_opts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">eflux_opts</span><span class="p">,</span> <span class="n">hflux_opts</span><span class="p">,</span> <span class="n">oflux_opts</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux_opts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_omniflux_plot</span><span class="p">(</span><span class="s1">&#39;omnie&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span> <span class="n">no_xlabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">eflux_opts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_omniflux_plot</span><span class="p">(</span><span class="s1">&#39;omniH&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">a2</span><span class="p">,</span> <span class="n">no_xlabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">hflux_opts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_omniflux_plot</span><span class="p">(</span><span class="s1">&#39;omniO&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">a3</span><span class="p">,</span> <span class="n">do_orbticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">oflux_opts</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>
</div>



<div class="viewcode-block" id="PlasmaBoundary">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PlasmaBoundary.html#spacepy.pybats.ram.PlasmaBoundary">[docs]</a>
<span class="k">class</span> <span class="nc">PlasmaBoundary</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Opens an ascii-format boundary file written from</span>
<span class="sd">    IM_wrapper.f90:IM_put_from_gm in the coupled SWMF-RAM-SCB model.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="PlasmaBoundary.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PlasmaBoundary.html#spacepy.pybats.ram.PlasmaBoundary.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Init base object.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlasmaBoundary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Set up this instance:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">time</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlasmaBoundary.read">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PlasmaBoundary.html#spacepy.pybats.ram.PlasmaBoundary.read">[docs]</a>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read and parse the ascii boundary file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Read contents, slurp.</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># First line of header has date and time.</span>
        <span class="k">if</span> <span class="n">time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
            <span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># year</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>  <span class="c1"># month</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>  <span class="c1"># day</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>  <span class="c1"># hour</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>  <span class="c1"># min</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>  <span class="c1"># sec</span>
        <span class="c1"># Save header info that is useful.</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;npoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

        <span class="c1"># Parse remaining data into a dictionary:</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="s1">&#39;cm-3&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;eV&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;npoints&#39;</span><span class="p">],</span>
                                     <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]})</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw</span><span class="p">):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*************&#39;</span><span class="p">:</span>
                    <span class="n">vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100000.0</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">j</span><span class="p">])</span></div>


<div class="viewcode-block" id="PlasmaBoundary.write">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PlasmaBoundary.html#spacepy.pybats.ram.PlasmaBoundary.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Write self to self.filename.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Open file:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1"># Write header:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5E</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%2i</span><span class="s1"> </span><span class="si">%2i</span><span class="s1"> </span><span class="si">%2i</span><span class="s1"> </span><span class="si">%2i</span><span class="s1"> </span><span class="si">%2i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
                  <span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; Units are Hours, cm-3, and eV</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Write data and close.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;npoints&#39;</span><span class="p">]):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%13.6E</span><span class="s1"> </span><span class="si">%13.6E</span><span class="s1"> </span><span class="si">%13.6E</span><span class="s1"> </span><span class="si">%13.6E</span><span class="s1"> </span><span class="si">%13.6E</span><span class="s1"> </span><span class="si">%13.6E</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                      <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                       <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                       <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                       <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                       <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                       <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                       <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]][</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="BoundaryGroup">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryGroup.html#spacepy.pybats.ram.BoundaryGroup">[docs]</a>
<span class="k">class</span> <span class="nc">BoundaryGroup</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class that collects many :class:`PlasmaBoundary` objects together to</span>
<span class="sd">    work as a coherent group.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="BoundaryGroup.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryGroup.html#spacepy.pybats.ram.BoundaryGroup.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
        <span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">date2num</span>

        <span class="c1"># Init base object.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BoundaryGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Load files and count them!</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/bound_plasma*.out&#39;</span><span class="p">)</span>
        <span class="n">nfiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nfiles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No files found in path=&#39;</span> <span class="o">+</span> <span class="n">indir</span><span class="p">)</span>

        <span class="c1"># Use info from first file to set up data structures.</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">PlasmaBoundary</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">namevar</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;namevar&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nfiles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">namevar</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfille</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span> <span class="n">nfiles</span><span class="p">),</span> <span class="n">fillval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="n">temp</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]})</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">PlasmaBoundary</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">namevar</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">][:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

        <span class="c1"># Create some new values to plot:</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;nAll&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RhoH&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="n">namevar</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RhoO&#39;</span><span class="p">],</span>
                                  <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;cm-3&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ratO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RhoO&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;nAll&#39;</span><span class="p">],</span>
                                  <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">temparray</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">temparray</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="mi">13</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">temparray</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">][:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">temparray</span><span class="p">[:,</span> <span class="p">:]</span>

        <span class="c1"># Put pressure/temp in keV.</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eV&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">1000.0</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;keV&#39;</span>

        <span class="c1"># Internals for plotting:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lt_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dusk&#39;</span><span class="p">,</span> <span class="s1">&#39;Midnight&#39;</span><span class="p">,</span> <span class="s1">&#39;Dawn&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtime</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>  <span class="c1"># create decimal time.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zlims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]}</span></div>


<div class="viewcode-block" id="BoundaryGroup.add_ltut">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryGroup.html#spacepy.pybats.ram.BoundaryGroup.add_ltut">[docs]</a>
    <span class="k">def</span> <span class="nf">add_ltut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ntick</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot variable *var* as a contour against local time (y-axis) and</span>
<span class="sd">        universal time (x-axis) using the PyBats *target* method of other</span>
<span class="sd">        standard plotting methods.  Four items are returned: the Matplotlib</span>
<span class="sd">        Figure, Axes, Mesh, and ColorBar objects used (if add_cbar is set to</span>
<span class="sd">        **False**, the returned ColorBar object is simply set to **False**.)</span>

<span class="sd">        ========== =======================================================</span>
<span class="sd">        Kwarg      Description</span>
<span class="sd">        ========== =======================================================</span>
<span class="sd">        target     Select plot destination.  Defaults to new figure/axis.</span>
<span class="sd">        loc        The location of any generated subplots.  Default is 111.</span>
<span class="sd">        add_cbar   Toggles the automatic colorbar.  Default is**True**.</span>
<span class="sd">        cmap       Selects Matplotlib color table.  Defaults to *inferno*.</span>
<span class="sd">        zlim       Limits for z-axis.  Defaults to best-guess.</span>
<span class="sd">        clabel     Sets colorbar label.  Defaults to *var* units.</span>
<span class="sd">        xlabel     Sets x-axis limits, use &#39;full&#39;, &#39;ticks&#39;, or **None**.</span>
<span class="sd">        title      Sets axis title; defaults to **None**.</span>
<span class="sd">        grid       Show white dotted grid?  Defaults to **True**</span>
<span class="sd">        ntick      Number of attempted cbar ticks.  Defaults to 5.</span>
<span class="sd">        ========== =======================================================</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>

        <span class="c1"># Set up z-limits; use variable-specific defaults.</span>
        <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zlims</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No default zlimits for &quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
                <span class="n">zlim</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Create plot:</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">],</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Use LT ticks and markers on y-axis:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lt_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

        <span class="c1"># White ticks, slightly thicker:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

        <span class="c1"># Grid marks:</span>
        <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
            <span class="c1"># Both ticks and label.</span>
            <span class="n">applySmartTimeTicks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dolabel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s1">&#39;ticks&#39;</span><span class="p">:</span>
            <span class="c1"># Ticks, but no date label.</span>
            <span class="n">applySmartTimeTicks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dolabel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># A blank x-axis is often useful.</span>
            <span class="n">applySmartTimeTicks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dolabel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Add cbar as necessary:</span>
        <span class="k">if</span> <span class="n">add_cbar</span><span class="p">:</span>
            <span class="n">lct</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">ntick</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">lct</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">clabel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">cbar</span></div>
</div>



<div class="viewcode-block" id="PressureFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PressureFile.html#spacepy.pybats.ram.PressureFile">[docs]</a>
<span class="k">class</span> <span class="nc">PressureFile</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class for reading and visualizing pressure_####.in files.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="PressureFile.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PressureFile.html#spacepy.pybats.ram.PressureFile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>

        <span class="c1"># Init base object.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PressureFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Set up object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="c1"># Read and parse file.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">head_entries</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">head_entries</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p_unit</span> <span class="o">=</span> <span class="n">head_entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">name_map</span><span class="p">(</span><span class="n">namein</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;convert RAM pressure file pressure variable names to SpacePy names</span>

<span class="sd">            This module uses pressure variable names &quot;per[species]&quot; for perpendicular</span>
<span class="sd">            pressure and &quot;par[species]&quot; for parallel pressure.</span>
<span class="sd">            The species names use the case (e.g., helium is He) and electrons are</span>
<span class="sd">            always given as a lower case &quot;e&quot;. In the RAM pressure files the variables</span>
<span class="sd">            are &quot;PPAR_[species]&quot; where the species use title case.</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            &gt;&gt;&gt; name_map(&#39;PPAR_E&#39;)</span>
<span class="sd">            &#39;pare&#39;</span>
<span class="sd">            &gt;&gt;&gt; name_map(&#39;PPER_He&#39;)</span>
<span class="sd">            &#39;perHe&#39;</span>
<span class="sd">            &gt;&gt;&gt; name_map(&#39;PTotal&#39;)</span>
<span class="sd">            &#39;total&#39;</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="c1"># generic as RAM can now use specified list of named species</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">namein</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">n_parts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="c1"># Is a species name present?</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">n_parts</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="c1"># Is it a pressure? Drop leading P</span>
            <span class="k">if</span> <span class="n">namein</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):</span>
                <span class="n">varname</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">varname</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="c1"># Is it electrons? Make sure the name is lower case</span>
            <span class="k">if</span> <span class="n">spec</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;e&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">varname</span><span class="p">,</span> <span class="n">spec</span><span class="p">])</span>

        <span class="c1"># Create variables:</span>
        <span class="n">nRec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">varlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">varidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">vname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lsh&#39;</span><span class="p">:</span>
                <span class="n">varlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
                <span class="n">varidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nRec</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;RE&#39;</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">vname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mlt&#39;</span><span class="p">:</span>
                <span class="n">varlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mlt&#39;</span><span class="p">)</span>
                <span class="n">varidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nRec</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;Hours&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ent_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">(</span><span class="n">vname</span><span class="p">)</span>
                <span class="n">varlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent_name</span><span class="p">)</span>
                <span class="n">varidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">ent_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nRec</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="n">p_unit</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">:</span><span class="mi">28</span><span class="p">],</span> <span class="n">fuzzy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>

        <span class="c1"># Loop over all variables and grab value from correct column</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>  <span class="c1"># Skip header.</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">lidx</span><span class="p">,</span> <span class="n">vnam</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">varidx</span><span class="p">,</span> <span class="n">varlist</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">vnam</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">lidx</span><span class="p">]</span>

        <span class="c1"># Theta is an angle used for polar plots.</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">12.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;rad&#39;</span><span class="p">}</span>

        <span class="c1"># Grid spacing/size:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dTheta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nTheta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dTheta&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nTheta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nTheta&#39;</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Calculate isotropic pressures and anisotropies.</span>
        <span class="c1"># Calculate totals, set labels and metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parallels</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;par&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">parallels</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>  <span class="c1"># species is everything after the &quot;par&quot;a</span>
            <span class="k">if</span> <span class="n">spec</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                <span class="n">texspec</span> <span class="o">=</span> <span class="s1">&#39;e$^{-}$&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">texspec</span> <span class="o">=</span> <span class="n">spec</span> <span class="o">+</span> <span class="s1">&#39;$^{+}$&#39;</span>  <span class="c1"># for now assume all singly ionized</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="o">+</span><span class="n">spec</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;par&#39;</span><span class="o">+</span><span class="n">spec</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ani&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;per&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;par&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>  <span class="c1"># Isotropy units</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;per&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\bot$ Pressure, &#39;</span> <span class="o">+</span> <span class="n">texspec</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;par&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\parallel$ Pressure, &#39;</span> <span class="o">+</span> <span class="n">texspec</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Pressure, &#39;</span> <span class="o">+</span> <span class="n">texspec</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ani&#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Anisotropy, &#39;</span> <span class="o">+</span> <span class="n">texspec</span>

        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Total Pressure&#39;</span></div>


<div class="viewcode-block" id="PressureFile.add_cont_press">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PressureFile.html#spacepy.pybats.ram.PressureFile.add_cont_press">[docs]</a>
    <span class="k">def</span> <span class="nf">add_cont_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxz</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
                       <span class="n">minz</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a polar log-axis contour plot of pressure and add it to</span>
<span class="sd">        *target*.  For speedier plots, use plot_cont_press, which makes its</span>
<span class="sd">        own axis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        var : string</span>
<span class="sd">             The variable within the object to plot.  Defaults to &#39;total&#39;.</span>
<span class="sd">             Can be set to other species-specific pressure values.</span>
<span class="sd">        n : integer</span>
<span class="sd">             The number of contours.  Defaults to 31.</span>
<span class="sd">        maxz : real</span>
<span class="sd">             The color bar maximum.  Defaults to 1000.0</span>
<span class="sd">        minz : real</span>
<span class="sd">             The color bar minimum.  Defaults to 1.0.</span>
<span class="sd">        add_cbar : bool</span>
<span class="sd">             Set whether to add a color bar or not.  Defaults to **False**.</span>
<span class="sd">        cmap : string</span>
<span class="sd">             Set name of contour color map to use.  Defaults to &#39;inferno&#39;.</span>
<span class="sd">        npa : bool</span>
<span class="sd">             If **True**, plot in units of nanopascal instead of energy density.</span>
<span class="sd">             Defaults to **False**.</span>
<span class="sd">        labelsize : int</span>
<span class="sd">             Sets the font size of the labels.  Defaults to 15.</span>
<span class="sd">        title : string</span>
<span class="sd">             Sets the plot title.  Defaults to &#39;auto&#39;, using the variable label.</span>
<span class="sd">        target : Figure or Axes</span>
<span class="sd">             If None (default), a new figure is generated from scratch.</span>
<span class="sd">             If a matplotlib Figure object, a new axis is created</span>
<span class="sd">             to fill that figure.</span>
<span class="sd">             If a matplotlib Axes object, the plot is placed</span>
<span class="sd">             into that axis.</span>
<span class="sd">        loc : int</span>
<span class="sd">            Use to specify the subplot placement of the axis</span>
<span class="sd">            (e.g. loc=212, etc.) Used if target is a Figure or None.</span>
<span class="sd">            Default 111 (single plot).</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        fig : matplotlib figure object</span>
<span class="sd">        ax  : matplotlib axes object</span>
<span class="sd">        cont : matplotlib contour object</span>
<span class="sd">        cbar : matplotlib colorbar object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
        <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">colorbar</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">LogFormatterMathtext</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$KeV/cm^-3$&#39;</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">npa</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="mf">0.16</span>  <span class="c1"># Energy Density to Pressure in nPa.</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;nPa&#39;</span>
        <span class="c1"># Set up color bar &amp; levels.</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">minz</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">maxz</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">minz</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">levs</span><span class="p">,</span>
                              <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">_adjust_dialplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_cbar</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">LogLocator</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">LogFormatterMathtext</span><span class="p">(),</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="c1"># cbar.set_label(self.labels[var]+&#39; ($KeV/cm^-3)$&#39;)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">cbar</span></div>


<div class="viewcode-block" id="PressureFile.add_pcol_press">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.PressureFile.html#spacepy.pybats.ram.PressureFile.add_pcol_press">[docs]</a>
    <span class="k">def</span> <span class="nf">add_pcol_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxz</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">minz</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                       <span class="n">add_cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a pcolor plot of the pressure object to *target*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        var : string</span>
<span class="sd">             The variable within the object to plot.  Defaults to &#39;total&#39;.</span>
<span class="sd">             Can be set to other species-specific pressure values.</span>
<span class="sd">        maxz : real</span>
<span class="sd">             The color bar maximum.  Defaults to 1000.0</span>
<span class="sd">        minz : real</span>
<span class="sd">             The color bar minimum.  Defaults to 1.0.</span>
<span class="sd">        add_cbar : bool</span>
<span class="sd">             Set whether to add a color bar or not.  Defaults to **False**.</span>
<span class="sd">        labelsize : int</span>
<span class="sd">             Sets the font size of the labels.  Defaults to 15.</span>
<span class="sd">        title : string</span>
<span class="sd">             Sets the plot title.  Defaults to &#39;auto&#39;, using the variable label.</span>
<span class="sd">        target : Figure or Axes</span>
<span class="sd">             If None (default), a new figure is generated from scratch.</span>
<span class="sd">             If a matplotlib Figure object, a new axis is created</span>
<span class="sd">             to fill that figure.</span>
<span class="sd">             If a matplotlib Axes object, the plot is placed</span>
<span class="sd">             into that axis.</span>
<span class="sd">        loc : int</span>
<span class="sd">            Use to specify the subplot placement of the axis</span>
<span class="sd">            (e.g. loc=212, etc.) Used if target is a Figure or None.</span>
<span class="sd">            Default 111 (single plot).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        fig : matplotlib figure object</span>
<span class="sd">        ax  : matplotlib axes object</span>
<span class="sd">        cont : matplotlib contour object</span>
<span class="sd">        cbar : matplotlib colorbar object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
        <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">colorbar</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">LogFormatterMathtext</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Set title.</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>

        <span class="c1"># Set up grid centered on gridpoints.</span>
        <span class="n">dT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dTheta&#39;</span><span class="p">]</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dL&#39;</span><span class="p">]</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">dT</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">dT</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nTheta&#39;</span><span class="p">])</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">dL</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dL</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nL&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nL&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;nTheta&#39;</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># as of mpl 3.5 grid must be turned off before calling pcolormesh</span>
        <span class="n">pcol</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">p</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">minz</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxz</span><span class="p">),</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
        <span class="n">_adjust_dialplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_cbar</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">(</span><span class="n">pcol</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">LogLocator</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">LogFormatterMathtext</span><span class="p">(),</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="c1"># cbar.set_label(self.labels[var] + &#39; ($keV/cm^{-3}$)&#39;)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$keV/cm^{-3}$&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">cbar</span></div>
</div>



<div class="viewcode-block" id="BoundaryFluxFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryFluxFile.html#spacepy.pybats.ram.BoundaryFluxFile">[docs]</a>
<span class="k">class</span> <span class="nc">BoundaryFluxFile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read, plot, and edit flux $([filename].swf)$ or $([filename].dat)$ files.</span>
<span class="sd">    $([filename].dat)$ files are output into the Dsbnd directory.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="BoundaryFluxFile.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryFluxFile.html#spacepy.pybats.ram.BoundaryFluxFile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;swf&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_swf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_dsbnd</span><span class="p">()</span></div>


<div class="viewcode-block" id="BoundaryFluxFile.read_dsbnd">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryFluxFile.html#spacepy.pybats.ram.BoundaryFluxFile.read_dsbnd">[docs]</a>
    <span class="k">def</span> <span class="nf">read_dsbnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
        <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">search</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">linspace</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Try to get run time, species from filename.</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ds(\w</span><span class="si">{2}</span><span class="s1">)\_d(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)\_t(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="c1"># New filename format! Huzzah!</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                                 <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Determine size of file and allocate array.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nE</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nLT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nLT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="p">)</span>

        <span class="c1"># Read and parse lines.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nLT</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Set up local time grid.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LT</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nLT</span><span class="p">)</span></div>


<div class="viewcode-block" id="BoundaryFluxFile.read_swf">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryFluxFile.html#spacepy.pybats.ram.BoundaryFluxFile.read_swf">[docs]</a>
    <span class="k">def</span> <span class="nf">read_swf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Determine size of file and allocate array.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nLT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nE</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nLT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="p">])</span>

        <span class="c1"># Read and parse lines.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Set up local time grid.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nLT</span><span class="p">)</span></div>


<div class="viewcode-block" id="BoundaryFluxFile.quickplot">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.BoundaryFluxFile.html#spacepy.pybats.ram.BoundaryFluxFile.quickplot">[docs]</a>
    <span class="k">def</span> <span class="nf">quickplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1e7</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A quick plot of input flux on a fresh axis.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">LogFormatterMathtext</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="n">egrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="p">))</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">flux</span><span class="p">[</span><span class="n">flux</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">flx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">))</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">flx</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">LogLocator</span><span class="p">(),</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">LogFormatterMathtext</span><span class="p">())</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$cm^{-2}s^{-1}ster^{-1}keV^{-1}$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Local Time Sector&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (keV)&#39;</span><span class="p">)</span>
            <span class="n">newlabs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">newlabs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%6.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">newlabs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ecentr</span><span class="p">,</span> <span class="n">ebound</span><span class="p">,</span> <span class="n">ewidth</span> <span class="o">=</span> <span class="n">gen_egrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nE</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (keV)&#39;</span><span class="p">)</span>
            <span class="n">newlabs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">newlabs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%6.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ecentr</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">newlabs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>
</div>



<div class="viewcode-block" id="LogFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.LogFile.html#spacepy.pybats.ram.LogFile">[docs]</a>
<span class="k">class</span> <span class="nc">LogFile</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<div class="viewcode-block" id="LogFile.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.LogFile.html#spacepy.pybats.ram.LogFile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LogFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>


<div class="viewcode-block" id="LogFile.read">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.LogFile.html#spacepy.pybats.ram.LogFile.read">[docs]</a>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load the ascii logfile located at self.filename.</span>
<span class="sd">        This method is automatically called upon instantiation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Slurp in entire file.</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Parse the header.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;descrip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">namevar</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">nCols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">namevar</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">namevar</span><span class="p">):</span>
            <span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># Check the last line for completeness.</span>
        <span class="c1"># Files read while simulation is running will have incomplete</span>
        <span class="c1"># lines.</span>
        <span class="n">nPts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="n">checkline</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">checkline</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nCols</span><span class="p">:</span>
            <span class="n">nPts</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;npts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nPts</span>

        <span class="c1"># Pop time/date names off of Namevar.</span>
        <span class="k">for</span> <span class="n">nvr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="s1">&#39;mn&#39;</span><span class="p">,</span> <span class="s1">&#39;sc&#39;</span><span class="p">,</span> <span class="s1">&#39;msc&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]:</span>
            <span class="n">namevar</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">namevar</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nvr</span><span class="p">))</span>

        <span class="c1"># Create containers for data:</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nPts</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nPts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">namevar</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw</span><span class="p">[:</span><span class="n">nPts</span><span class="p">]):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># Set time:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]]),</span>  <span class="c1"># Year</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mo&#39;</span><span class="p">]]),</span>  <span class="c1"># Month</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]]),</span>  <span class="c1"># Day</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;hr&#39;</span><span class="p">]]),</span>  <span class="c1"># Hour</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mn&#39;</span><span class="p">]]),</span>  <span class="c1"># Minute</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;sc&#39;</span><span class="p">]]),</span>  <span class="c1"># Second</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;msc&#39;</span><span class="p">]])</span><span class="o">*</span><span class="mi">1000</span>  <span class="c1"># microsec</span>
                                           <span class="p">)</span>
                               <span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]])</span>
            <span class="c1"># Collect data</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">namevar</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">]])</span></div>


<div class="viewcode-block" id="LogFile.add_dst_quicklook">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.LogFile.html#spacepy.pybats.ram.LogFile.add_dst_quicklook">[docs]</a>
    <span class="k">def</span> <span class="nf">add_dst_quicklook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">showObs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">showBiot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a quick-look plot of Dst.  If kyotodst module is</span>
<span class="sd">        installed, compare to observed Dst.</span>

<span class="sd">        Two values are returned: the matplotlib Figure and Axes objects</span>
<span class="sd">        used to generate the plot (in that order.)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        target : Figure or Axes</span>
<span class="sd">             If None (default), a new figure is generated from scratch.</span>
<span class="sd">             If a matplotlib Figure object, a new axis is created</span>
<span class="sd">             to fill that figure.</span>
<span class="sd">             If a matplotlib Axes object, the plot is placed</span>
<span class="sd">             into that axis.</span>
<span class="sd">        loc : int</span>
<span class="sd">            Use to specify the subplot placement of the axis</span>
<span class="sd">            (e.g. loc=212, etc.) Used if target is a Figure or None.</span>
<span class="sd">            Default 111 (single plot).</span>
<span class="sd">        showObs : bool</span>
<span class="sd">            Show observed Dst?  Defaults to **True**</span>
<span class="sd">        showBiot : bool</span>
<span class="sd">            Show Biot-Savart Dst?  Defaults to **True**</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        fig : matplotlib figure object</span>
<span class="sd">        ax  : matplotlib axes object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;dstRam&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RAM Dst (DPS)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;dstBiot&#39;</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">showBiot</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;dstBiot&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RAM Dst (Biot)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                  <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">spacepy.pybats.kyoto</span> <span class="k">as</span> <span class="nn">kt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="k">if</span> <span class="n">showObs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stime</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">etime</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;obs_dst&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">obs_dst</span> <span class="o">=</span> <span class="n">kt</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;dst&#39;</span><span class="p">,</span> <span class="n">stime</span><span class="p">,</span> <span class="n">etime</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">args</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING! Failed to fetch Kyoto Dst: &#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_dst</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_dst</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Obs. Dst&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">applySmartTimeTicks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dolabel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dst [$nT$]&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>
</div>



<div class="viewcode-block" id="IonoPotScb">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.IonoPotScb.html#spacepy.pybats.ram.IonoPotScb">[docs]</a>
<span class="k">class</span> <span class="nc">IonoPotScb</span><span class="p">(</span><span class="n">PbData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The 3D equilibrium code produces NetCDF files that contain the</span>
<span class="sd">    ionospheric potential on the polar cap as well as mapped to the</span>
<span class="sd">    equatorial plane.  The IonoPotScb object can be used to parse and</span>
<span class="sd">    visualize the data quickly.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="IonoPotScb.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.IonoPotScb.html#spacepy.pybats.ram.IonoPotScb.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IonoPotScb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load the NetCDF file. Should only be called by __init__</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Load file with scipy.io.netcdf</span>
        <span class="k">with</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">netcdf_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">nfh</span><span class="p">:</span>
            <span class="c1"># split off the netCDF attributes from the Python attributes</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">nfh</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;fp&#39;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;use_mmap&#39;</span><span class="p">,</span> <span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="s1">&#39;version_byte&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nfh</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">NameVars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nfh</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="c1"># self.filedata contains the raw netcdf objects.</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">nfh</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmarray</span><span class="p">(</span><span class="n">nfh</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="o">...</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filedata</span> <span class="o">=</span> <span class="n">nfh</span><span class="o">.</span><span class="n">variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">nfh</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="o">...</span><span class="p">]</span>

        <span class="c1"># Determine units of potential.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PhiIono&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;V&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kV&#39;</span>

<div class="viewcode-block" id="IonoPotScb.calc_pot_drop">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.IonoPotScb.html#spacepy.pybats.ram.IonoPotScb.calc_pot_drop">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_pot_drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the electric potential drop across the inner magnetosphere</span>
<span class="sd">        for the whole time period.  This value is analogous to cross polar</span>
<span class="sd">        cap potential drop, but is only valid inside of the RAM-SCB domain.</span>

<span class="sd">        This value is simply the maximum potential minus the minimum potential.</span>
<span class="sd">        The new data entry is stored using key &#39;ceqp&#39;, which stands for the</span>
<span class="sd">        cross equatorial potential.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ceqp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">dmfilled</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">fillval</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ceqp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PhiIono&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> \
                              <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PhiIono&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ceqp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ceqp&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.0</span></div>


<div class="viewcode-block" id="IonoPotScb.plot_eqPot">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.IonoPotScb.html#spacepy.pybats.ram.IonoPotScb.plot_eqPot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_eqPot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the equatorial electric potential in kV to target, where</span>
<span class="sd">        target may be a matplotlib figure or axis or None.  If target</span>
<span class="sd">        is a figure, a new subplot is created.  If target is None, a</span>
<span class="sd">        new figure AND axis is created.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        time : int</span>
<span class="sd">            An array index indicating what epoch to plot.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        fig : matplotlib figure object</span>
<span class="sd">        ax  : matplotlib axes object</span>
<span class="sd">        cont : matplotlib contour object</span>
<span class="sd">        cbar : matplotlib colorbar object</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ================</span>
<span class="sd">        n : integer</span>
<span class="sd">             The number of contours.  Defaults to 31.</span>
<span class="sd">        range : real</span>
<span class="sd">             The max and min of the contour range.</span>
<span class="sd">        add_cbar : bool</span>
<span class="sd">             Set whether to add a color bar or not.  Defaults to **False**.</span>
<span class="sd">        target : Figure or Axes</span>
<span class="sd">             If None (default), a new figure is generated from scratch.</span>
<span class="sd">             If a matplotlib Figure object, a new axis is created</span>
<span class="sd">             to fill that figure.</span>
<span class="sd">             If a matplotlib Axes object, the plot is placed</span>
<span class="sd">             into that axis.</span>
<span class="sd">        loc : int</span>
<span class="sd">            Use to specify the subplot placement of the axis</span>
<span class="sd">            (e.g. loc=212, etc.) Used if target is a Figure or None.</span>
<span class="sd">            Default 111 (single plot).</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_iono_cb</span><span class="p">(</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
        <span class="n">crange</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.</span><span class="o">*</span><span class="nb">range</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">range</span><span class="p">)</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">range</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">1000.0</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Y (R$_</span><span class="si">{E}</span><span class="s1">$)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;X (R$_</span><span class="si">{E}</span><span class="s1">$)&#39;</span><span class="p">)</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;yEq&#39;</span><span class="p">][</span><span class="n">time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;xEq&#39;</span><span class="p">][</span><span class="n">time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PhiIono&#39;</span><span class="p">][</span><span class="n">time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">/</span><span class="n">factor</span><span class="p">,</span>
                           <span class="n">levs</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">crange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">add_body</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mf">90.0</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">add_cbar</span><span class="p">:</span>
            <span class="n">cticks</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">cticks</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;kV&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">cbar</span></div>
</div>



<div class="viewcode-block" id="Currents">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.Currents.html#spacepy.pybats.ram.Currents">[docs]</a>
<span class="k">class</span> <span class="nc">Currents</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The 3D equilibrium code produces NetCDF files that contain the</span>
<span class="sd">    electric currents throughout the domain.  Currents objects parse</span>
<span class="sd">    and visualize this data.</span>

<span class="sd">    For quick parsing of these files, PyNIO is required.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filedata</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filedata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key not found in object.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Currents.keys">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.Currents.html#spacepy.pybats.ram.Currents.keys">[docs]</a>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all keys for data objects stored in the IonoPotScb object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filedata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="Currents.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.Currents.html#spacepy.pybats.ram.Currents.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PyNIO</span> <span class="kn">import</span> <span class="n">Nio</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">Nio</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;PyNIO required, not found.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="c1"># Load file as Nio object.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Nio</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NameVars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attributes</span>
        <span class="c1"># self.filedata contains the raw NioVariable objects.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filedata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="c1"># New values saved as self[key] are stored in self.data, not</span>
        <span class="c1"># self.filedata which cannot be changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_netcdf</span> <span class="o">=</span> <span class="n">f</span></div>


<div class="viewcode-block" id="Currents.close">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.Currents.html#spacepy.pybats.ram.Currents.close">[docs]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Close the NetCDF file.  This will make values stored inside of the</span>
<span class="sd">        file unavailable to the user.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_netcdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="Currents.plot_jpar">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.Currents.html#spacepy.pybats.ram.Currents.plot_jpar">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_jpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">maxz</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">spacepy.pybats.rim</span> <span class="kn">import</span> <span class="n">get_iono_cb</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_iono_cb</span><span class="p">(</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
        <span class="n">crange</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.</span><span class="o">*</span><span class="n">maxz</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxz</span><span class="p">)</span>
        <span class="n">cnt1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;xPole&#39;</span><span class="p">][</span><span class="n">time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;yPole&#39;</span><span class="p">][</span><span class="n">time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                           <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;jParVas&#39;</span><span class="p">][</span><span class="n">time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">norm</span><span class="o">=</span><span class="n">crange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ParamFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.ParamFile.html#spacepy.pybats.ram.ParamFile">[docs]</a>
<span class="k">class</span> <span class="nc">ParamFile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    It is sometimes necessary to read and parse a PARAM.in file.  ParamFile</span>
<span class="sd">    objects quickly parse the info and store it in a convenient data structure.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;PARAM file at </span><span class="si">%s</span><span class="s1"> with </span><span class="si">%i</span><span class="s1"> commands.&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>

    <span class="c1"># Make &#39;er work like a dict.</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<div class="viewcode-block" id="ParamFile.keys">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.ParamFile.html#spacepy.pybats.ram.ParamFile.keys">[docs]</a>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span>

<div class="viewcode-block" id="ParamFile.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.ParamFile.html#spacepy.pybats.ram.ParamFile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read the file, parse each command.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Grab the full path and save it.</span>
        <span class="k">if</span> <span class="n">infile</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">infile</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">infile</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">infile</span>
        <span class="c1"># Slurp entire file.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Some commands have specialized parse functions.</span>
        <span class="c1"># Those are connected here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known_cmds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;STARTTIME&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_starttime</span><span class="p">,</span>
                           <span class="s1">&#39;STOP&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_stop</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


    <span class="c1"># Command specific parsers:</span>
    <span class="k">def</span> <span class="nf">_add_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_name</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="n">cmd_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">npop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="n">cmd_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">npop</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">npop</span>

    <span class="k">def</span> <span class="nf">_parse_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dur</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stoptime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="o">+</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dur</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_parse_starttime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># year</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># month</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># day</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># hour</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># minute</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># second</span>
            <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">1E6</span><span class="p">))</span>  <span class="c1"># millisec</span>
        <span class="k">return</span> <span class="mi">7</span>

    <span class="c1"># Quick function to pop multiple lines.</span>
    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="c1"># A quick function for multi-popping.</span>
        <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">arr</span>
        <span class="c1"># Loop throug all lines!</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Find first/next #COMMAND statement.</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Skip begin/end comps.</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;BEGIN_COMP&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;END_COMP&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_cmds</span><span class="p">:</span>
                <span class="c1"># If recognized command, process and pop arguments.</span>
                <span class="n">npop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_cmds</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]](</span><span class="n">lines</span><span class="p">)</span>
                <span class="n">pop</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">npop</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">npop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_cmd</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">lines</span><span class="p">)</span>
                <span class="n">pop</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">npop</span><span class="p">)</span></div>



<div class="viewcode-block" id="GeoMltFile">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile">[docs]</a>
<span class="k">class</span> <span class="nc">GeoMltFile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GeoMltFile is a class to open, read, manipulate and write files that</span>
<span class="sd">    contain LANL geosynchronous multi-satellite averaged, MLT-interpolated</span>
<span class="sd">    fluxes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="GeoMltFile.__init__">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scrub</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Create empty arrays.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">288</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">36</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">288</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">egrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">288</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle</span> <span class="o">=</span> <span class="s1">&#39;proton&#39;</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">compressed</span><span class="o">=</span><span class="n">compressed</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeoMltFile.read">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile.read">[docs]</a>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load contents from *self.filename*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">gzip</span>
        <span class="c1"># Open file</span>
        <span class="n">myopen</span> <span class="o">=</span> <span class="nb">open</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">compressed</span> <span class="k">else</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span>
        <span class="k">with</span> <span class="n">myopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">read_compressed</span><span class="p">(</span><span class="n">filehandle</span><span class="o">=</span><span class="n">fh</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">read_one_line</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readline</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">compressed</span> <span class="k">else</span> <span class="n">read_compressed</span>
            <span class="c1"># #Parse header information#</span>
            <span class="c1"># Read header</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">read_one_line</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c1"># Set measurement type:</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;electron&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">particle</span> <span class="o">=</span> <span class="s1">&#39;electron&#39;</span>
            <span class="c1"># Parse energy grid.</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">read_one_line</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># pop three times</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">egrid</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">36</span><span class="p">:]</span>

            <span class="c1"># ## Parse fluxes. ##</span>
            <span class="c1"># Slurp rest of file and close.</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># Grab L-grid.</span>
        <span class="n">lt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">lt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">lt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lgrid</span><span class="o">.</span><span class="n">size</span>
        <span class="c1"># Parse file one epoch at a time.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">288</span><span class="p">):</span>
            <span class="c1"># Get one epoch worth of data.</span>
            <span class="n">sublines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">nL</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">nL</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">nL</span><span class="p">]</span>
            <span class="c1"># Get time for this epoch.</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">sublines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span>
                                       <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">]),</span>
                                       <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">19</span><span class="p">]),</span>
                                       <span class="mi">1000</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">23</span><span class="p">]))</span>
            <span class="c1"># Parse rest of lines.</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sublines</span><span class="p">):</span>
                <span class="c1"># Use some string comprehension magic.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nsats</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">32</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">:</span><span class="mi">32</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">104</span><span class="o">+</span><span class="mi">18</span><span class="o">*</span><span class="n">x</span><span class="p">:</span><span class="mi">104</span><span class="o">+</span><span class="mi">18</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">18</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">)]</span></div>


<div class="viewcode-block" id="GeoMltFile.scrub">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile.scrub">[docs]</a>
    <span class="k">def</span> <span class="nf">scrub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lastflux</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        GeoMlt files often have bad data througout in the form of negative</span>
<span class="sd">        or zero fluxes.  In RAM-SCB, these are replaced with the last good</span>
<span class="sd">        data value.  This function &quot;scrubs&quot; the data in the same manner as</span>
<span class="sd">        RAM-SCB.  The kwarg *lastflux* may be given as a nLT x nE numpy array</span>
<span class="sd">        of the last good fluxes, e.g. the correct values at the epoch directly</span>
<span class="sd">        preceeding the first epoch of this file.  These will be used if the</span>
<span class="sd">        first time entry of the file contains bad values.  If not given, bad</span>
<span class="sd">        values at the first time entry will be set to zero.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Handle first line:</span>
        <span class="k">if</span> <span class="n">lastflux</span><span class="p">:</span>
            <span class="c1"># Check lastflux.</span>
            <span class="k">if</span> <span class="n">lastflux</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">egrid</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape of lastflux is incorrect.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lastflux</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">288</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Append another **GeoMltFile** object to this one using +=</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;object can only be combined with one of same type.&#39;</span><span class="p">)</span>

        <span class="c1"># Grid checks:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">egrid</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">egrid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;both items must have identical energy grids!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lgrid</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">lgrid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;both items must have identical MLT grids!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">particle</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;both items must have identical particles!&#39;</span><span class="p">)</span>

        <span class="c1"># Append data together:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsats</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">nsats</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Append file names:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="fm">__add__</span> <span class="o">=</span> <span class="fm">__iadd__</span>  <span class="c1"># allow add syntax as well as in-place add</span>

<div class="viewcode-block" id="GeoMltFile.timeseries_append">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile.timeseries_append">[docs]</a>
    <span class="k">def</span> <span class="nf">timeseries_append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        If *other* is of the same type as self, and both have a &#39;time&#39;</span>
<span class="sd">        entry, append all arrays within *other* that have the same size as</span>
<span class="sd">        &#39;time&#39; to the corresponding arrays within self.  This is useful</span>
<span class="sd">        for combining time series data of consecutive data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeoMltFile.plot_epoch_flux">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile.plot_epoch_flux">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_epoch_flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot fluxes (j(E, MLT)) for a single time</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        epoch : integer or datetime or spacepy.time.Ticktock</span>
<span class="sd">            If integer, the index corresponding to the time to be plotted.</span>
<span class="sd">            If a supported time type (datetime or Ticktock), the nearest</span>
<span class="sd">            index will be looked up and selected.</span>
<span class="sd">        target : object</span>
<span class="sd">            Target for plotting. If kwarg *target* is **None** (default),</span>
<span class="sd">            a new figure is generated. If *target* is a matplotlib Figure</span>
<span class="sd">            object, a new axis is created to fill that figure at subplot</span>
<span class="sd">            location *loc* (defaults to 111). If target is a matplotlib</span>
<span class="sd">            Axes object, the plot is placed into that axis at subplot</span>
<span class="sd">            location *loc*.</span>
<span class="sd">        loc : integer</span>
<span class="sd">            Designator for axis location. See description of target.</span>
<span class="sd">        title: str or None</span>
<span class="sd">            If not None, specifies the axis title.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : object</span>
<span class="sd">          A matplotlib figure object on which to plot.</span>

<span class="sd">        ax : object</span>
<span class="sd">          A matplotlib subplot object on which to plot.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">LogFormatterMathtext</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ep_idx</span> <span class="o">=</span> <span class="n">epoch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ep_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_from_time</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">set_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>

        <span class="n">egrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">egrid</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">lgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lgrid</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">ep_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">flux</span><span class="p">[</span><span class="n">flux</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">flx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lgrid</span><span class="p">,</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>
                            <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e10</span><span class="p">),</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">))</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">flx</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">LogLocator</span><span class="p">(),</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">LogFormatterMathtext</span><span class="p">())</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$cm^{-2}s^{-1}ster^{-1}keV^{-1}$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)])</span>

        <span class="n">default_title</span> <span class="o">=</span> <span class="s1">&#39;Flux at Boundary - </span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">ep_idx</span><span class="p">])</span>
        <span class="n">use_title</span> <span class="o">=</span> <span class="n">default_title</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">title</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">use_title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Local Time (hr)&#39;</span><span class="p">)</span>
        <span class="c1"># Use actual energy channels.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (keV)&#39;</span><span class="p">)</span>
        <span class="n">newlabs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">newlabs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%6.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">egrid</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">newlabs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="GeoMltFile.get_index_from_time">
<a class="viewcode-back" href="../../../autosummary/spacepy.pybats.ram.GeoMltFile.html#spacepy.pybats.ram.GeoMltFile.get_index_from_time">[docs]</a>
    <span class="k">def</span> <span class="nf">get_index_from_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a UTC time (datetime or Ticktock), return nearest index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        epoch : datetime.datetime or spacepy.time.Ticktock</span>
<span class="sd">            Time as a supported type (UTC as datetime.datetime or</span>
<span class="sd">            spacepy.time.Ticktock). The nearest index to this time</span>
<span class="sd">            will be looked up and returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        idx : integer</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">bisect</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">spt</span><span class="o">.</span><span class="n">Ticktock</span><span class="p">):</span>
            <span class="n">utc</span> <span class="o">=</span> <span class="n">epoch</span><span class="o">.</span><span class="n">UTC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">utc</span> <span class="o">=</span> <span class="n">epoch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type in get_index_from_time: &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;Supported types are [datetime.datetime, &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;spacepy.time.Ticktock, int]&#39;</span><span class="p">)</span>
        <span class="n">cidx</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cidx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">cidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deltaleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">utc</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">cidx</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
            <span class="n">deltaright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">utc</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">cidx</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cidx</span><span class="p">,</span> <span class="n">deltaleft</span><span class="p">,</span> <span class="n">deltaright</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">cidx</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">deltaleft</span> <span class="o">&lt;=</span> <span class="n">deltaright</span> <span class="k">else</span> <span class="n">cidx</span>

        <span class="k">return</span> <span class="n">idx</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="https://spacepy.github.io/"">homepage</a>|&nbsp;</li>
        <li><a href="https://github.com/spacepy/spacepy">development</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>
       <li><a href="../../../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../spacepy.html" >spacepy</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../pybats.html" >spacepy.pybats</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spacepy.pybats.ram</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2024, The SpacePy Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>